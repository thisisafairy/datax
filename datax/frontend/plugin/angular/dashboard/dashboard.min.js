!function(){"use strict";angular.module("dashboard",["dashboardInterface"]).constant("_",window._).constant("jQuery",window.$).constant("Drop",window.Drop).constant("consts",{addCount:!0,debug:!0,useUrl:!0,logging:!0,logLevel:"INFO",logPrintLevel:"INFO",logToWebSql:!1,hideMoreFn:!0,appId:"dashboard"})}(),angular.module("dashboard").run(["$templateCache",function(t){t.put("components/chartlist/chartlist.html",'<ul class="nav nav-list accordion-group" ng-repeat="kind in kinds"><li class="nav-header" ng-if="!kind.hideInChartList"><i class="icon-plus icon-white"></i> 分类:{{kind.kind}}</li><li class="boxes"><div ng-if="!data.hideInChartList" class="box box-element" id="box_{{ data.charttype }}_{{data.id}}" ng-repeat="data in kind.data"><div class="preview chart-title">{{data.name}}</div><div ng-drag="true" ng-drag-data="data"></div></div></li></ul><div class="box box-element" ng-drag-clone=""><div class="preview chart-title">{{clonedData.name}}</div></div>'),t.put("components/filters/normaltext.html",'<div class="cellbox"><div class="option-btn"><i class="fa fa-bars"></i></div><span class="filter-title">{{config.title}}</span> <input class="filter-module"><div class="drop-option"><div class="option-row" ng-click="showData()">查看数据</div><div class="option-row" ng-click="removeAction()">移除</div></div></div>'),t.put("components/griditem/griditem.html",'<div class="parent-content" id="charts_{{ config.data.id }}"><div class="release-link chart-tools" ng-click="releaseLink()" ng-if="config.data && config.data.link && config.data.link == \'linkStart\'"><i class="fa fa-unlink" title="清除联动"></i></div><div class="chart-enlarge chart-tools" ng-click="fullShowChart()" ng-if="!dropType && config.data.datatype == \'chart\' && config.data.datatype != \'table\' && deviceType == \'pc\'"><i class="fa fa-arrows-alt" title="全屏展示"></i></div><div class="option-btn"><i class="fa fa-bars fa-item-config-btn" ng-click="openDropOption($event)"></i></div><div class="filter-compnenet-wrapper text-filter-wrapper"></div><div ng-if="dropType==\'date\'"><div class="filter-label-container" style="width: 30%; display: inline-block;"><label class="searchlable filter-label">{{config.data.filterName}}</label></div><div style="width: calc(35% - 15px); display: inline-block;"><md-datepicker ng-model="dateFilter.startDate" md-placeholder="开始时间" ng-change="selectDateChange()" md-hide-icons="calendar" md-open-on-focus=""></md-datepicker></div><div style="width: 30px; display: inline-block; position: relative;"></div><div style="width: calc(35% - 15px); display: inline-block;"><md-datepicker ng-model="dateFilter.endDate" md-placeholder="截止时间" ng-change="selectDateChange()" md-hide-icons="calendar" md-open-on-focus=""></md-datepicker></div></div><div class="filter-compnenet-wrapper select-filter-wrapper"></div><div class="rich-text-content full-content" ng-if="dropType==\'labelBox\'" ng-class="{\'scroll-auto\': config.data.componentType == \'text\'}"><div class="auto-hide" ng-class="{\'auto-show\': config.data.componentType == \'text\'}" ng-dblclick="openTextEditor()" ng-bind-html="config.data.textContent"></div><div class="auto-hide full-content" ng-class="{\'auto-show\': config.data.componentType == \'webPage\'}" style="background-color: #ffffff;"><div ng-repeat="link in config.data.links" class="full-content"><iframe class="full-content embedded-frame" id="{{ link.id }}"></iframe></div></div></div><div ng-if="!dropType && config.data.datatype == \'chart\' && config.data.datatype != \'table\'" class="chart-content" id="{{ config.data.id }}"></div><div ng-if="!dropType && config.data.datatype == \'table\'" class="chart-content" ng-class="{\'lite-border\': config.data.styleConfig.liteBorder}"><div class="table-header" ng-if="config.data.jsonconfig.tableTitle && config.data.jsonconfig.tableTitle.length > 1">{{ config.data.jsonconfig.tableTitle }}</div><dx-table columns="columns" data="tableObj.data" custom-config="customConfig" full-fix="config.data.styleConfig.fullFix" height="itemTotalHeight" row-height="tableRowHeight"></dx-table></div><div ng-if="config.data.datatype && (config.data.datatype == \'chart\' || config.data.datatype == \'table\') && config.data.commentsConfig.showComments" class="chart-label" ng-click="openLabelText($event)" ng-class="{\'hover-show\':deviceType==\'pc\'}"><i class="fa fa-edit"></i>&nbsp;评论</div><div class="chart-label-arrow" ng-style="config.data.commentsConfig.style.total"></div></div>'),t.put("components/modal/modal.html",'<div class="ngmodal" ng-if="isOpen"><div class="modal-wrapper" style="{{wrapperStyle}}" ng-transclude=""></div></div>'),t.put("components/modal/modalclosebutton.html",'<div class="right"><a ng-click="closeModal()" class="right"><i class="fa fa-times"></i></a></div>')}]),function(){(function(){var t="function"==typeof define&&define.amd,V={function:!0,object:!0},e=V[typeof exports]&&exports&&!exports.nodeType&&exports,H=V[typeof window]&&window||this,a=e&&V[typeof module]&&module&&!module.nodeType&&"object"==typeof global&&global;function _(t,c){t=t||H.Object(),c=c||H.Object();var s=t.Number||H.Number,d=t.String||H.String,e=t.Object||H.Object,f=t.Date||H.Date,a=t.SyntaxError||H.SyntaxError,D=t.TypeError||H.TypeError,n=t.Math||H.Math,o=t.JSON||H.JSON;"object"==typeof o&&o&&(c.stringify=o.stringify,c.parse=o.parse);var O,F,k,i=e.prototype,$=i.toString,g=new f(-0xc782b5b800cec);try{g=-109252==g.getUTCFullYear()&&0===g.getUTCMonth()&&1===g.getUTCDate()&&10==g.getUTCHours()&&37==g.getUTCMinutes()&&6==g.getUTCSeconds()&&708==g.getUTCMilliseconds()}catch(t){}function u(t){if(u[t]!==k)return u[t];var e;if("bug-string-char-index"==t)e="a"!="a"[0];else if("json"==t)e=u("json-stringify")&&u("json-parse");else{var a,n='{"a":[1,true,false,null,"\\u0000\\b\\n\\f\\r\\t"]}';if("json-stringify"==t){var o=c.stringify,i="function"==typeof o&&g;if(i){(a=function(){return 1}).toJSON=a;try{i="0"===o(0)&&"0"===o(new s)&&'""'==o(new d)&&o($)===k&&o(k)===k&&o()===k&&"1"===o(a)&&"[1]"==o([a])&&"[null]"==o([k])&&"null"==o(null)&&"[null,null,null]"==o([k,$,null])&&o({a:[a,!0,!1,null,"\0\b\n\f\r\t"]})==n&&"1"===o(null,a)&&"[\n 1,\n 2\n]"==o([1,2],null,1)&&'"-271821-04-20T00:00:00.000Z"'==o(new f(-864e13))&&'"+275760-09-13T00:00:00.000Z"'==o(new f(864e13))&&'"-000001-01-01T00:00:00.000Z"'==o(new f(-621987552e5))&&'"1969-12-31T23:59:59.999Z"'==o(new f(-1))}catch(t){i=!1}}e=i}if("json-parse"==t){var l=c.parse;if("function"==typeof l)try{if(0===l("0")&&!l(!1)){var r=5==(a=l(n)).a.length&&1===a.a[0];if(r){try{r=!l('"\t"')}catch(t){}if(r)try{r=1!==l("01")}catch(t){}if(r)try{r=1!==l("1.")}catch(t){}}}}catch(t){r=!1}e=r}}return u[t]=!!e}var p="[object Function]",j="[object Number]",N="[object String]",E="[object Array]",r=u("bug-string-char-index");if(!g)var L=n.floor,l=[0,31,59,90,120,151,181,212,243,273,304,334],W=function(t,e){return l[e]+365*(t-1970)+L((t-1969+(e=+(1<e)))/4)-L((t-1901+e)/100)+L((t-1601+e)/400)};(O=i.hasOwnProperty)||(O=function(t){var a,e={};return O=(e.__proto__=null,e.__proto__={toString:1},e).toString!=$?function(t){var e=this.__proto__,a=t in(this.__proto__=null,this);return this.__proto__=e,a}:(a=e.constructor,function(t){var e=(this.constructor||a).prototype;return t in this&&!(t in e&&this[t]===e[t])}),e=null,O.call(this,t)}),F=function(t,e){var a,l,n,o=0;for(n in(a=function(){this.valueOf=0}).prototype.valueOf=0,l=new a)O.call(l,n)&&o++;return a=l=null,(F=o?2==o?function(t,e){var a,n={},o=$.call(t)==p;for(a in t)o&&"prototype"==a||O.call(n,a)||!(n[a]=1)||!O.call(t,a)||e(a)}:function(t,e){var a,n,o=$.call(t)==p;for(a in t)o&&"prototype"==a||!O.call(t,a)||(n="constructor"===a)||e(a);(n||O.call(t,a="constructor"))&&e(a)}:(l=["valueOf","toString","toLocaleString","propertyIsEnumerable","isPrototypeOf","hasOwnProperty","constructor"],function(t,e){var a,n,o=$.call(t)==p,i=!o&&"function"!=typeof t.constructor&&V[typeof t.hasOwnProperty]&&t.hasOwnProperty||O;for(a in t)o&&"prototype"==a||!i.call(t,a)||e(a);for(n=l.length;a=l[--n];i.call(t,a)&&e(a));}))(t,e)};function I(t,e){return("000000"+(e||0)).slice(-t)}function A(t){for(var e='"',a=0,n=t.length,o=!r||10<n,i=o&&(r?t.split(""):t);a<n;a++){var l=t.charCodeAt(a);switch(l){case 8:case 9:case 10:case 12:case 13:case 34:case 92:e+=h[l];break;default:if(l<32){e+="\\u00"+I(2,l.toString(16));break}e+=o?i[a]:t.charAt(a)}}return e+'"'}var h={92:"\\\\",34:'\\"',8:"\\b",12:"\\f",10:"\\n",13:"\\r",9:"\\t"},U=function(t,e,n,o,i,l,r,c){var s,a,d,f,g,u,p,h,m,y,b,C,v,w;c=c||0;try{s=e[t]}catch(t){}if("object"==typeof s&&s)if("[object Date]"!=(a=$.call(s))||O.call(s,"toJSON"))"function"==typeof s.toJSON&&(a!=j&&a!=N&&a!=E||O.call(s,"toJSON"))&&(s=s.toJSON(t));else if(-1/0<s&&s<1/0){if(W){for(g=L(s/864e5),d=L(g/365.2425)+1970-1;W(d+1,0)<=g;d++);for(f=L((g-W(d,0))/30.42);W(d,f+1)<=g;f++);g=1+g-W(d,f),p=L((u=(s%864e5+864e5)%864e5)/36e5)%24,h=L(u/6e4)%60,m=L(u/1e3)%60,y=u%1e3}else d=s.getUTCFullYear(),f=s.getUTCMonth(),g=s.getUTCDate(),p=s.getUTCHours(),h=s.getUTCMinutes(),m=s.getUTCSeconds(),y=s.getUTCMilliseconds();s=(d<=0||1e4<=d?(d<0?"-":"+")+I(6,d<0?-d:d):I(4,d))+"-"+I(2,f+1)+"-"+I(2,g)+"T"+I(2,p)+":"+I(2,h)+":"+I(2,m)+"."+I(3,y)+"Z"}else s=null;if(n&&(s=n.call(e,t,s)),null===s)return"null";if("[object Boolean]"==(a=$.call(s)))return""+s;if(a==j)return-1/0<s&&s<1/0?""+s:"null";if(a==N)return A(""+s);if("object"==typeof s){for(v=r.length;v--;)if(r[v]===s)throw D();if(r.push(s),b=[],w=l,l+=i,a==E){var x,S=l.length;for(T=0,v=s.length;T<v;T++)C=U(T,s,n,o,i,l,r,c),S+=(x=C===k?"null":C).length+(0<T?1:0),b.push(x);x=b.length?i&&c<S?"[\n"+l+b.join(",\n"+l)+"\n"+w+"]":"["+b.join(",")+"]":"[]"}else{S=l.length;var T=0;F(o||s,function(t){var e,a=U(t,s,n,o,i,l,r,c);a!==k&&(e=A(t)+":"+(i?" ":"")+a,S+=e.length+(0<T++?1:0),b.push(e))}),x=b.length?i&&c<S?"{\n"+l+b.join(",\n"+l)+"\n"+w+"}":"{"+b.join(",")+"}":"{}"}return r.pop(),x}};if(c.stringify=function(t,e,a,n){var o,i,l,r;if(V[typeof e]&&e)if((r=$.call(e))==p)i=e;else if(r==E){l={};for(var c,s=0,d=e.length;s<d;c=e[s++],(r=$.call(c))!=N&&r!=j||(l[c]=1));}if(a)if((r=$.call(a))==j){if(0<(a-=a%1))for(o="",10<a&&(a=10);o.length<a;o+=" ");}else r==N&&(o=a.length<=10?a:a.slice(0,10));return U("",((c={})[""]=t,c),i,l,o,"",[],n)},c.compactStringify=function(t,e,a){return c.stringify(t,e,a,60)},!u("json-parse")){function m(){throw C=v=null,a()}function y(){for(var t,e,a,n,o,i=v,l=i.length;C<l;)switch(o=i.charCodeAt(C)){case 9:case 10:case 13:case 32:C++;break;case 123:case 125:case 91:case 93:case 58:case 44:return t=r?i.charAt(C):i[C],C++,t;case 34:for(t="@",C++;C<l;)if((o=i.charCodeAt(C))<32)m();else if(92==o)switch(o=i.charCodeAt(++C)){case 92:case 34:case 47:case 98:case 116:case 110:case 102:case 114:t+=x[o],C++;break;case 117:for(e=++C,a=C+4;C<a;C++)48<=(o=i.charCodeAt(C))&&o<=57||97<=o&&o<=102||65<=o&&o<=70||m();t+=w("0x"+i.slice(e,C));break;default:m()}else{if(34==o)break;for(o=i.charCodeAt(C),e=C;32<=o&&92!=o&&34!=o;)o=i.charCodeAt(++C);t+=i.slice(e,C)}if(34==i.charCodeAt(C))return C++,t;m();default:if(e=C,45==o&&(n=!0,o=i.charCodeAt(++C)),48<=o&&o<=57){for(48==o&&(48<=(o=i.charCodeAt(C+1))&&o<=57)&&m(),n=!1;C<l&&(48<=(o=i.charCodeAt(C))&&o<=57);C++);if(46==i.charCodeAt(C)){for(a=++C;a<l&&(48<=(o=i.charCodeAt(a))&&o<=57);a++);a==C&&m(),C=a}if(101==(o=i.charCodeAt(C))||69==o){for(43!=(o=i.charCodeAt(++C))&&45!=o||C++,a=C;a<l&&(48<=(o=i.charCodeAt(a))&&o<=57);a++);a==C&&m(),C=a}return+i.slice(e,C)}if(n&&m(),"true"==i.slice(C,C+4))return C+=4,!0;if("false"==i.slice(C,C+5))return C+=5,!1;if("null"==i.slice(C,C+4))return C+=4,null;m()}return"$"}function b(t,e,a){var n=T(t,e,a);n===k?delete t[e]:t[e]=n}var C,v,w=d.fromCharCode,x={92:"\\",34:'"',47:"/",98:"\b",116:"\t",110:"\n",102:"\f",114:"\r"},S=function(t){var e,a;if("$"==t&&m(),"string"==typeof t){if("@"==(r?t.charAt(0):t[0]))return t.slice(1);if("["==t){for(e=[];"]"!=(t=y());a=a||!0)a&&(","==t?"]"==(t=y())&&m():m()),","==t&&m(),e.push(S(t));return e}if("{"==t){for(e={};"}"!=(t=y());a=a||!0)a&&(","==t?"}"==(t=y())&&m():m()),","!=t&&"string"==typeof t&&"@"==(r?t.charAt(0):t[0])&&":"==y()||m(),e[t.slice(1)]=S(y());return e}m()}return t},T=function(t,e,a){var n,o=t[e];if("object"==typeof o&&o)if($.call(o)==E)for(n=o.length;n--;)b(o,n,a);else F(o,function(t){b(o,t,a)});return a.call(t,e,o)};c.parse=function(t,e){var a,n;return C=0,v=""+t,a=S(y()),"$"!=y()&&m(),C=v=null,e&&$.call(e)==p?T(((n={})[""]=a,n),"",e):a}}return c.runInContext=_,c}if(!a||a.global!==a&&a.window!==a&&a.self!==a||(H=a),e&&!t)_(H,e);else{var n=H.JSON,o=H.JSON3,i=!1,l=_(H,H.JSON3={noConflict:function(){return i||(i=!0,H.JSON=n,H.JSON3=o,n=o=null),l}});H.JSON={parse:l.parse,stringify:l.stringify}}t&&define(function(){return l})}).call(this)}(),function(){"use strict";angular.module("dashboard").directive("chartList",function(){return{templateUrl:"components/chartlist/chartlist.html",restrict:"E",scope:{kinds:"=",items:"="},link:function(t,e){},controller:["$scope","$http",function(a,t){a.addChart=function(t){var e=angular.copy(a.items).sort(function(t,e){return e.row-t.row});a.items.push({sizeX:12,sizeY:5,row:0<e.length?e[0].row+e[0].sizeY:0,col:0,data:t})}}]}})}(),function(){"use strict";angular.module("dashboard").directive("normaltext",["Drop",function(a){return{templateUrl:"components/griditem/griditem.html",restrict:"E",scope:{config:"=",tableData:"=",removeAction:"&"},link:function(t,e){t.typePopup=new a({content:e.parent().find(".drop-option")[0],target:e.parent().find(".fa-bars")[0],position:"bottom right",openOn:"click"}),t.width=e.parent().width()-5,t.height=e.parent().height(),t.$on("$destroy",function(){t.typePopup&&t.typePopup.destroy&&t.typePopup.destroy()})},controller:["$scope","$element","$http","$timeout","Modals",function(e,a,n,t,o){e.table={column:[],tableData:[]},e.showData=function(){o.open("data-modal"),0<e.data.length&&(e.tableData=angular.copy(e.table)),e.typePopup.close()},e.config.data.echartconfig&&(e.ecconfig=JSON.parse(e.config.data.echartconfig),e.$watch("ecconfig.data.url",function(t){"string"==typeof t&&n.get(e.ecconfig.data.url).then(function(t){e.config.data.lists=t.data,e.ecconfig.width=$(a).find(".chart-content").width(),e.ecconfig.height=e.height,buildEchart(e.ecconfig,$(a).find(".chart-content"),e.config.data.lists)})}))}]}}])}(),function(){"use strict";angular.module("dashboard").directive("gridItem",["Drop","filterValueChange",function(t,h){return{templateUrl:"components/griditem/griditem.html",restrict:"E",scope:{openFilterPanel:"&",olapids:"=",config:"=",configitems:"=",tableData:"=",dropType:"=",globalConfig:"=",syncFontColor:"=",sceneOptions:"=",removeAction:"&",showTextEditor:"&",itemStyleConfig:"&",openLinkagePanel:"&",updateComponent:"&",openCommentsSection:"&",reloadingDashboardStatus:"=",scenesContentWidth:"=",rowHeight:"=?rowHeight",afterDataLoad:"&"},link:function(t,e){},controller:["$scope","$element","$http","$window","$timeout","$compile","Modals",function(r,n,e,o,c,s,t){if(r.rowHeight||(r.rowHeight=50),r.componentUuid=generateUuid(8,16),r.deviceType=terminalType,r.viewType=viewType,r.newScene=!0,r.openDropOption=function(t){if(dropOptionElement)dropOptionElement.remove(),dropOptionElement=null;else{var e=$(t.target).offset(),a="position:absolute;top:"+(e.top+20)+"px;left:"+e.left+"px;display:block;",n=dropOptionHtmlStr.replace("_style_",a),o=angular.element(n);dropOptionElement=s(o)(r),angular.element(document.body).append(dropOptionElement)}},r.closeDropOption=function(){dropOptionElement&&(dropOptionElement.remove(),dropOptionElement=null)},r.resizeCol=function(t){if(tableColResizeElement)tableColResizeElement.remove(),tableColResizeElement=null;else{if($(t.target).offset().top+32*u.columns.length+20>o.innerHeight)var e="position:absolute;bottom:20px;left:"+($(t.target).offset().left-220)+"px;display:block;";else e="position:absolute;top:"+$(t.target).offset().top+"px;left:"+($(t.target).offset().left-220)+"px;display:block;";var a=tableColResizeElementStr.replace("_style_",e),n=angular.element(a);tableColResizeElement=s(n)(r),angular.element(document.body).append(tableColResizeElement)}r.closeDropOption()},r.config&&r.config.data){isNotNull(r.config.data.id)&&$(n).find(".parent-content").addClass("charts-"+r.config.data.id),r.configType=r.config.data.datatype?r.config.data.datatype:r.config.data.dropType,(1<currentSceneId.length||getQueryString("scenesId")&&1<getQueryString("scenesId").length)&&(r.newScene=!1),"show"==r.viewType&&$(".option-btn").remove();o.innerWidth;if(r.showPanel=!1,r.dateFilter={startDate:"",endDate:""},r.textFilter={data:"",filterWay:""},r.filterData="",r.replayText="",r.filterPanel=function(){r.closeDropOption(),r.openFilterPanel()},r.linkagePanel=function(){r.closeDropOption(),r.openLinkagePanel()},r.openTextEditor=function(){$$scope.closeDropOption(),r.showTextEditor()},r.showData=function(){t.open("data-modal"),0<r.data.length&&(r.tableData=angular.copy(r.table)),r.closeDropOption()},r.showStyleConfig=function(){r.closeDropOption(),r.itemStyleConfig()},r.removeComponent=function(){$(".drop-option").hide(),"select"!=r.config.data.dropType&&"date"!=r.config.data.dropType&&"text"!=r.config.data.dropType||(r.textFilter.data="",r.filterData="",r.textFilter={data:"",filterWay:""}),r.removeAction()},"select"==r.config.data.dropType||"date"==r.config.data.dropType||"text"==r.config.data.dropType){if(isNull(r.config.data.styleConfig.separationClass)&&(r.config.data.styleConfig.separationClass="separation-46"),r.deleteSelect=function(){r.config.data.filterDatas.forEach(function(t){t.checked=!1}),r.multipleSelectChange()},"text"==r.config.data.dropType){r.config.data.defaultVal&&0<r.config.data.defaultVal.length&&(r.textFilter.data=r.config.data.defaultVal,r.config.data.val=r.textFilter.data),r.config.data.defaultValText&&0<r.config.data.defaultValText.length&&(r.textFilter.data=r.config.data.defaultValText,r.config.data.val=r.textFilter.data);var a=angular.element(textComponentHtml),i=s(a)(r),l=angular.element(n[0].querySelector(".text-filter-wrapper"));l.append(i),l.addClass(r.config.data.styleConfig.separationClass),l.addClass("auto-show"),r.textFilterChange=function(){var t=r.textFilter.data;c(function(){r.textFilter.data==t&&(r.startTextFilter(),h.afterChange(r.configitems,r.config))},1500)},r.$watch("config.data.customValue",function(t){t&&0<(t+"").length&&(r.textFilter.data=t+"",r.startTextFilter())}),r.startTextFilter=function(){r.config.data.textFilterWay&&(r.textFilter.filterWay=r.config.data.textFilterWay),r.config.data.val=r.textFilter.data,startFilter(r.config,r.configitems,r.textFilter)}}if("select"==r.config.data.dropType){var d=angular.element(selectComponentHtml),f=s(d)(r),g=angular.element(n[0].querySelector(".select-filter-wrapper"));g.append(f),g.addClass(r.config.data.styleConfig.separationClass),g.addClass("auto-show"),r.searchTerm="",r.clearSearchTerm=function(){r.searchTerm=""},r.multiSelectVal=[],r.singleSelectVal="",r.$watch("config.data.customValue",function(t){t&&0<(t+"").length&&(r.config.data.multipleSelect?(r.multiSelectVal=[t],r.config.data.val=r.multiSelectVal):(r.singleSelectVal=t,r.config.data.val=r.singleSelectVal),startFilter(r.config,r.configitems,t+""))}),r.$watch("config.data.filterDatas",function(t){if(r.config.data.filterDatas&&0<r.config.data.filterDatas.length){if(r.selectArr=[],isNotNull(t)&&0<t.length&&r.config.data.filterDatas.forEach(function(t){r.selectArr.push(t.id)}),r.waitingInitDefault=!0,isNotNull(r.config.data.defaultVal)&&0<r.config.data.defaultVal.length){r.waitingInitDefault=!1;var e=[];r.config.data.defaultVal.forEach(function(t){e.push(t.id)}),e&&0<e.length&&(r.config.data.multipleSelect?(r.multiSelectVal=e,r.config.data.val=r.multiSelectVal):(r.singleSelectVal=e[0],r.config.data.val=r.singleSelectVal),c(function(){r.waitingInitDefault=!0},1e3))}if(isNotNull(r.config.data.defaultValText)&&0<r.config.data.defaultValText.length){r.waitingInitDefault=!1;e=[];r.config.data.defaultValText=r.config.data.defaultValText.replace(/，/g,","),(e=r.config.data.defaultValText.split(","))&&0<e.length&&(r.config.data.multipleSelect?(r.multiSelectVal=e,r.config.data.val=r.multiSelectVal):(r.singleSelectVal=e[0],r.config.data.val=r.singleSelectVal),c(function(){r.waitingInitDefault=!0},1e3))}}},!0),r.selectAll=function(){r.filterData="",startFilter(r.config,r.configitems,r.filterData)},r.changeSelect=function(t){r.reloadingDashboardStatus,r.filterData="",r.config.data.multipleSelect?((r.config.data.val=t).forEach(function(t){r.filterData=r.filterData+t+","}),0<r.filterData.length&&(r.filterData=r.filterData.substring(0,r.filterData.length-1))):(r.config.data.val=t,r.filterData=t),r.waitingInitDefault&&(startFilter(r.config,r.configitems,r.filterData),h.afterChange(r.configitems,r.config)),r.waitingInitDefault=!0}}"date"==r.config.data.dropType&&(r.config.data.defaultVal&&2==r.config.data.defaultVal.length&&(r.dateFilter.startDate=r.config.data.defaultVal[0],r.dateFilter.endDate=r.config.data.defaultVal[1]),r.selectDateChange=function(){""==r.dateFilter.startDate||""==r.dateFilter.endDate?r.dateFilter.startDate==r.dateFilter.endDate&&startFilter(r.config,r.configitems,r.dateFilter):new Date(r.dateFilter.startDate)>new Date(r.dateFilter.endDate)?(r.dateFilter.endDate="",alert("开始日期不得大于结束日期")):startFilter(r.config,r.configitems,r.dateFilter)})}if(r.isInitCommentsArea=!1,r.openLabelText=function(t){if(a<500)alert("页面高度不够，无法显示，请保证页面高度大于500像素");else if(chartLabelElement)chartLabelElement.remove(),chartLabelElement=null;else{r.config.data.commentsConfig.style=r.sceneOptions.options.commentsStyle,r.config.data.commentsConfig.comments.forEach(function(t,e,a){r.isExpandComments=!1,2<e&&(t.show=!1)}),r.updateCommentsFromServer(),r.loginUserName=dataXLoginUserInfo.username,"admin"==dataXLoginUserInfo.role&&(r.loginUserName="AnonymousUsers");var e=$(t.target).offset(),a=document.body.offsetHeight,n="";"phone"==terminalType&&(n="width:calc(100% - 70px);");var o="position:absolute;"+n+(e.top+30>a?"bottom:30px;":"bottom:"+(a-e.top-30)+"px;")+"left:"+(e.left+40)+"px;",i=chartLabelHtmlStr.replace("_style_",o),l=angular.element(i);chartLabelElement=s(l)(r),angular.element(document.body).append(chartLabelElement),c(function(){new PerfectScrollbar(".show-area")},2e3)}},r.startChartReply=function(){$(".reply-show-edit").hide(),$(".reply-edit-area").show()},r.postReplayByKey=function(t,e,a){13==t.keyCode&&(r.expandComments(),"update"==e?(a.status="edit",c(function(){r.updateCommentsFromServer()})):r.postReplay())},r.openBarrage=function(){r.config.data.commentsConfig.barrage&&(r.config.data.commentsConfig.barragerCount=0),barragerConfig(r.config)},r.postReplay=function(){if(r.replayText&&0<r.replayText.length){var t=dataXLoginUserInfo.username;"admin"==dataXLoginUserInfo.role&&(t="匿名"),r.config.data.commentsConfig.comments.unshift({id:generateUuid(32,16),user:t,date:dateFtt(),show:!0,text:r.replayText,status:"edit",rate:0,like:0,options:{}}),r.expandComments(),r.updateCommentsFromServer(),r.replayText="",$(".reply-show-edit").show(),$(".reply-edit-area").hide()}},r.delReplay=function(t){t.status="delete",r.expandComments(),r.updateCommentsFromServer()},r.updateCommentsFromServer=function(){"chart"==r.configType?quickSave(r.config,"echarts","singleItem","comments"):"table"==r.configType?quickSave(r.config,"table","singleItem","comments"):alert("读取组件类型失败,无法修改评论")},r.expandComments=function(){r.isExpandComments=!0,r.config.data.commentsConfig.comments.forEach(function(t,e,a){t.show=!0})},r.fullShowChart=function(){$(".full-screen-content").height(.98*document.body.clientHeight),$(".full-screen-content").show(),c(function(){var t=echarts.getInstanceByDom(n.find(".chart-content")[0]),e=echarts.init(document.getElementById("fullShowChart")),a=t.getOption();updateChartFontColor("echarts",a,"rgba(0, 0, 0, 1)"),e.setOption(a),e.off()})},r.config.data.datatype&&"table"==r.config.data.datatype){r.srollHeight=0,r.calcTableHeight=function(){r.itemTotalHeight=r.config.sizeY*r.rowHeight-40,r.config.data.jsonconfig.tableTitle&&1<r.config.data.jsonconfig.tableTitle.length&&(r.itemTotalHeight=r.itemTotalHeight-35)},r.calcTableHeight(),r.tableClass="scenes-table-"+r.componentUuid,r.tableBodyClass="scenes-table-body-"+r.componentUuid,r.tableObj={column:[],data:[],totalItems:0,page:1,limit:10,currentPageNum:5,totalPage:0},r.config.data.styleConfig.rowHeight&&10<r.config.data.styleConfig.rowHeight?r.tableRowHeight=r.config.data.styleConfig.rowHeight:r.tableRowHeight=35;var u=r.config.data.jsonconfig;r.config.data.styleConfig.editable?r.customConfig={editable:!0,customAfterchangeCode:r.config.data.styleConfig.afterChangeCode}:r.customConfig={editable:!1,customAfterchangeCode:""},r.queryList=function(a){var n="charts-"+r.config.data.id;dataxLoding.showLoading("charts-"+r.config.data.id),r.tableObj.heads=[],e({method:"POST",url:encodeURI(r.config.data.jsonconfig.data.url),headers:{"X-CSRFToken":getCookie("csrftoken")},data:{column:JSON.stringify(u.columns),olapid:u.olapid,limit:u.length,merge:u.merge,mergeCols:JSON.stringify(u.mergeCols),page:a}}).then(function(t){dataxLoding.hideLoading(n);var e=t.data;e.data&&0<=e.data.length&&(r.tableObj.column=u.columns,r.tableObj.data=e.data,r.tableObj.heads=angular.copy(r.config.data.jsonconfig.theads),r.tableObj.page=a,"number"==typeof e.total?r.tableObj.totalItems=e.total:"object"==typeof e.total?r.tableObj.totalItems=e.total.total:r.tableObj.totalItems=0,r.tableObj.limit=u.length,r.tableObj.totalPage=Math.ceil(e.total/u.length)),r.afterDataLoad({ev:{type:"table",data:r.config}})},function(t){r.afterDataLoad({ev:{type:"table",data:r.config}}),dataxLoding.hideLoading(n),console.error("与后台交互发生错误, 后台返回信息为:",t)})};var p=u.columns.length;u.fixColWidths&&u.fixColWidths.length==p||(u.fixColWidths=new Array(p),u.columns.forEach(function(t,e){u.fixColWidths[e]=0})),r.fixColWidths=u.fixColWidths.map(function(){return 0}),r.tableCellStyle=new Array(p),r.fixTableStyle=function(i){r.calcTableHeight();var t;r.config.sizeY,r.rowHeight;r.config.data.styleConfig.showPage,t="phone"==terminalType?$(n).find(".parent-content").width():(o.innerWidth/96).toFixed(2)*r.config.sizeX-20,r.columns=[],r.tempColumns=[],r.colInfos=r.config.data.jsonconfig.theads[r.config.data.jsonconfig.theads.length-1].rows,r.config.data.styleConfig.fullFix?r.unitWidth=(t/r.colInfos.length).toFixed(2):r.unitWidth=100,r.totalWidth=0,r.config.data.jsonconfig.theads.forEach(function(t,o){r.tempColumns.push({rows:[]}),t.rows.forEach(function(t,e){var a=t.colspan?t.colspan:"1",n={rowspan:t.rowspan?t.rowspan:"1",colspan:a,width:Number(r.unitWidth)+Number(i[e]),title:t.title?t.title:"",field:t.field?t.field:"",isedit:t.isedit?t.isedit:"0",format:t.format?t.format:""};o==r.config.data.jsonconfig.theads.length-1&&(r.config.data.styleConfig.fixedLeft&&0<r.config.data.styleConfig.fixedLeft&&e<r.config.data.styleConfig.fixedLeft&&(n.fixed="left"),r.totalWidth=r.totalWidth+Number(n.width)),r.tempColumns[o].rows.push(n)})});var e=((t-r.totalWidth)/r.colInfos.length).toFixed(2);(1<e||e<-1&&r.config.data.styleConfig.fullFix)&&r.tempColumns[r.tempColumns.length-1].rows.forEach(function(t){t.width=Number(t.width)+Number(e)}),r.columns=angular.copy(r.tempColumns),isNotNull(r.config.data.styleConfig.tableBorderColor)&&(r.dataTableStyle.tableStyle.borderColor=r.config.data.styleConfig.tableBorderColor),r.fixColWidth=function(t,e){u.fixColWidths[e]=t,r.fixTableStyle(u.fixColWidths)},c(function(){})},r.$watch("config.data.jsonconfig.data.url",function(){0<r.config.data.refreshCount&&r.queryList(1)}),r.$watch("config.data.styleConfig",function(t){isNotNull(t)&&isNotNull(t.tableBorderColor)&&isNotNull(r.dataTableStyle)&&isNotNull(r.dataTableStyle.tableStyle)&&(r.dataTableStyle.tableStyle.borderColor=t.tableBorderColor)}),r.$watch(function(){return r.config.data.refreshCount},function(t){0<r.config.data.refreshCount&&r.fixTableStyle(u.fixColWidths)}),r.$watch("scenesContentWidth",function(t){r.config&&(r.currentWidth=o.innerWidth,r.currentWidth==t&&c(function(){r.currentWidth==t&&r.fixTableStyle(u.fixColWidths)},1e3))})}if(r.config.data.datatype&&"chart"==r.config.data.datatype){if(!r.config.data.echartconfig)return;r.releaseLink=function(){r.config.data.link&&"linkStart"==r.config.data.link&&releaseSingleLink(r.config.data,r.configitems)},r.chartFontColor="",r.$watch("config.data.styleConfig",function(t){if("complete"==r.reloadingDashboardStatus&&0<r.config.data.refreshCount&&r.syncFontColor){var e="";if(e=t&&t.color&&7<t.color.length?t.color:$(".main-app-content").css("color"),r.chartFontColor!=e){r.chartFontColor=e;var a=JSON.parse(r.config.data.echartconfig);r.config.data.jsonconfig&&"single"==r.config.data.jsonconfig?updateChartFontColor("single",a,e):updateChartFontColor("echarts",a,e),r.config.data.echartconfig=JSON.stringify(a),r.config.data.refreshCount+=1}}},!0),r.$watch("config.data.refreshCount",function(t){0<r.config.data.refreshCount&&(r.ecconfig=JSON.parse(r.config.data.echartconfig),"string"==typeof r.ecconfig.data.url&&(dataxLoding.showLoading("charts-"+r.config.data.id),e.get(encodeURI(r.ecconfig.data.url)).then(function(t){r.config.data.lists=t.data,r.ecconfig.width=$(n).find(".parent-content").width(),r.ecconfig.height=r.config.sizeY*r.rowHeight-6,buildEchart(r.ecconfig,$(n).find(".chart-content"),r.config.data.lists,null,"dashbboard2",r.config,r.configitems),r.config.data.chartHeight=r.ecconfig.height,r.config.data.chartWidth=r.ecconfig.width,dataxLoding.hideLoading("charts-"+r.config.data.id),r.afterDataLoad({ev:{type:"chart",data:r.config}})},function(t){r.afterDataLoad({ev:{type:"chart",data:r.config}}),dataxLoding.hideLoading("charts-"+r.config.data.id),console.error("与后台交互发生错误, 后台返回信息为:",t)})))}),r.$watch("scenesContentWidth",function(t){0<r.scenesContentWidth&&0<r.config.data.refreshCount&&(r.currentWidth=o.innerWidth,c(function(){r.currentWidth==t&&($(n).find(".chart-content")[0].style.width="100%",$(n).find(".chart-content")[0].style.height="100%","single"!=r.config.data.jsonconfig&&echarts.getInstanceByDom($(n).find(".chart-content")[0])&&echarts.getInstanceByDom($(n).find(".chart-content")[0]).resize())},1e3))})}}}]}}])}(),function(){"use strict";angular.module("dashboard").directive("modal",["$document","Modals",function(o,i){return{templateUrl:"components/modal/modal.html",restrict:"E",transclude:!0,scope:{autoOpen:"<",maxWidth:"@"},controller:["$scope",function(t){this.close=function(){t.isOpen=!1}}],link:function(e,t,a){var n=a.id;e.maxWidth&&(e.wrapperStyle="max-width:"+e.maxWidth),e.isOpen=e.autoOpen,angular.element(o).on("keydown",function(t){27===t.keyCode&&e.isOpen&&(e.isOpen=!1,e.$digest())}),i.register(n,e),e.$on("$destroy",function(){i.deregister(n)})}}}])}(),function(){"use strict";angular.module("dashboard").directive("modalCloseButton",function(){return{templateUrl:"components/modal/modalclosebutton.html",restrict:"E",require:"^^modal",scope:{closeAction:"&"},link:function(t,e,a,n){t.closeModal=function(){n.close(),t.closeAction&&t.closeAction()}}}})}(),function(){"use strict";angular.module("dashboard").factory("Modals",["$cacheFactory",function(t){var a=t("modals");return{register:function(t,e){a.get(t)?console.error("Cannot register two modals with id "+t):a.put(t,e)},deregister:function(t){a.remove(t)},open:function(t){var e=a.get(t);e?e.isOpen=!0:console.error("Unregistered modal id "+t)},close:function(t){var e=a.get(t);e?e.isOpen=!1:console.error("Unregistered modal id "+t)},empty:function(){a.removeAll()},count:function(){return a.info().size}}}])}();