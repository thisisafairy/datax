!function(){(function(){function e(i,n){function o(e){if(o[e]!==h)return o[e];var i;if("bug-string-char-index"==e)i="a"!="a"[0];else if("json"==e)i=o("json-stringify")&&o("json-parse");else{var t,l='{"a":[1,true,false,null,"\\u0000\\b\\n\\f\\r\\t"]}';if("json-stringify"==e){var s=n.stringify,c="function"==typeof s&&b;if(c){(t=function(){return 1}).toJSON=t;try{c="0"===s(0)&&"0"===s(new a)&&'""'==s(new r)&&s(y)===h&&s(h)===h&&s()===h&&"1"===s(t)&&"[1]"==s([t])&&"[null]"==s([h])&&"null"==s(null)&&"[null,null,null]"==s([h,y,null])&&s({a:[t,!0,!1,null,"\0\b\n\f\r\t"]})==l&&"1"===s(null,t)&&"[\n 1,\n 2\n]"==s([1,2],null,1)&&'"-271821-04-20T00:00:00.000Z"'==s(new d((-864e13)))&&'"+275760-09-13T00:00:00.000Z"'==s(new d(864e13))&&'"-000001-01-01T00:00:00.000Z"'==s(new d((-621987552e5)))&&'"1969-12-31T23:59:59.999Z"'==s(new d((-1)))}catch(p){c=!1}}i=c}if("json-parse"==e){var f=n.parse;if("function"==typeof f)try{if(0===f("0")&&!f(!1)){t=f(l);var u=5==t.a.length&&1===t.a[0];if(u){try{u=!f('"\t"')}catch(p){}if(u)try{u=1!==f("01")}catch(p){}if(u)try{u=1!==f("1.")}catch(p){}}}}catch(p){u=!1}i=u}}return o[e]=!!i}i||(i=l.Object()),n||(n=l.Object());var a=i.Number||l.Number,r=i.String||l.String,s=i.Object||l.Object,d=i.Date||l.Date,c=i.SyntaxError||l.SyntaxError,p=i.TypeError||l.TypeError,f=i.Math||l.Math,u=i.JSON||l.JSON;"object"==typeof u&&u&&(n.stringify=u.stringify,n.parse=u.parse);var g,m,h,v=s.prototype,y=v.toString,b=new d((-0xc782b5b800cec));try{b=b.getUTCFullYear()==-109252&&0===b.getUTCMonth()&&1===b.getUTCDate()&&10==b.getUTCHours()&&37==b.getUTCMinutes()&&6==b.getUTCSeconds()&&708==b.getUTCMilliseconds()}catch(x){}var w="[object Function]",T="[object Date]",k="[object Number]",D="[object String]",O="[object Array]",S="[object Boolean]",A=o("bug-string-char-index");if(!b)var F=f.floor,C=[0,31,59,90,120,151,181,212,243,273,304,334],E=function(e,i){return C[i]+365*(e-1970)+F((e-1969+(i=+(i>1)))/4)-F((e-1901+i)/100)+F((e-1601+i)/400)};(g=v.hasOwnProperty)||(g=function(e){var i,t={};return(t.__proto__=null,t.__proto__={toString:1},t).toString!=y?g=function(e){var i=this.__proto__,t=e in(this.__proto__=null,this);return this.__proto__=i,t}:(i=t.constructor,g=function(e){var t=(this.constructor||i).prototype;return e in this&&!(e in t&&this[e]===t[e])}),t=null,g.call(this,e)}),m=function(e,i){var n,l,o,a=0;(n=function(){this.valueOf=0}).prototype.valueOf=0,l=new n;for(o in l)g.call(l,o)&&a++;return n=l=null,a?m=2==a?function(e,i){var t,n={},l=y.call(e)==w;for(t in e)l&&"prototype"==t||g.call(n,t)||!(n[t]=1)||!g.call(e,t)||i(t)}:function(e,i){var t,n,l=y.call(e)==w;for(t in e)l&&"prototype"==t||!g.call(e,t)||(n="constructor"===t)||i(t);(n||g.call(e,t="constructor"))&&i(t)}:(l=["valueOf","toString","toLocaleString","propertyIsEnumerable","isPrototypeOf","hasOwnProperty","constructor"],m=function(e,i){var n,o,a=y.call(e)==w,r=!a&&"function"!=typeof e.constructor&&t[typeof e.hasOwnProperty]&&e.hasOwnProperty||g;for(n in e)a&&"prototype"==n||!r.call(e,n)||i(n);for(o=l.length;n=l[--o];r.call(e,n)&&i(n));}),m(e,i)};var I={92:"\\\\",34:'\\"',8:"\\b",12:"\\f",10:"\\n",13:"\\r",9:"\\t"},_="000000",N=function(e,i){return(_+(i||0)).slice(-e)},L="\\u00",$=function(e){for(var i='"',t=0,n=e.length,l=!A||n>10,o=l&&(A?e.split(""):e);t<n;t++){var a=e.charCodeAt(t);switch(a){case 8:case 9:case 10:case 12:case 13:case 34:case 92:i+=I[a];break;default:if(a<32){i+=L+N(2,a.toString(16));break}i+=l?o[t]:e.charAt(t)}}return i+'"'},R=function(e,i,t,n,l,o,a,r){var s,d,c,f,u,v,b,x,w,A,C,I,_,L,M,j;r=r||0;try{s=i[e]}catch(z){}if("object"==typeof s&&s)if(d=y.call(s),d!=T||g.call(s,"toJSON"))"function"==typeof s.toJSON&&(d!=k&&d!=D&&d!=O||g.call(s,"toJSON"))&&(s=s.toJSON(e));else if(s>-1/0&&s<1/0){if(E){for(u=F(s/864e5),c=F(u/365.2425)+1970-1;E(c+1,0)<=u;c++);for(f=F((u-E(c,0))/30.42);E(c,f+1)<=u;f++);u=1+u-E(c,f),v=(s%864e5+864e5)%864e5,b=F(v/36e5)%24,x=F(v/6e4)%60,w=F(v/1e3)%60,A=v%1e3}else c=s.getUTCFullYear(),f=s.getUTCMonth(),u=s.getUTCDate(),b=s.getUTCHours(),x=s.getUTCMinutes(),w=s.getUTCSeconds(),A=s.getUTCMilliseconds();s=(c<=0||c>=1e4?(c<0?"-":"+")+N(6,c<0?-c:c):N(4,c))+"-"+N(2,f+1)+"-"+N(2,u)+"T"+N(2,b)+":"+N(2,x)+":"+N(2,w)+"."+N(3,A)+"Z"}else s=null;if(t&&(s=t.call(i,e,s)),null===s)return"null";if(d=y.call(s),d==S)return""+s;if(d==k)return s>-1/0&&s<1/0?""+s:"null";if(d==D)return $(""+s);if("object"==typeof s){for(L=a.length;L--;)if(a[L]===s)throw p();if(a.push(s),C=[],M=o,o+=l,d==O){var j,q=o.length;for(_=0,L=s.length;_<L;_++)I=R(_,s,t,n,l,o,a,r),j=I===h?"null":I,q+=j.length+(_>0?1:0),C.push(j);j=C.length?l&&q>r?"[\n"+o+C.join(",\n"+o)+"\n"+M+"]":"["+C.join(",")+"]":"[]"}else{var q=o.length,_=0;m(n||s,function(e){var i,d=R(e,s,t,n,l,o,a,r);d!==h&&(i=$(e)+":"+(l?" ":"")+d,q+=i.length+(_++>0?1:0),C.push(i))}),j=C.length?l&&q>r?"{\n"+o+C.join(",\n"+o)+"\n"+M+"}":"{"+C.join(",")+"}":"{}"}return a.pop(),j}};if(n.stringify=function(e,i,n,l){var o,a,r,s;if(t[typeof i]&&i)if((s=y.call(i))==w)a=i;else if(s==O){r={};for(var d,c=0,p=i.length;c<p;d=i[c++],s=y.call(d),(s==D||s==k)&&(r[d]=1));}if(n)if((s=y.call(n))==k){if((n-=n%1)>0)for(o="",n>10&&(n=10);o.length<n;o+=" ");}else s==D&&(o=n.length<=10?n:n.slice(0,10));return R("",(d={},d[""]=e,d),a,r,o,"",[],l)},n.compactStringify=function(e,i,t){return n.stringify(e,i,t,60)},!o("json-parse")){var M,j,z=r.fromCharCode,q={92:"\\",34:'"',47:"/",98:"\b",116:"\t",110:"\n",102:"\f",114:"\r"},U=function(){throw M=j=null,c()},P=function(){for(var e,i,t,n,l,o=j,a=o.length;M<a;)switch(l=o.charCodeAt(M)){case 9:case 10:case 13:case 32:M++;break;case 123:case 125:case 91:case 93:case 58:case 44:return e=A?o.charAt(M):o[M],M++,e;case 34:for(e="@",M++;M<a;)if(l=o.charCodeAt(M),l<32)U();else if(92==l)switch(l=o.charCodeAt(++M)){case 92:case 34:case 47:case 98:case 116:case 110:case 102:case 114:e+=q[l],M++;break;case 117:for(i=++M,t=M+4;M<t;M++)l=o.charCodeAt(M),l>=48&&l<=57||l>=97&&l<=102||l>=65&&l<=70||U();e+=z("0x"+o.slice(i,M));break;default:U()}else{if(34==l)break;for(l=o.charCodeAt(M),i=M;l>=32&&92!=l&&34!=l;)l=o.charCodeAt(++M);e+=o.slice(i,M)}if(34==o.charCodeAt(M))return M++,e;U();default:if(i=M,45==l&&(n=!0,l=o.charCodeAt(++M)),l>=48&&l<=57){for(48==l&&(l=o.charCodeAt(M+1),l>=48&&l<=57)&&U(),n=!1;M<a&&(l=o.charCodeAt(M),l>=48&&l<=57);M++);if(46==o.charCodeAt(M)){for(t=++M;t<a&&(l=o.charCodeAt(t),l>=48&&l<=57);t++);t==M&&U(),M=t}if(l=o.charCodeAt(M),101==l||69==l){for(l=o.charCodeAt(++M),43!=l&&45!=l||M++,t=M;t<a&&(l=o.charCodeAt(t),l>=48&&l<=57);t++);t==M&&U(),M=t}return+o.slice(i,M)}if(n&&U(),"true"==o.slice(M,M+4))return M+=4,!0;if("false"==o.slice(M,M+5))return M+=5,!1;if("null"==o.slice(M,M+4))return M+=4,null;U()}return"$"},W=function(e){var i,t;if("$"==e&&U(),"string"==typeof e){if("@"==(A?e.charAt(0):e[0]))return e.slice(1);if("["==e){for(i=[];e=P(),"]"!=e;t||(t=!0))t&&(","==e?(e=P(),"]"==e&&U()):U()),","==e&&U(),i.push(W(e));return i}if("{"==e){for(i={};e=P(),"}"!=e;t||(t=!0))t&&(","==e?(e=P(),"}"==e&&U()):U()),","!=e&&"string"==typeof e&&"@"==(A?e.charAt(0):e[0])&&":"==P()||U(),i[e.slice(1)]=W(P());return i}U()}return e},B=function(e,i,t){var n=G(e,i,t);n===h?delete e[i]:e[i]=n},G=function(e,i,t){var n,l=e[i];if("object"==typeof l&&l)if(y.call(l)==O)for(n=l.length;n--;)B(l,n,t);else m(l,function(e){B(l,e,t)});return t.call(e,i,l)};n.parse=function(e,i){var t,n;return M=0,j=""+e,t=W(P()),"$"!=P()&&U(),M=j=null,i&&y.call(i)==w?G((n={},n[""]=t,n),"",i):t}}return n.runInContext=e,n}var i="function"==typeof define&&define.amd,t={"function":!0,object:!0},n=t[typeof exports]&&exports&&!exports.nodeType&&exports,l=t[typeof window]&&window||this,o=n&&t[typeof module]&&module&&!module.nodeType&&"object"==typeof global&&global;if(!o||o.global!==o&&o.window!==o&&o.self!==o||(l=o),n&&!i)e(l,n);else{var a=l.JSON,r=l.JSON3,s=!1,d=e(l,l.JSON3={noConflict:function(){return s||(s=!0,l.JSON=a,l.JSON3=r,a=r=null),d}});l.JSON={parse:d.parse,stringify:d.stringify}}i&&define(function(){return d})}).call(this)}(),function(){window.vlSchema={oneOf:[{$ref:"#/definitions/ExtendedUnitSpec",description:"Schema for a unit Vega-Lite specification, with the syntactic sugar extensions:\n\n- `row` and `column` are included in the encoding.\n\n- (Future) label, box plot\n\n\n\nNote: the spec could contain facet."},{$ref:"#/definitions/FacetSpec"},{$ref:"#/definitions/LayerSpec"}],definitions:{ExtendedUnitSpec:{type:"object",properties:{mark:{$ref:"#/definitions/Mark",description:'The mark type.\n\nOne of `"bar"`, `"circle"`, `"square"`, `"tick"`, `"line"`,\n\n`"area"`, `"point"`, `"rule"`, and `"text"`.'},encoding:{$ref:"#/definitions/Encoding",description:"A key-value mapping between encoding channels and definition of fields."},name:{description:"Name of the visualization for later reference.",type:"string"},description:{description:"An optional description of this mark for commenting purpose.\n\nThis property has no effect on the output visualization.",type:"string"},data:{$ref:"#/definitions/Data",description:"An object describing the data source"},transform:{$ref:"#/definitions/Transform",description:"An object describing filter and new field calculation."},config:{$ref:"#/definitions/Config",description:"Configuration object"}},required:["mark"]},Mark:{type:"string","enum":["area","bar","line","point","text","tick","rule","circle","square","errorBar"]},Encoding:{type:"object",properties:{row:{$ref:"#/definitions/PositionChannelDef",description:"Vertical facets for trellis plots."},column:{$ref:"#/definitions/PositionChannelDef",description:"Horizontal facets for trellis plots."},x:{$ref:"#/definitions/PositionChannelDef",description:"X coordinates for `point`, `circle`, `square`,\n\n`line`, `rule`, `text`, and `tick`\n\n(or to width and height for `bar` and `area` marks)."},y:{$ref:"#/definitions/PositionChannelDef",description:"Y coordinates for `point`, `circle`, `square`,\n\n`line`, `rule`, `text`, and `tick`\n\n(or to width and height for `bar` and `area` marks)."},x2:{$ref:"#/definitions/PositionChannelDef",description:"X2 coordinates for ranged `bar`, `rule`, `area`"},y2:{$ref:"#/definitions/PositionChannelDef",description:"Y2 coordinates for ranged `bar`, `rule`, `area`"},color:{$ref:"#/definitions/ChannelDefWithLegend",description:"Color of the marks – either fill or stroke color based on mark type.\n\n(By default, fill color for `area`, `bar`, `tick`, `text`, `circle`, and `square` /\n\nstroke color for `line` and `point`.)"},opacity:{$ref:"#/definitions/ChannelDefWithLegend",description:"Opacity of the marks – either can be a value or in a range."},size:{$ref:"#/definitions/ChannelDefWithLegend",description:"Size of the mark.\n\n- For `point`, `square` and `circle`\n\n– the symbol size, or pixel area of the mark.\n\n- For `bar` and `tick` – the bar and tick's size.\n\n- For `text` – the text's font size.\n\n- Size is currently unsupported for `line` and `area`."},shape:{$ref:"#/definitions/ChannelDefWithLegend",description:'The symbol\'s shape (only for `point` marks). The supported values are\n\n`"circle"` (default), `"square"`, `"cross"`, `"diamond"`, `"triangle-up"`,\n\nor `"triangle-down"`, or else a custom SVG path string.'},detail:{description:"Additional levels of detail for grouping data in aggregate views and\n\nin line and area marks without mapping data to a specific visual channel.",oneOf:[{$ref:"#/definitions/FieldDef",description:"Interface for any kind of FieldDef;\n\nFor simplicity, we do not declare multiple interfaces of FieldDef like\n\nwe do for JSON schema."},{type:"array",items:{$ref:"#/definitions/FieldDef",description:"Interface for any kind of FieldDef;\n\nFor simplicity, we do not declare multiple interfaces of FieldDef like\n\nwe do for JSON schema."}}]},text:{$ref:"#/definitions/FieldDef",description:"Text of the `text` mark."},label:{$ref:"#/definitions/FieldDef"},path:{description:"Order of data points in line marks.",oneOf:[{$ref:"#/definitions/OrderChannelDef"},{type:"array",items:{$ref:"#/definitions/OrderChannelDef"}}]},order:{description:"Layer order for non-stacked marks, or stack order for stacked marks.",oneOf:[{$ref:"#/definitions/OrderChannelDef"},{type:"array",items:{$ref:"#/definitions/OrderChannelDef"}}]}}},PositionChannelDef:{type:"object",properties:{axis:{oneOf:[{type:"boolean"},{$ref:"#/definitions/Axis"}]},scale:{$ref:"#/definitions/Scale"},sort:{oneOf:[{$ref:"#/definitions/SortField"},{$ref:"#/definitions/SortOrder"}]},field:{description:"Name of the field from which to pull a data value.",type:"string"},type:{$ref:"#/definitions/Type",description:'The encoded field\'s type of measurement. This can be either a full type\n\nname (`"quantitative"`, `"temporal"`, `"ordinal"`,  and `"nominal"`)\n\nor an initial character of the type name (`"Q"`, `"T"`, `"O"`, `"N"`).\n\nThis property is case insensitive.'},value:{description:"A constant value in visual domain.",oneOf:[{type:"number"},{type:"string"},{type:"boolean"}]},timeUnit:{$ref:"#/definitions/TimeUnit",description:"Time unit for a `temporal` field  (e.g., `year`, `yearmonth`, `month`, `hour`)."},bin:{description:"Flag for binning a `quantitative` field, or a bin property object\n\nfor binning parameters.",oneOf:[{type:"boolean"},{$ref:"#/definitions/Bin",description:"Binning properties or boolean flag for determining whether to bin data or not."}]},aggregate:{$ref:"#/definitions/AggregateOp",description:"Aggregation function for the field\n\n(e.g., `mean`, `sum`, `median`, `min`, `max`, `count`)."},title:{description:"Title for axis or legend.",type:"string"}}},Axis:{type:"object",properties:{labelAngle:{description:"The rotation angle of the axis labels.",type:"number"},format:{description:"The formatting pattern for axis labels.",type:"string"},orient:{$ref:"#/definitions/AxisOrient",description:"The orientation of the axis. One of top, bottom, left or right. The orientation can be used to further specialize the axis type (e.g., a y axis oriented for the right edge of the chart)."},title:{description:"A title for the axis. Shows field name and its function by default.",type:"string"},values:{type:"array",items:{type:"number"}},axisWidth:{description:"Width of the axis line",type:"number"},layer:{description:"A string indicating if the axis (and any gridlines) should be placed above or below the data marks.",type:"string"},offset:{description:"The offset, in pixels, by which to displace the axis from the edge of the enclosing group or data rectangle.",type:"number"},axisColor:{description:"Color of axis line.",type:"string"},grid:{description:"A flag indicate if gridlines should be created in addition to ticks. If `grid` is unspecified, the default value is `true` for ROW and COL. For X and Y, the default value is `true` for quantitative and time fields and `false` otherwise.",type:"boolean"},gridColor:{description:"Color of gridlines.",type:"string"},gridDash:{description:"The offset (in pixels) into which to begin drawing with the grid dash array.",type:"array",items:{type:"number"}},gridOpacity:{description:"The stroke opacity of grid (value between [0,1])",type:"number"},gridWidth:{description:"The grid width, in pixels.",type:"number"},labels:{description:"Enable or disable labels.",type:"boolean"},labelAlign:{description:"Text alignment for the Label.",type:"string"},labelBaseline:{description:"Text baseline for the label.",type:"string"},labelMaxLength:{description:"Truncate labels that are too long.",minimum:1,type:"number"},shortTimeLabels:{description:"Whether month and day names should be abbreviated.",type:"boolean"},subdivide:{description:"If provided, sets the number of minor ticks between major ticks (the value 9 results in decimal subdivision). Only applicable for axes visualizing quantitative scales.",type:"number"},ticks:{description:'A desired number of ticks, for axes visualizing quantitative scales. The resulting number may be different so that values are "nice" (multiples of 2, 5, 10) and lie within the underlying scale\'s range.',minimum:0,type:"number"},tickColor:{description:"The color of the axis's tick.",type:"string"},tickLabelColor:{description:"The color of the tick label, can be in hex color code or regular color name.",type:"string"},tickLabelFont:{description:"The font of the tick label.",type:"string"},tickLabelFontSize:{description:"The font size of label, in pixels.",type:"number"},tickPadding:{description:"The padding, in pixels, between ticks and text labels.",type:"number"},tickSize:{description:"The size, in pixels, of major, minor and end ticks.",minimum:0,type:"number"},tickSizeMajor:{description:"The size, in pixels, of major ticks.",minimum:0,type:"number"},tickSizeMinor:{description:"The size, in pixels, of minor ticks.",minimum:0,type:"number"},tickSizeEnd:{description:"The size, in pixels, of end ticks.",minimum:0,type:"number"},tickWidth:{description:"The width, in pixels, of ticks.",type:"number"},titleColor:{description:"Color of the title, can be in hex color code or regular color name.",type:"string"},titleFont:{description:"Font of the title.",type:"string"},titleFontSize:{description:"Size of the title.",type:"number"},titleFontWeight:{description:"Weight of the title.",type:"string"},titleOffset:{description:"A title offset value for the axis.",type:"number"},titleMaxLength:{description:"Max length for axis title if the title is automatically generated from the field's description. By default, this is automatically based on cell size and characterWidth property.",minimum:0,type:"number"},characterWidth:{description:"Character width for automatically determining title max length.",type:"number"},properties:{description:"Optional mark property definitions for custom axis styling."}}},AxisOrient:{type:"string","enum":["top","right","left","bottom"]},Scale:{type:"object",properties:{type:{$ref:"#/definitions/ScaleType"},domain:{description:"The domain of the scale, representing the set of data values. For quantitative data, this can take the form of a two-element array with minimum and maximum values. For ordinal/categorical data, this may be an array of valid input values.",oneOf:[{type:"array",items:{type:"number"}},{type:"array",items:{type:"string"}}]},range:{description:"The range of the scale, representing the set of visual values. For numeric values, the range can take the form of a two-element array with minimum and maximum values. For ordinal or quantized data, the range may by an array of desired output values, which are mapped to elements in the specified domain. For ordinal scales only, the range can be defined using a DataRef: the range values are then drawn dynamically from a backing data set.",oneOf:[{type:"string"},{type:"array",items:{type:"number"}},{type:"array",items:{type:"string"}}]},round:{description:"If true, rounds numeric output values to integers. This can be helpful for snapping to the pixel grid.",type:"boolean"},bandSize:{minimum:0,type:"number"},padding:{description:"Applies spacing among ordinal elements in the scale range. The actual effect depends on how the scale is configured. If the __points__ parameter is `true`, the padding value is interpreted as a multiple of the spacing between points. A reasonable value is 1.0, such that the first and last point will be offset from the minimum and maximum value by half the distance between points. Otherwise, padding is typically in the range [0, 1] and corresponds to the fraction of space in the range interval to allocate to padding. A value of 0.5 means that the range band width will be equal to the padding width. For more, see the [D3 ordinal scale documentation](https://github.com/mbostock/d3/wiki/Ordinal-Scales).",type:"number"},clamp:{description:"If true, values that exceed the data domain are clamped to either the minimum or maximum range value",type:"boolean"},nice:{description:"If specified, modifies the scale domain to use a more human-friendly value range. If specified as a true boolean, modifies the scale domain to use a more human-friendly number range (e.g., 7 instead of 6.96). If specified as a string, modifies the scale domain to use a more human-friendly value range. For time and utc scale types only, the nice value should be a string indicating the desired time interval.",oneOf:[{type:"boolean"},{$ref:"#/definitions/NiceTime"}]},exponent:{description:"Sets the exponent of the scale transformation. For pow scale types only, otherwise ignored.",type:"number"},zero:{description:"If `true`, ensures that a zero baseline value is included in the scale domain.\n\nDefault value: `true` for `x` and `y` channel if the quantitative field is not binned\n\nand no custom `domain` is provided; `false` otherwise.",type:"boolean"},useRawDomain:{description:'Uses the source data range as scale domain instead of aggregated data for aggregate axis.\n\nThis property only works with aggregate functions that produce values within the raw data domain (`"mean"`, `"average"`, `"stdev"`, `"stdevp"`, `"median"`, `"q1"`, `"q3"`, `"min"`, `"max"`). For other aggregations that produce values outside of the raw data domain (e.g. `"count"`, `"sum"`), this property is ignored.',type:"boolean"}}},ScaleType:{type:"string","enum":["linear","log","pow","sqrt","quantile","quantize","ordinal","time","utc"]},NiceTime:{type:"string","enum":["second","minute","hour","day","week","month","year"]},SortField:{type:"object",properties:{field:{description:"The field name to aggregate over.",type:"string"},op:{$ref:"#/definitions/AggregateOp",description:"The sort aggregation operator"},order:{$ref:"#/definitions/SortOrder"}},required:["field","op"]},AggregateOp:{type:"string","enum":["values","count","valid","missing","distinct","sum","mean","average","variance","variancep","stdev","stdevp","median","q1","q3","modeskew","min","max","argmin","argmax"]},SortOrder:{type:"string","enum":["ascending","descending","none"]},Type:{type:"string","enum":["quantitative","ordinal","temporal","nominal"]},TimeUnit:{type:"string","enum":["year","month","day","date","hours","minutes","seconds","milliseconds","yearmonth","yearmonthdate","yearmonthdatehours","yearmonthdatehoursminutes","yearmonthdatehoursminutesseconds","hoursminutes","hoursminutesseconds","minutesseconds","secondsmilliseconds","quarter","yearquarter","quartermonth","yearquartermonth"]},Bin:{type:"object",properties:{min:{description:"The minimum bin value to consider. If unspecified, the minimum value of the specified field is used.",type:"number"},max:{description:"The maximum bin value to consider. If unspecified, the maximum value of the specified field is used.",type:"number"},base:{description:"The number base to use for automatic bin determination (default is base 10).",type:"number"},step:{description:"An exact step size to use between bins. If provided, options such as maxbins will be ignored.",type:"number"},steps:{description:"An array of allowable step sizes to choose from.",type:"array",items:{type:"number"}},minstep:{description:"A minimum allowable step size (particularly useful for integer values).",type:"number"},div:{description:"Scale factors indicating allowable subdivisions. The default value is [5, 2], which indicates that for base 10 numbers (the default base), the method may consider dividing bin sizes by 5 and/or 2. For example, for an initial step size of 10, the method can check if bin sizes of 2 (= 10/5), 5 (= 10/2), or 1 (= 10/(5*2)) might also satisfy the given constraints.",type:"array",items:{type:"number"}},maxbins:{description:"Maximum number of bins.",minimum:2,type:"number"}}},ChannelDefWithLegend:{type:"object",properties:{legend:{$ref:"#/definitions/Legend"},scale:{$ref:"#/definitions/Scale"},sort:{oneOf:[{$ref:"#/definitions/SortField"},{$ref:"#/definitions/SortOrder"}]},field:{description:"Name of the field from which to pull a data value.",type:"string"},type:{$ref:"#/definitions/Type",description:'The encoded field\'s type of measurement. This can be either a full type\n\nname (`"quantitative"`, `"temporal"`, `"ordinal"`,  and `"nominal"`)\n\nor an initial character of the type name (`"Q"`, `"T"`, `"O"`, `"N"`).\n\nThis property is case insensitive.'},value:{description:"A constant value in visual domain.",oneOf:[{type:"number"},{type:"string"},{type:"boolean"}]},timeUnit:{$ref:"#/definitions/TimeUnit",description:"Time unit for a `temporal` field  (e.g., `year`, `yearmonth`, `month`, `hour`)."},bin:{description:"Flag for binning a `quantitative` field, or a bin property object\n\nfor binning parameters.",oneOf:[{type:"boolean"},{$ref:"#/definitions/Bin",description:"Binning properties or boolean flag for determining whether to bin data or not."}]},aggregate:{$ref:"#/definitions/AggregateOp",description:"Aggregation function for the field\n\n(e.g., `mean`, `sum`, `median`, `min`, `max`, `count`)."},title:{description:"Title for axis or legend.",type:"string"}}},Legend:{type:"object",properties:{format:{description:"An optional formatting pattern for legend labels. Vega uses D3\\'s format pattern.",type:"string"},title:{description:"A title for the legend. (Shows field name and its function by default.)",type:"string"},values:{description:"Explicitly set the visible legend values.",type:"array",items:{}},orient:{description:'The orientation of the legend. One of "left" or "right". This determines how the legend is positioned within the scene. The default is "right".',type:"string"},offset:{description:"The offset, in pixels, by which to displace the legend from the edge of the enclosing group or data rectangle.",type:"number"},padding:{description:"The padding, in pixels, between the lengend and axis.",type:"number"},margin:{description:"The margin around the legend, in pixels",type:"number"},gradientStrokeColor:{description:"The color of the gradient stroke, can be in hex color code or regular color name.",type:"string"},gradientStrokeWidth:{description:"The width of the gradient stroke, in pixels.",type:"number"},gradientHeight:{description:"The height of the gradient, in pixels.",type:"number"},gradientWidth:{description:"The width of the gradient, in pixels.",type:"number"},labelAlign:{description:"The alignment of the legend label, can be left, middle or right.",type:"string"},labelBaseline:{description:"The position of the baseline of legend label, can be top, middle or bottom.",type:"string"},labelColor:{description:"The color of the legend label, can be in hex color code or regular color name.",type:"string"},labelFont:{description:"The font of the lengend label.",type:"string"},labelFontSize:{description:"The font size of lengend lable.",type:"number"},labelOffset:{description:"The offset of the legend label.",type:"number"},shortTimeLabels:{description:"Whether month names and weekday names should be abbreviated.",type:"boolean"},symbolColor:{description:"The color of the legend symbol,",type:"string"},symbolShape:{description:"The shape of the legend symbol, can be the 'circle', 'square', 'cross', 'diamond',\n\n'triangle-up', 'triangle-down', or else a custom SVG path string.",type:"string"},symbolSize:{description:"The size of the lengend symbol, in pixels.",type:"number"},symbolStrokeWidth:{description:"The width of the symbol's stroke.",type:"number"},titleColor:{description:"Optional mark property definitions for custom legend styling.\n\nThe color of the legend title, can be in hex color code or regular color name.",type:"string"},titleFont:{description:"The font of the legend title.",type:"string"},titleFontSize:{description:"The font size of the legend title.",type:"number"},titleFontWeight:{description:"The font weight of the legend title.",type:"string"},properties:{description:"Optional mark property definitions for custom legend styling."}}},FieldDef:{type:"object",properties:{field:{description:"Name of the field from which to pull a data value.",type:"string"},type:{$ref:"#/definitions/Type",description:'The encoded field\'s type of measurement. This can be either a full type\n\nname (`"quantitative"`, `"temporal"`, `"ordinal"`,  and `"nominal"`)\n\nor an initial character of the type name (`"Q"`, `"T"`, `"O"`, `"N"`).\n\nThis property is case insensitive.'},value:{description:"A constant value in visual domain.",oneOf:[{type:"number"},{type:"string"},{type:"boolean"}]},timeUnit:{$ref:"#/definitions/TimeUnit",description:"Time unit for a `temporal` field  (e.g., `year`, `yearmonth`, `month`, `hour`)."},bin:{description:"Flag for binning a `quantitative` field, or a bin property object\n\nfor binning parameters.",oneOf:[{type:"boolean"},{$ref:"#/definitions/Bin",description:"Binning properties or boolean flag for determining whether to bin data or not."}]},aggregate:{$ref:"#/definitions/AggregateOp",description:"Aggregation function for the field\n\n(e.g., `mean`, `sum`, `median`, `min`, `max`, `count`)."},title:{description:"Title for axis or legend.",type:"string"}}},OrderChannelDef:{type:"object",properties:{sort:{$ref:"#/definitions/SortOrder"},field:{description:"Name of the field from which to pull a data value.",type:"string"},type:{$ref:"#/definitions/Type",description:'The encoded field\'s type of measurement. This can be either a full type\n\nname (`"quantitative"`, `"temporal"`, `"ordinal"`,  and `"nominal"`)\n\nor an initial character of the type name (`"Q"`, `"T"`, `"O"`, `"N"`).\n\nThis property is case insensitive.'},value:{description:"A constant value in visual domain.",oneOf:[{type:"number"},{type:"string"},{type:"boolean"}]},timeUnit:{$ref:"#/definitions/TimeUnit",description:"Time unit for a `temporal` field  (e.g., `year`, `yearmonth`, `month`, `hour`)."},bin:{description:"Flag for binning a `quantitative` field, or a bin property object\n\nfor binning parameters.",oneOf:[{type:"boolean"},{$ref:"#/definitions/Bin",description:"Binning properties or boolean flag for determining whether to bin data or not."}]},aggregate:{$ref:"#/definitions/AggregateOp",description:"Aggregation function for the field\n\n(e.g., `mean`, `sum`, `median`, `min`, `max`, `count`)."},title:{description:"Title for axis or legend.",type:"string"}}},Data:{type:"object",properties:{format:{$ref:"#/definitions/DataFormat",description:"An object that specifies the format for the data file or values."},url:{description:"A URL from which to load the data set. Use the format.type property\n\nto ensure the loaded data is correctly parsed.",type:"string"},values:{description:"Pass array of objects instead of a url to a file.",type:"array",items:{}}}},DataFormat:{type:"object",properties:{type:{$ref:"#/definitions/DataFormatType",description:'Type of input data: `"json"`, `"csv"`, `"tsv"`.\n\nThe default format type is determined by the extension of the file url.\n\nIf no extension is detected, `"json"` will be used by default.'},property:{description:'JSON only) The JSON property containing the desired data.\n\nThis parameter can be used when the loaded JSON file may have surrounding structure or meta-data.\n\nFor example `"property": "values.features"` is equivalent to retrieving `json.values.features`\n\nfrom the loaded JSON object.',type:"string"},feature:{description:'The name of the TopoJSON object set to convert to a GeoJSON feature collection.\n\nFor example, in a map of the world, there may be an object set named `"countries"`.\n\nUsing the feature property, we can extract this set and generate a GeoJSON feature object for each country.',type:"string"},mesh:{description:"The name of the TopoJSON object set to convert to a mesh.\n\nSimilar to the `feature` option, `mesh` extracts a named TopoJSON object set.\n\nUnlike the `feature` option, the corresponding geo data is returned as a single, unified mesh instance, not as inidividual GeoJSON features.\n\nExtracting a mesh is useful for more efficiently drawing borders or other geographic elements that you do not need to associate with specific regions such as individual countries, states or counties.",type:"string"}}},DataFormatType:{type:"string","enum":["json","csv","tsv","topojson"]},Transform:{type:"object",properties:{filter:{description:"A string containing the filter Vega expression. Use `datum` to refer to the current data object.",
oneOf:[{type:"string"},{$ref:"#/definitions/EqualFilter"},{$ref:"#/definitions/RangeFilter"},{$ref:"#/definitions/InFilter"},{type:"array",items:{oneOf:[{type:"string"},{$ref:"#/definitions/EqualFilter"},{$ref:"#/definitions/RangeFilter"},{$ref:"#/definitions/InFilter"}]}}]},filterInvalid:{description:"Whether to filter invalid values (`null` and `NaN`) from the data. By default (`undefined`), only quantitative and temporal fields are filtered. If set to `true`, all data items with null values are filtered. If `false`, all data items are included.",type:"boolean"},calculate:{description:"Calculate new field(s) using the provided expresssion(s). Calculation are applied before filter.",type:"array",items:{$ref:"#/definitions/Formula",description:"Formula object for calculate."}}}},EqualFilter:{type:"object",properties:{timeUnit:{$ref:"#/definitions/TimeUnit",description:"Time unit for the field to be filtered."},field:{description:"Field to be filtered.",type:"string"},equal:{description:"Value that the field should be equal to.",oneOf:[{type:"string"},{type:"number"},{type:"boolean"},{$ref:"#/definitions/DateTime",description:"Object for defining datetime in Vega-Lite Filter.\n\nIf both month and quarter are provided, month has higher precedence.\n\n`day` cannot be combined with other date.\n\nWe accept string for month and day names."}]}},required:["field","equal"]},DateTime:{type:"object",properties:{year:{description:"Integer value representing the year.",type:"number"},quarter:{description:"Integer value representing the quarter of the year (from 1-4).",type:"number"},month:{description:'One of: (1) integer value representing the month from `1`-`12`. `1` represents January;  (2) case-insensitive month name (e.g., `"January"`);  (3) case-insensitive, 3-character short month name (e.g., `"Jan"`).',oneOf:[{type:"number"},{type:"string"}]},date:{description:"Integer value representing the date from 1-31.",type:"number"},day:{description:'Value representing the day of week.  This can be one of: (1) integer value -- `1` represents Monday; (2) case-insensitive day name (e.g., `"Monday"`);  (3) case-insensitive, 3-character short day name (e.g., `"Mon"`).   <br/> **Warning:** A DateTime definition object with `day`** should not be combined with `year`, `quarter`, `month`, or `date`.',oneOf:[{type:"number"},{type:"string"}]},hours:{description:"Integer value representing the hour of day from 0-23.",type:"number"},minutes:{description:"Integer value representing minute segment of a time from 0-59.",type:"number"},seconds:{description:"Integer value representing second segment of a time from 0-59.",type:"number"},milliseconds:{description:"Integer value representing millisecond segment of a time.",type:"number"}}},RangeFilter:{type:"object",properties:{timeUnit:{$ref:"#/definitions/TimeUnit",description:"time unit for the field to be filtered."},field:{description:"Field to be filtered",type:"string"},range:{description:"Array of inclusive minimum and maximum values\n\nfor a field value of a data item to be included in the filtered data.",maxItems:2,minItems:2,type:"array",items:{oneOf:[{type:"number"},{$ref:"#/definitions/DateTime",description:"Object for defining datetime in Vega-Lite Filter.\n\nIf both month and quarter are provided, month has higher precedence.\n\n`day` cannot be combined with other date.\n\nWe accept string for month and day names."}]}}},required:["field","range"]},InFilter:{type:"object",properties:{timeUnit:{$ref:"#/definitions/TimeUnit",description:"time unit for the field to be filtered."},field:{description:"Field to be filtered",type:"string"},"in":{description:"A set of values that the `field`'s value should be a member of,\n\nfor a data item included in the filtered data.",type:"array",items:{oneOf:[{type:"string"},{type:"number"},{type:"boolean"},{$ref:"#/definitions/DateTime",description:"Object for defining datetime in Vega-Lite Filter.\n\nIf both month and quarter are provided, month has higher precedence.\n\n`day` cannot be combined with other date.\n\nWe accept string for month and day names."}]}}},required:["field","in"]},Formula:{type:"object",properties:{field:{description:"The field in which to store the computed formula value.",type:"string"},expr:{description:"A string containing an expression for the formula. Use the variable `datum` to to refer to the current data object.",type:"string"}},required:["field","expr"]},Config:{type:"object",properties:{viewport:{description:"The width and height of the on-screen viewport, in pixels. If necessary, clipping and scrolling will be applied.",type:"number"},background:{description:'CSS color property to use as background of visualization. Default is `"transparent"`.',type:"string"},numberFormat:{description:'D3 Number format for axis labels and text tables. For example "s" for SI units.',type:"string"},timeFormat:{description:"Default datetime format for axis and legend labels. The format can be set directly on each axis and legend.",type:"string"},countTitle:{description:"Default axis and legend title for count fields.",type:"string"},cell:{$ref:"#/definitions/CellConfig",description:"Cell Config"},mark:{$ref:"#/definitions/MarkConfig",description:"Mark Config"},overlay:{$ref:"#/definitions/OverlayConfig",description:"Mark Overlay Config"},scale:{$ref:"#/definitions/ScaleConfig",description:"Scale Config"},axis:{$ref:"#/definitions/AxisConfig",description:"Axis Config"},legend:{$ref:"#/definitions/LegendConfig",description:"Legend Config"},facet:{$ref:"#/definitions/FacetConfig",description:"Facet Config"}}},CellConfig:{type:"object",properties:{width:{type:"number"},height:{type:"number"},clip:{type:"boolean"},fill:{description:"The fill color.",format:"color",type:"string"},fillOpacity:{description:"The fill opacity (value between [0,1]).",type:"number"},stroke:{description:"The stroke color.",type:"string"},strokeOpacity:{description:"The stroke opacity (value between [0,1]).",type:"number"},strokeWidth:{description:"The stroke width, in pixels.",type:"number"},strokeDash:{description:"An array of alternating stroke, space lengths for creating dashed or dotted lines.",type:"array",items:{type:"number"}},strokeDashOffset:{description:"The offset (in pixels) into which to begin drawing with the stroke dash array.",type:"number"}}},MarkConfig:{type:"object",properties:{filled:{description:'Whether the shape\\\'s color should be used as fill color instead of stroke color.\n\nThis is only applicable for "bar", "point", and "area".\n\nAll marks except "point" marks are filled by default.\n\nSee Mark Documentation (http://vega.github.io/vega-lite/docs/marks.html)\n\nfor usage example.',type:"boolean"},color:{description:"Default color.",format:"color",type:"string"},fill:{description:"Default Fill Color.  This has higher precedence than config.color",format:"color",type:"string"},stroke:{description:"Default Stroke Color.  This has higher precedence than config.color",format:"color",type:"string"},opacity:{minimum:0,maximum:1,type:"number"},fillOpacity:{minimum:0,maximum:1,type:"number"},strokeOpacity:{minimum:0,maximum:1,type:"number"},strokeWidth:{minimum:0,type:"number"},strokeDash:{description:"An array of alternating stroke, space lengths for creating dashed or dotted lines.",type:"array",items:{type:"number"}},strokeDashOffset:{description:"The offset (in pixels) into which to begin drawing with the stroke dash array.",type:"number"},stacked:{$ref:"#/definitions/StackOffset"},orient:{$ref:"#/definitions/Orient",description:"The orientation of a non-stacked bar, tick, area, and line charts.\n\nThe value is either horizontal (default) or vertical.\n\n- For bar, rule and tick, this determines whether the size of the bar and tick\n\nshould be applied to x or y dimension.\n\n- For area, this property determines the orient property of the Vega output.\n\n- For line, this property determines the sort order of the points in the line\n\nif `config.sortLineBy` is not specified.\n\nFor stacked charts, this is always determined by the orientation of the stack;\n\ntherefore explicitly specified value will be ignored."},interpolate:{$ref:"#/definitions/Interpolate",description:"The line interpolation method to use. One of linear, step-before, step-after, basis, basis-open, cardinal, cardinal-open, monotone."},tension:{description:"Depending on the interpolation type, sets the tension parameter.",type:"number"},lineSize:{description:"Size of line mark.",type:"number"},ruleSize:{description:"Size of rule mark.",type:"number"},barSize:{description:"The size of the bars.  If unspecified, the default size is  `bandSize-1`,\n\nwhich provides 1 pixel offset between bars.",type:"number"},barThinSize:{description:"The size of the bars on continuous scales.",type:"number"},shape:{description:"The symbol shape to use. One of circle (default), square, cross, diamond, triangle-up, or triangle-down, or a custom SVG path.",oneOf:[{$ref:"#/definitions/Shape"},{type:"string"}]},size:{description:"The pixel area each the point. For example: in the case of circles, the radius is determined in part by the square root of the size value.",type:"number"},tickSize:{description:"The width of the ticks.",type:"number"},tickThickness:{description:"Thickness of the tick mark.",type:"number"},align:{$ref:"#/definitions/HorizontalAlign",description:"The horizontal alignment of the text. One of left, right, center."},angle:{description:"The rotation angle of the text, in degrees.",type:"number"},baseline:{$ref:"#/definitions/VerticalAlign",description:"The vertical alignment of the text. One of top, middle, bottom."},dx:{description:"The horizontal offset, in pixels, between the text label and its anchor point. The offset is applied after rotation by the angle property.",type:"number"},dy:{description:"The vertical offset, in pixels, between the text label and its anchor point. The offset is applied after rotation by the angle property.",type:"number"},radius:{description:"Polar coordinate radial offset, in pixels, of the text label from the origin determined by the x and y properties.",type:"number"},theta:{description:'Polar coordinate angle, in radians, of the text label from the origin determined by the x and y properties. Values for theta follow the same convention of arc mark startAngle and endAngle properties: angles are measured in radians, with 0 indicating "north".',type:"number"},font:{description:"The typeface to set the text in (e.g., Helvetica Neue).",type:"string"},fontSize:{description:"The font size, in pixels.",type:"number"},fontStyle:{$ref:"#/definitions/FontStyle",description:"The font style (e.g., italic)."},fontWeight:{$ref:"#/definitions/FontWeight",description:"The font weight (e.g., bold)."},format:{description:"The formatting pattern for text value. If not defined, this will be determined automatically.",type:"string"},shortTimeLabels:{description:"Whether month names and weekday names should be abbreviated.",type:"boolean"},text:{description:"Placeholder Text",type:"string"},applyColorToBackground:{description:"Apply color field to background color instead of the text.",type:"boolean"}}},StackOffset:{type:"string","enum":["zero","center","normalize","none"]},Orient:{type:"string","enum":["horizontal","vertical"]},Interpolate:{type:"string","enum":["linear","linear-closed","step","step-before","step-after","basis","basis-open","basis-closed","cardinal","cardinal-open","cardinal-closed","bundle","monotone"]},Shape:{type:"string","enum":["circle","square","cross","diamond","triangle-up","triangle-down"]},HorizontalAlign:{type:"string","enum":["left","right","center"]},VerticalAlign:{type:"string","enum":["top","middle","bottom"]},FontStyle:{type:"string","enum":["normal","italic"]},FontWeight:{type:"string","enum":["normal","bold"]},OverlayConfig:{type:"object",properties:{line:{description:"Whether to overlay line with point.",type:"boolean"},area:{$ref:"#/definitions/AreaOverlay",description:"Type of overlay for area mark (line or linepoint)"},pointStyle:{$ref:"#/definitions/MarkConfig",description:"Default style for the overlayed point."},lineStyle:{$ref:"#/definitions/MarkConfig",description:"Default style for the overlayed point."}}},AreaOverlay:{type:"string","enum":["line","linepoint","none"]},ScaleConfig:{type:"object",properties:{round:{description:"If true, rounds numeric output values to integers.\n\nThis can be helpful for snapping to the pixel grid.\n\n(Only available for `x`, `y`, `size`, `row`, and `column` scales.)",type:"boolean"},textBandWidth:{description:"Default band width for `x` ordinal scale when is mark is `text`.",minimum:0,type:"number"},bandSize:{description:"Default band size for (1) `y` ordinal scale,\n\nand (2) `x` ordinal scale when the mark is not `text`.",minimum:0,type:"number"},opacity:{description:"Default range for opacity.",type:"array",items:{type:"number"}},padding:{description:"Default padding for `x` and `y` ordinal scales.",type:"number"},useRawDomain:{description:'Uses the source data range as scale domain instead of aggregated data for aggregate axis.\n\nThis property only works with aggregate functions that produce values within the raw data domain (`"mean"`, `"average"`, `"stdev"`, `"stdevp"`, `"median"`, `"q1"`, `"q3"`, `"min"`, `"max"`). For other aggregations that produce values outside of the raw data domain (e.g. `"count"`, `"sum"`), this property is ignored.',type:"boolean"},nominalColorRange:{description:"Default range for nominal color scale",oneOf:[{type:"string"},{type:"array",items:{type:"string"}}]},sequentialColorRange:{description:"Default range for ordinal / continuous color scale",oneOf:[{type:"string"},{type:"array",items:{type:"string"}}]},shapeRange:{description:"Default range for shape",oneOf:[{type:"string"},{type:"array",items:{type:"string"}}]},barSizeRange:{description:"Default range for bar size scale",type:"array",items:{type:"number"}},fontSizeRange:{description:"Default range for font size scale",type:"array",items:{type:"number"}},ruleSizeRange:{description:"Default range for rule stroke widths",type:"array",items:{type:"number"}},tickSizeRange:{description:"Default range for tick spans",type:"array",items:{type:"number"}},pointSizeRange:{description:"Default range for bar size scale",type:"array",items:{type:"number"}}}},AxisConfig:{type:"object",properties:{axisWidth:{description:"Width of the axis line",type:"number"},layer:{description:"A string indicating if the axis (and any gridlines) should be placed above or below the data marks.",type:"string"},offset:{description:"The offset, in pixels, by which to displace the axis from the edge of the enclosing group or data rectangle.",type:"number"},axisColor:{description:"Color of axis line.",type:"string"},grid:{description:"A flag indicate if gridlines should be created in addition to ticks. If `grid` is unspecified, the default value is `true` for ROW and COL. For X and Y, the default value is `true` for quantitative and time fields and `false` otherwise.",type:"boolean"},gridColor:{description:"Color of gridlines.",type:"string"},gridDash:{description:"The offset (in pixels) into which to begin drawing with the grid dash array.",type:"array",items:{type:"number"}},gridOpacity:{description:"The stroke opacity of grid (value between [0,1])",type:"number"},gridWidth:{description:"The grid width, in pixels.",type:"number"},labels:{description:"Enable or disable labels.",type:"boolean"},labelAngle:{description:"The rotation angle of the axis labels.",type:"number"},labelAlign:{description:"Text alignment for the Label.",type:"string"},labelBaseline:{description:"Text baseline for the label.",type:"string"},labelMaxLength:{description:"Truncate labels that are too long.",minimum:1,type:"number"},shortTimeLabels:{description:"Whether month and day names should be abbreviated.",type:"boolean"},subdivide:{description:"If provided, sets the number of minor ticks between major ticks (the value 9 results in decimal subdivision). Only applicable for axes visualizing quantitative scales.",type:"number"},ticks:{description:'A desired number of ticks, for axes visualizing quantitative scales. The resulting number may be different so that values are "nice" (multiples of 2, 5, 10) and lie within the underlying scale\'s range.',minimum:0,type:"number"},tickColor:{description:"The color of the axis's tick.",type:"string"},tickLabelColor:{description:"The color of the tick label, can be in hex color code or regular color name.",type:"string"},tickLabelFont:{description:"The font of the tick label.",type:"string"},tickLabelFontSize:{description:"The font size of label, in pixels.",type:"number"},tickPadding:{description:"The padding, in pixels, between ticks and text labels.",type:"number"},tickSize:{description:"The size, in pixels, of major, minor and end ticks.",minimum:0,type:"number"},tickSizeMajor:{description:"The size, in pixels, of major ticks.",minimum:0,type:"number"},tickSizeMinor:{description:"The size, in pixels, of minor ticks.",minimum:0,type:"number"},tickSizeEnd:{description:"The size, in pixels, of end ticks.",minimum:0,type:"number"},tickWidth:{description:"The width, in pixels, of ticks.",type:"number"},titleColor:{description:"Color of the title, can be in hex color code or regular color name.",type:"string"},titleFont:{description:"Font of the title.",type:"string"},titleFontSize:{description:"Size of the title.",type:"number"},titleFontWeight:{description:"Weight of the title.",type:"string"},titleOffset:{description:"A title offset value for the axis.",type:"number"},titleMaxLength:{description:"Max length for axis title if the title is automatically generated from the field's description. By default, this is automatically based on cell size and characterWidth property.",minimum:0,type:"number"},characterWidth:{description:"Character width for automatically determining title max length.",type:"number"},properties:{description:"Optional mark property definitions for custom axis styling."}}},LegendConfig:{type:"object",properties:{orient:{description:'The orientation of the legend. One of "left" or "right". This determines how the legend is positioned within the scene. The default is "right".',type:"string"},offset:{description:"The offset, in pixels, by which to displace the legend from the edge of the enclosing group or data rectangle.",type:"number"},padding:{description:"The padding, in pixels, between the lengend and axis.",type:"number"},margin:{description:"The margin around the legend, in pixels",type:"number"},gradientStrokeColor:{description:"The color of the gradient stroke, can be in hex color code or regular color name.",type:"string"},gradientStrokeWidth:{description:"The width of the gradient stroke, in pixels.",type:"number"},gradientHeight:{description:"The height of the gradient, in pixels.",type:"number"},gradientWidth:{description:"The width of the gradient, in pixels.",type:"number"},labelAlign:{description:"The alignment of the legend label, can be left, middle or right.",type:"string"},labelBaseline:{description:"The position of the baseline of legend label, can be top, middle or bottom.",type:"string"},labelColor:{description:"The color of the legend label, can be in hex color code or regular color name.",type:"string"},labelFont:{description:"The font of the lengend label.",type:"string"},labelFontSize:{description:"The font size of lengend lable.",type:"number"},labelOffset:{description:"The offset of the legend label.",type:"number"},shortTimeLabels:{description:"Whether month names and weekday names should be abbreviated.",type:"boolean"},symbolColor:{description:"The color of the legend symbol,",type:"string"},symbolShape:{description:"The shape of the legend symbol, can be the 'circle', 'square', 'cross', 'diamond',\n\n'triangle-up', 'triangle-down', or else a custom SVG path string.",type:"string"},symbolSize:{description:"The size of the lengend symbol, in pixels.",type:"number"},symbolStrokeWidth:{description:"The width of the symbol's stroke.",type:"number"},titleColor:{description:"Optional mark property definitions for custom legend styling.\n\nThe color of the legend title, can be in hex color code or regular color name.",type:"string"},titleFont:{description:"The font of the legend title.",type:"string"},titleFontSize:{description:"The font size of the legend title.",type:"number"},titleFontWeight:{description:"The font weight of the legend title.",type:"string"},properties:{description:"Optional mark property definitions for custom legend styling."}}},FacetConfig:{type:"object",properties:{scale:{$ref:"#/definitions/FacetScaleConfig",description:"Facet Scale Config"},axis:{$ref:"#/definitions/AxisConfig",description:"Facet Axis Config"},grid:{$ref:"#/definitions/FacetGridConfig",description:"Facet Grid Config"},cell:{$ref:"#/definitions/CellConfig",description:"Facet Cell Config"}}},FacetScaleConfig:{type:"object",properties:{round:{type:"boolean"},padding:{type:"number"}}},FacetGridConfig:{type:"object",properties:{color:{format:"color",type:"string"},opacity:{type:"number"},offset:{type:"number"}}},FacetSpec:{type:"object",properties:{facet:{$ref:"#/definitions/Facet"},spec:{oneOf:[{$ref:"#/definitions/LayerSpec"},{$ref:"#/definitions/UnitSpec"}]},name:{description:"Name of the visualization for later reference.",type:"string"},description:{description:"An optional description of this mark for commenting purpose.\n\nThis property has no effect on the output visualization.",type:"string"},data:{$ref:"#/definitions/Data",description:"An object describing the data source"},transform:{$ref:"#/definitions/Transform",description:"An object describing filter and new field calculation."},config:{$ref:"#/definitions/Config",description:"Configuration object"}},required:["facet","spec"]},Facet:{type:"object",properties:{row:{$ref:"#/definitions/PositionChannelDef"},column:{$ref:"#/definitions/PositionChannelDef"}}},LayerSpec:{type:"object",properties:{layers:{description:"Unit specs that will be layered.",type:"array",items:{$ref:"#/definitions/UnitSpec"}},name:{description:"Name of the visualization for later reference.",type:"string"},description:{description:"An optional description of this mark for commenting purpose.\n\nThis property has no effect on the output visualization.",type:"string"},data:{$ref:"#/definitions/Data",description:"An object describing the data source"},transform:{$ref:"#/definitions/Transform",description:"An object describing filter and new field calculation."},config:{$ref:"#/definitions/Config",description:"Configuration object"}},required:["layers"]},UnitSpec:{type:"object",properties:{mark:{$ref:"#/definitions/Mark",description:'The mark type.\n\nOne of `"bar"`, `"circle"`, `"square"`, `"tick"`, `"line"`,\n\n`"area"`, `"point"`, `"rule"`, and `"text"`.'},encoding:{$ref:"#/definitions/UnitEncoding",description:"A key-value mapping between encoding channels and definition of fields."},name:{description:"Name of the visualization for later reference.",type:"string"},description:{description:"An optional description of this mark for commenting purpose.\n\nThis property has no effect on the output visualization.",type:"string"},data:{$ref:"#/definitions/Data",description:"An object describing the data source"},transform:{$ref:"#/definitions/Transform",description:"An object describing filter and new field calculation."},config:{$ref:"#/definitions/Config",description:"Configuration object"}},required:["mark"]},UnitEncoding:{type:"object",properties:{x:{$ref:"#/definitions/PositionChannelDef",description:"X coordinates for `point`, `circle`, `square`,\n\n`line`, `rule`, `text`, and `tick`\n\n(or to width and height for `bar` and `area` marks)."},y:{$ref:"#/definitions/PositionChannelDef",description:"Y coordinates for `point`, `circle`, `square`,\n\n`line`, `rule`, `text`, and `tick`\n\n(or to width and height for `bar` and `area` marks)."},x2:{$ref:"#/definitions/PositionChannelDef",description:"X2 coordinates for ranged `bar`, `rule`, `area`"},y2:{$ref:"#/definitions/PositionChannelDef",description:"Y2 coordinates for ranged `bar`, `rule`, `area`"},color:{$ref:"#/definitions/ChannelDefWithLegend",description:"Color of the marks – either fill or stroke color based on mark type.\n\n(By default, fill color for `area`, `bar`, `tick`, `text`, `circle`, and `square` /\n\nstroke color for `line` and `point`.)"},opacity:{$ref:"#/definitions/ChannelDefWithLegend",description:"Opacity of the marks – either can be a value or in a range."},size:{$ref:"#/definitions/ChannelDefWithLegend",description:"Size of the mark.\n\n- For `point`, `square` and `circle`\n\n– the symbol size, or pixel area of the mark.\n\n- For `bar` and `tick` – the bar and tick's size.\n\n- For `text` – the text's font size.\n\n- Size is currently unsupported for `line` and `area`."},shape:{$ref:"#/definitions/ChannelDefWithLegend",description:'The symbol\'s shape (only for `point` marks). The supported values are\n\n`"circle"` (default), `"square"`, `"cross"`, `"diamond"`, `"triangle-up"`,\n\nor `"triangle-down"`, or else a custom SVG path string.'},detail:{description:"Additional levels of detail for grouping data in aggregate views and\n\nin line and area marks without mapping data to a specific visual channel.",oneOf:[{$ref:"#/definitions/FieldDef",description:"Interface for any kind of FieldDef;\n\nFor simplicity, we do not declare multiple interfaces of FieldDef like\n\nwe do for JSON schema."},{type:"array",items:{$ref:"#/definitions/FieldDef",description:"Interface for any kind of FieldDef;\n\nFor simplicity, we do not declare multiple interfaces of FieldDef like\n\nwe do for JSON schema."}}]},text:{$ref:"#/definitions/FieldDef",description:"Text of the `text` mark."},label:{$ref:"#/definitions/FieldDef"},path:{description:"Order of data points in line marks.",oneOf:[{$ref:"#/definitions/OrderChannelDef"},{type:"array",items:{$ref:"#/definitions/OrderChannelDef"}}]},order:{description:"Layer order for non-stacked marks, or stack order for stacked marks.",oneOf:[{$ref:"#/definitions/OrderChannelDef"},{type:"array",items:{$ref:"#/definitions/OrderChannelDef"}}]}}}},$schema:"http://json-schema.org/draft-04/schema#"}}(),function(){"use strict";angular.module("vlui",["LocalStorageModule","angular-google-analytics","angular-sortable-view","angular-websql","ui-rangeSlider"]).constant("_",window._).constant("cql",window.cql).constant("vlSchema",window.vlSchema).constant("jQuery",window.$).constant("Papa",window.Papa).constant("Blob",window.Blob).constant("URL",window.URL).constant("Drop",window.Drop).constant("JSON3",window.JSON3.noConflict()).constant("ANY","__ANY__").constant("consts",{addCount:!0,debug:!0,useUrl:!0,logging:!0,logLevel:"INFO",logPrintLevel:"INFO",logToWebSql:!1,hideMoreFn:!0,appId:"vlui",embeddedData:window.vguiData||void 0,priority:{bookmark:0,popup:0,vislist:1e3},myriaRest:"http://ec2-52-1-38-182.compute-1.amazonaws.com:8753",defaultTimeFn:"year",wildcardFn:!0,hideOrdinalTypeSelect:!0}).config(["cql",function(e){e.config.DEFAULT_QUERY_CONFIG.channels=["x","y","column","size","color"],e.config.DEFAULT_QUERY_CONFIG.stylize=!1}])}(),function(){angular.module("vlui").run(["$templateCache",function(e){e.put("dataset/changeloadeddataset.html",'<div class="change-loaded-dataset"><div ng-if="userData.length"><h3>已定义的指标</h3><input type="text" class="full-width" placeholder="快速查找指标" ng-keyup="SearchChange($event)"><ul><li ng-show="dataset.hidden!=\'true\'" ng-repeat="dataset in userData track by dataset.id" ng-class="{selected: Dataset.currentDataset.id === dataset.id}"><a class="dataset" ng-click="selectDataset(dataset)" ng-disabled="Dataset.currentDataset.id === dataset.id"><i class="fa fa-database"></i> <strong>{{dataset.name}}</strong></a> <span ng-if="dataset.description">{{dataset.description}}</span> <strong ng-if="Dataset.currentDataset === dataset">(已选中)</strong></li></ul><h3>请点击选择</h3></div></div>'),e.put("dataset/datasetmodal.html",'<modal id="dataset-modal" max-width="800px"><div class="modal-header"><modal-close-button></modal-close-button><h2>选择指标</h2></div><div class="modal-main"><tabset><tab heading="可用指标"><change-loaded-dataset></change-loaded-dataset></tab></tabset></div></modal>'),e.put("dataset/datasetselector.html",'<button id="select-data" class="btn btn-default btn-xs" ng-click="loadDataset();"><span class="glyphicon glyphicon-cloud-download"></span>选择指标</button>'),e.put("components/ecchannel/ecchannel.html",'<div><div class="shelf-group"><div class="shelf"><div class="shelf-label">{{ channelTitle }}</div><div class="field-drop" ng-model="thismodal" data-drop="canDrag == \'1\'" jqyoui-droppable="{onDrop:\'FieldDropped()\'}" data-jqyoui-options="{activeClass: \'drop-active\'}"><span class="selected full-width field-info" ng-show="field.field"><span class="hflex full-width"><span class="type-caret drop-target active" ng-show="canDrop == \'1\'"><i ng-if="dropType!=\'filters\'" class="fa fa-caret-down"></i><i ng-if="dropType==\'filters\'" class="fa fa-filter"></i></span> <span title="{{ field.field }}" class="field-info-text">{{ field.field }}</span> <span title="计算表达式配置" class="count-caret drop-target active" ng-show="field.aggregate == \'count\'"><i class="fa fa-calculator" style="cursor:pointer;"></i>&nbsp;</span> <span class="no-shrink remove"><a class="remove-field" ng-click="removeAction()"><i class="fa fa-times"></i></a></span></span></span> <span class="placeholder" ng-show="!field.field && canDrag == \'1\'">将字段拖到此处</span></div></div><div class="drop-container"><div class="popup-menu echart-type"><div ng-if="field.type == \'temporal\'"><div class="form-group clearfix"><label class="col-sm-5">日期取值</label><div class="col-sm-5"><select ng-model="field.vtype" style="width:110px"><option value="year">年</option><option value="month">月</option><option value="day">日</option><option value="quate">季度</option><option value=">">年月日</option><option value=">=">年月</option><option value="<">年季度</option></select></div></div><div class="form-group clearfix"><label class="col-sm-5">时间格式</label><div class="col-sm-5"><select ng-model="field.dateformat" style="width:110px"><option value="year">yyyy-MM-dd</option><option value="month">yyyy/MM/dd</option></select></div></div></div><div class="form-group clearfix" ng-if="dropType!=\'filter\'&&dropType!=\'filters\'&&field.aggregate!=\'count\'&&field.aggregate!=\'count_sum\'&&channelTitle.indexOf(\'维度\')<0&&channelTitle.indexOf(\'地区\')<0" style="width:200px"><label class="col-sm-6">统计方式</label><div class="col-sm-4"><select class="full-width" ng-model="field.aggregate"><option value="sum">加总</option><option value="mean">平均</option><option value="max">最大</option><option value="min">最小</option><option value="rank">排名</option><option value="grouprank">组内排名</option><option value="topn">前N名</option><option value="lastn">后N名</option><option value="topnp">前N%名</option><option value="lastnp">后N%名</option><option value="yp">同期数值</option><option value="yppercent">同比%</option><option value="mp">环比数值</option><option value="mppercent">环比%</option></select></div><div class="col-sm-2"><input placeholder="N" ng-model="field.aggregatevalue" style="width:100%" type="text" ng-show="field.aggregate==\'topn\'||field.aggregate==\'lastn\'||field.aggregate==\'topnp\'||field.aggregate==\'lastnp\'"></div></div><div ng-if="dropType == \'type\'" style="width:230px"><div class="form-group clearfix"><label class="col-sm-5">文字显示</label><div class="col-sm-5"><input type="text" class="full-width" ng-model="field.rename" style="width:110px"></div></div><div class="form-group clearfix"><label class="col-sm-5">颜色默认</label><div class="col-sm-5"><input type="checkbox" ng-true-value="\'true\'" ng-false-value="\'false\'" ng-model="field.autoColor"></div></div><div class="form-group clearfix" ng-show="field.autoColor == \'false\'"><label class="col-sm-5">颜色</label><div class="col-sm-5"><input type="text" class="full-width color-input" ng-blur="setMixColor()" ng-model="mix_color"></div></div><div class="form-group clearfix"><label class="col-sm-5">数据形状</label><div class="col-sm-5"><select ng-model="field.truetype" style="width:110px"><option value="bar">柱状</option><option value="line">线性</option><option value="area">区域图</option><option value="linestep">阶梯</option></select></div></div><div class="form-group clearfix" ng-show="field.truetype==\'bar\'"><label class="col-sm-5">度量位置</label><div class="col-sm-5"><select ng-model="field.label.normal.position" style="width:110px"><option value="left">left</option><option value="right">right</option><option value="top">top</option><option value="bottom">bottom</option><option value="inside">inside</option><option value="insideTop">insideTop</option><option value="insideLeft">insideLeft</option><option value="insideRight">insideRight</option><option value="insideBottom">insideBottom</option><option value="insideTopLeft">insideTopLeft</option><option value="insideTopRight">insideTopRight</option><option value="insideBottomLeft">insideBottomLeft</option><option value="insideBottomRight">insideBottomRight</option></select></div></div><div class="form-group clearfix"><label class="col-sm-4">度量显示</label><div class="col-sm-2"><input type="checkbox" ng-true-value="\'true\'" ng-false-value="\'false\'" ng-model="field.label.normal.show"></div><label class="col-sm-4">度量单位</label><div class="col-sm-2"><input type="checkbox" ng-true-value="\'true\'" ng-false-value="\'false\'" ng-model="field.ylabelunit"></div></div><div class="form-group clearfix"><label class="col-sm-4">度量翻转</label><div class="col-sm-2"><input type="checkbox" ng-true-value="\'90\'" ng-false-value="\'0\'" ng-model="field.label.normal.rotate"></div><label class="col-sm-4">度量倾斜</label><div class="col-sm-2"><input type="checkbox" ng-true-value="\'45\'" ng-false-value="\'0\'" ng-model="field.label.normal.rotate"></div></div><div class="form-group clearfix"><label class="col-sm-4">度量偏移量</label><div class="col-sm-2"><input type="text" class="full-width" ng-model="field.label.offset"></div><label class="col-sm-4">度量颜色</label><div class="col-sm-2"><input type="text" class="full-width color-label" ng-model="field.label.normal.color"></div></div><div class="form-group clearfix" ng-show="field.truetype!=\'bar\'"><label class="col-sm-4">是否平滑</label><div class="col-sm-2"><input type="checkbox" ng-true-value="true" ng-false-value="false" ng-model="field.smooth"></div></div><div class="form-group clearfix"><label class="col-sm-4">坐标单位</label><div class="col-sm-2"><input type="text" class="full-width" ng-model="field.yunit"></div><label class="col-sm-4">小数位数</label><div class="col-sm-2"><input type="text" class="full-width" ng-model="field.unitcount"></div></div><div class="form-group clearfix"><label class="col-sm-4">Max标志</label><div class="col-sm-2"><input type="checkbox" ng-true-value="true" ng-false-value="false" ng-model="field.showmax"></div><label class="col-sm-4">Min标志</label><div class="col-sm-2"><input type="checkbox" ng-true-value="true" ng-false-value="false" ng-model="field.showmin"></div></div><div class="form-group clearfix"><label class="col-sm-4">阶梯显示</label><div class="col-sm-2"><input type="checkbox" ng-true-value="true" ng-false-value="false" ng-model="field.basebar"></div><label class="col-sm-4">累计显示</label><div class="col-sm-2"><input type="checkbox" ng-true-value="true" ng-false-value="false" ng-model="field.sumbar"></div></div><div class="form-group clearfix"></div><div class="form-group clearfix" ng-show="field.truetype==\'bar\'"><label class="col-sm-4">对比背景柱</label><div class="col-sm-2"><input type="checkbox" ng-true-value="true" ng-false-value="false" ng-model="field.shadowbar"></div><label class="col-sm-4">对比柱前置</label><div class="col-sm-2"><input type="checkbox" ng-true-value="true" ng-false-value="false" ng-model="field.shadowbarfront"></div></div><div class="form-group clearfix" ng-show="field.truetype==\'bar\'"><label class="col-sm-4">对比红线</label><div class="col-sm-2"><input type="checkbox" ng-true-value="true" ng-false-value="false" ng-model="field.shadowline"></div></div><div class="form-group clearfix"></div><div class="form-group clearfix" ng-show="field.shownewy"><label class="col-sm-4">右Y轴</label><div class="col-sm-2"><input type="checkbox" ng-true-value="true" ng-false-value="false" ng-model="field.newy"></div><label class="col-sm-4">右Y轴反转</label><div class="col-sm-2"><input type="checkbox" ng-true-value="true" ng-false-value="false" ng-model="field.inversey"></div></div><div class="form-group clearfix"><label class="col-sm-4">均值线</label><div class="col-sm-2"><input type="checkbox" ng-true-value="true" ng-false-value="false" ng-model="field.showline"></div><label class="col-sm-4">警示线条数</label><div class="col-sm-2"><input type="text" class="full-width" ng-model="field.alertscount" ng-blur="alertBlur()"></div></div><div class="form-group clearfix"><label class="col-sm-4">柱不同色</label><div class="col-sm-2"><input type="checkbox" ng-true-value="true" ng-false-value="false" ng-model="field.diffcolors"></div><label class="col-sm-4">限制单柱宽</label><div class="col-sm-2"><input type="text" class="full-width" ng-model="field.maxwidth"></div></div><div class="form-group clearfix" ng-repeat="alertModel in field.alertsConfigs track by $index"><label class="col-sm-3"><input type="text" ng-model="alertModel.name" style="width:50px"></label><div class="col-sm-4">值<input type="text" ng-model="alertModel.value" style="width:50px"></div><div class="col-sm-5">颜色<input type="text" class="full-width alertcolor" ng-model="alertModel.color" style="width:60px" idx="{{ $index }}"></div></div></div><div style="width: 250px;" ng-if="dropType == \'dbar\'"><div class="form-group clearfix"><label class="col-sm-4">定义均值线</label><div class="col-sm-2"><input type="checkbox" ng-true-value="true" ng-false-value="false" ng-model="field.showavgline"></div></div><div class="form-group clearfix" ng-show="field.showavgline==true"><label class="col-sm-4">纵轴均值</label><div class="col-sm-4"><input type="text" class="full-width alertcolor" ng-model="field.avglinevalue" style="width:30px">%</div></div></div><div style="width: 250px;" ng-if="dropType == \'label\'"><div class="form-group clearfix"><label class="col-sm-5">文字显示</label><div class="col-sm-5"><input type="checkbox" ng-true-value="\'true\'" ng-false-value="\'false\'" ng-model="field.label.show"></div></div><div class="form-group clearfix"><label class="col-sm-5">文本位置</label><div class="col-sm-5"><select class="full-width" ng-model="field.label.position"><option value="outside">外侧</option><option value="inside">内部</option></select></div></div><div class="form-group clearfix"><label class="col-sm-5">百分比显示</label><div class="col-sm-5"><input type="checkbox" ng-true-value="\'true\'" ng-false-value="\'false\'" ng-model="field.label.showpercent"></div></div><div class="form-group clearfix"><label class="col-sm-5">数值显示</label><div class="col-sm-5"><input type="checkbox" ng-true-value="\'true\'" ng-false-value="\'false\'" ng-model="field.label.showsums"></div></div><div class="form-group clearfix"><label class="col-sm-5">文本显示</label><div class="col-sm-5"><input type="checkbox" ng-true-value="\'true\'" ng-false-value="\'false\'" ng-model="field.label.showDimeno"></div></div><div class="form-group clearfix"><label class="col-sm-5">玫瑰图</label><div class="col-sm-5"><input type="checkbox" ng-true-value="\'true\'" ng-false-value="\'false\'" ng-model="field.label.showrose"></div></div><div class="form-group clearfix"><label class="col-sm-5">南丁格尔玫瑰</label><div class="col-sm-5"><input type="checkbox" ng-true-value="\'true\'" ng-false-value="\'false\'" ng-model="field.label.showrosend"></div></div></div><div style="width: 250px;" ng-if="dropType == \'mixedtype\'"><div class="form-group clearfix"><label class="col-sm-6">维度分组</label><div class="col-sm-6"><input type="checkbox" ng-true-value="\'true\'" ng-false-value="\'false\'" ng-model="field.isgroup"></div></div></div><div style="width: 250px;" ng-if="dropType == \'mixedtype\'"><div class="form-group clearfix"><label class="col-sm-4">维度文字大小</label><div class="col-sm-2"><input type="input" ng-model="field.xlabelsize" style="width:45px"></div></div><div class="form-group clearfix"><label class="col-sm-4">度量文字大小</label><div class="col-sm-2"><input type="input" ng-model="field.ylabelsize" style="width:45px"></div></div></div><div style="width: 250px;" ng-if="dropType == \'mixedtype\'||dropType == \'label\'"><div class="form-group clearfix"><label class="col-sm-5">维度值合并</label><div class="col-sm-5">合并成<input type="text" class="full-width" ng-model="field.selfgroupcount" style="width:30px" ng-blur="groupcountBlur()">组</div></div><div class="form-group clearfix" ng-repeat="groupModel in field.groupConfigs track by $index"><label class="col-sm-4"><input type="text" ng-model="groupModel.name" style="width:60px"></label><div class="col-sm-4">初值<input type="text" ng-model="groupModel.valuestart" style="width:45px"></div><div class="col-sm-4">终值<input type="text" ng-model="groupModel.valueend" style="width:45px"></div></div></div><div style="width:180px" ng-if="dropType == \'style\'"><div class="form-group clearfix"><label class="col-sm-6">极简模式</label><div class="col-sm-6"><input type="checkbox" ng-true-value="\'true\'" ng-false-value="\'false\'" ng-model="field.simplemode"></div></div><div class="form-group clearfix"><label class="col-sm-6">文字显示</label><div class="col-sm-5"><input type="text" class="full-width" ng-model="field.name"></div></div><div class="form-group clearfix"><label class="col-sm-6">文本位置</label><div class="col-sm-6"><select ng-model="field.style.title.verticalAlign" style="width:70%"><option value="top">上</option><option value="bottom">下</option></select></div></div><div class="form-group clearfix"><label class="col-sm-6">百分比</label><div class="col-sm-5"><input type="checkbox" ng-true-value="\'true\'" ng-false-value="\'false\'" ng-model="field.showPercent"></div></div><div class="form-group clearfix"><label class="col-sm-6">小数点位数</label><div class="col-sm-6"><div range-slider="" style="margin: 0; padding: 0;width:70%;float:left;" min="0" max="3" model-max="field.decimals" pin-handle="min"></div><input type="text" style="width:20px;height:16px" ng-model="field.decimals"></div></div><div class="form-group clearfix"><label class="col-sm-6">数值大小</label><div class="col-sm-6"><div range-slider="" style="margin: 0; padding: 0;width:70%;float:left;" min="10" max="50" model-max="field.style.detail.fontSize" pin-handle="min"></div><input type="text" style="width:20px;height:16px" ng-model="field.style.detail.fontSize"></div></div><div class="form-group clearfix"><label class="col-sm-6">文本大小</label><div class="col-sm-6"><div range-slider="" style="margin: 0;padding: 0;width:70%;float:left;" min="10" max="50" model-max="field.style.title.fontSize" pin-handle="min"></div><input type="text" style="width:20px;height:16px" ng-model="field.style.title.fontSize"></div></div><div class="form-group clearfix"><label class="col-sm-6">表盘粗细</label><div class="col-sm-6"><div range-slider="" style="margin: 0;padding: 0;width:70%;float:left;" min="1" max="60" model-max="field.style.axisLine.lineStyle.width" pin-handle="min"></div><input type="text" style="width:20px;height:16px" ng-model="field.style.axisLine.lineStyle.width"></div></div><div class="form-group clearfix"><label class="col-sm-6">隐藏刻度</label><div class="col-sm-6"><input type="checkbox" ng-true-value="\'true\'" ng-false-value="\'false\'" ng-model="field.hidesplits"></div></div><div class="form-group clearfix"><label class="col-sm-6">刻度长度</label><div class="col-sm-6"><div range-slider="" style="margin: 0;padding: 0;width:70%;float:left;" min="1" max="100" model-max="field.style.axisTick.length" pin-handle="min"></div><input type="text" style="width:20px;height:16px" ng-model="field.style.axisTick.length"></div></div><div class="form-group clearfix"><label class="col-sm-6">分割长度</label><div class="col-sm-6"><div range-slider="" style="margin: 0;padding: 0;width:70%;float:left;" min="5" max="100" model-max="field.style.splitLine.length" pin-handle="min"></div><input type="text" style="width:20px;height:16px" ng-model="field.style.splitLine.length"></div></div><div class="form-group clearfix"><label class="col-sm-6">填充宽度</label><div class="col-sm-6"><div range-slider="" style="margin: 0;padding: 0;width:70%;float:left;" min="8" max="100" model-max="field.fullwidth" pin-handle="min"></div><input type="text" style="width:20px;height:16px" ng-model="field.fullwidth"></div></div><div class="form-group clearfix"><label class="col-sm-6">指针颜色</label><div class="col-sm-6"><input type="text" class="full-width split-color-input" rel="pointer" ng-blur="setPointColor(\'pointer\')" ng-model="field.style.itemStyle.normal.color"></div></div><div class="form-group clearfix"><label class="col-sm-6">刻度颜色</label><div class="col-sm-6"><input type="text" class="full-width split-color-input" rel="normal" ng-blur="setPointColor(\'split\')" ng-model="field.splitcolor"></div></div><div class="form-group clearfix" style="display:none;"><label class="col-sm-6">分段</label><div class="col-sm-6"><input type="text" class="full-width" ng-model="field.range"></div></div><div class="form-group clearfix"><label class="col-sm-6">动态分段</label><div class="col-sm-6"><input type="checkbox" ng-true-value="\'true\'" ng-false-value="\'false\'" ng-model="field.autoSplit"></div></div><div class="form-group clearfix"><label class="col-sm-6">动态最大值</label><div class="col-sm-6"><input type="checkbox" ng-true-value="\'true\'" ng-false-value="\'false\'" ng-model="field.autoMax"></div></div><div class="form-group clearfix" ng-if="field.autoMax == \'false\'"><label class="col-sm-6">最大值</label><div class="col-sm-6"><input type="text" class="full-width" ng-model="field.max"></div></div></div><div style="width: 200px;" ng-if="dropType == \'mappoint\'"><div class="form-group clearfix"><label class="col-sm-4">颜色</label><div class="col-sm-4"><input type="text" class="full-width point-color-input" rel="normal" ng-blur="setPointColor(\'normal\')" ng-model="point_color"></div></div><div class="form-group clearfix"><label class="col-sm-4">突出显示</label><div class="col-sm-4"><input type="checkbox" ng-true-value="\'true\'" ng-false-value="\'false\'" ng-model="field.iftop"></div></div><div class="form-group clearfix"><label class="col-sm-4">排序</label><div class="col-sm-4"><select class="full-width" ng-model="field.order"><option value="asc">顺序</option><option value="desc">倒序</option></select></div></div><div class="form-group clearfix"><label class="col-sm-4">显示数量</label><div class="col-sm-4"><input type="text" class="full-width" ng-model="field.order_num"></div></div><div class="form-group clearfix"><label class="col-sm-4">突出颜色</label><div class="col-sm-4"><input type="text" class="full-width point-color-input" rel="top" ng-blur="setPointColor(\'top\')" ng-model="point_top_color"></div></div></div><div style="width: 200px;" ng-if="dropType == \'single\'"><div class="form-group clearfix"><label class="col-sm-4">标题</label><div class="col-sm-8"><input type="text" class="full-width" ng-model="field.label"></div></div><div class="form-group clearfix"><label class="col-sm-4">标题大小</label><div class="col-sm-8"><div style="width: 80%;margin: 0;float:left" range-slider="" min="12" max="24" model-max="field._titleFontsize" pin-handle="min"></div><input type="text" style="width:22px;height:18px" ng-model="field._titleFontsize"></div></div><div class="form-group clearfix"><label class="col-sm-4">标题颜色</label><div class="col-sm-4"><input type="text" class="full-width single-color" rel="single_title" ng-blur="setPointColor(\'single_title\')" ng-model="single_title_color"></div></div><div class="form-group clearfix"><label class="col-sm-4">数值大小</label><div class="col-sm-8"><div style="width: 80%;margin: 0;float:left" range-slider="" min="12" max="24" model-max="field._valueFontsize" pin-handle="min"></div><input type="text" style="width:22px;height:18px" ng-model="field._valueFontsize"></div></div><div class="form-group clearfix"><label class="col-sm-4">数值颜色</label><div class="col-sm-4"><input type="text" class="full-width single-color" rel="single_value" ng-blur="setPointColor(\'single_value\')" ng-model="single_value_color"></div></div><div class="form-group clearfix"><label class="col-sm-4">单位</label><div class="col-sm-8"><input type="text" class="full-width" ng-model="field.unit"></div><div class="form-group clearfix"><label class="col-sm-6">增长图标</label><div class="col-sm-6"><input type="checkbox" ng-true-value="\'true\'" ng-false-value="\'false\'" ng-model="field.plusicon"></div></div></div></div><div style="width: 200px;" ng-if="dropType == \'filter\'"><div class="form-group clearfix"><label class="col-sm-4">当前日期</label><div class="col-sm-8"><input type="checkbox" ng-true-value="\'1\'" ng-false-value="\'0\'" ng-model="field.ifAuto"></div></div><div class="form-group clearfix"><label class="col-sm-4">手动日期</label><div class="col-sm-8"><input type="text" ng-model="field.value" ng-disabled="field.ifAuto == \'1\'"></div></div></div><div style="width: 550px;max-height:500px;overflow-y: auto;" ng-if="dropType == \'filters\'"><div class="form-group clearfix"><label class="col-sm-2">自定义过滤</label><div class="col-sm-6"><a ng-click="addAnd()" style="cursor:pointer;"><i class="fa fa-plus"></i>增加条件</a></div></div><table style="width:100%;border-collapse: collapse;border-left: 1px solid #e8eaed;border-top: 1px solid #e8eaed;" cellspacing="0" cellpadding="0"><tr ng-repeat="eachrule in getChilds(\'0\') track by crule.id" ng-init="eachrule = eachrule" ng-include="\'item_renderer.html\'"></tr></table></div><script id="item_renderer.html" type="text/ng-template"><td> <table style="width:100%;border-collapse:collapse" cellspacing="0" cellpadding="0"> <tr> <td rowspan="{{ getChilds(eachrule.id).length }}" ng-if="getChilds(eachrule.id).length>1" style="vertical-align: middle;width:20px;border-bottom: 1px solid #e8eaed;border-right: 1px solid #e8eaed;padding:3px;"> <div>{{ eachrule.relate=="and"?"且":"或" }}</div> </td> <td ng-if="eachrule.rule!=\'\'" style="width:120px;border-bottom: 1px solid #e8eaed;padding:5px;" ng-click="filterRowClick($event,eachrule,parentRule)"> <select ng-model="eachrule.name" style="width:110px" ng-options="vale.field as vale.field for vale in getAllCols() | orderBy : orderBy"></select> </td> <td ng-if="eachrule.rule!=\'\'" style="width:90px;border-bottom: 1px solid #e8eaed;padding:5px;" ng-click="filterRowClick($event,eachrule,parentRule)"> <select ng-model="eachrule.rule" style="width:80px"> <option value="==">等于</option> <option value="!=">不等于</option> <option value="like">包含</option> <option value="notlike">不包含</option> <option value="in">属于</option> <option value="notin">不属于</option> <option value="null">空</option> <option value="notnull">非空</option> <option value=">">大于</option> <option value=">=">大于等于</option> <option value="<">小于</option> <option value="<=">小于等于</option> <option value="s=">以..开始</option> <option value="e=">以..结束</option> <option value="nots=">不以..开始</option> <option value="note=">不以..结束</option> </select> </td> <td ng-if="eachrule.rule!=\'\'" style="border-bottom: 1px solid #e8eaed;padding:5px;" ng-click="filterRowClick($event,eachrule,parentRule)"> <input type="text" ng-model="eachrule.value" ng-model-options="{updateOn: \'blur\'}" style="width:100%" ng-show="eachrule.rule!=\'null\'&&eachrule.rule!=\'notnull\'"> </td> <td ng-if="eachrule.rule!=\'\'" style="width:70px;border-bottom: 1px solid #e8eaed;border-right: 1px solid #e8eaed;padding:5px;" ng-click="filterRowClick($event,eachrule,parentRule)"> <a title="增加同级且条件" ng-click="addAnd(eachrule)" style="cursor:pointer;"> <i class="fa fa-plus"></i> </a>&nbsp; <a title="增加同级或条件" ng-click="addOr(eachrule)" style="cursor:pointer;"> <i class="fa fa-plus-circle"></i> </a>&nbsp; <a title="删除条件" ng-click="removeFilter(eachrule)" style="cursor:pointer;"> <i class="fa fa-minus"></i> </a> </td> <td> <table style="width:100%;border-collapse:collapse" cellspacing="0" cellpadding="0"> <tr ng-repeat="crule in getChilds(eachrule.id) track by crule.id" ng-init="eachrule = crule" ng-include="\'item_renderer.html\'"></tr> </table> </td> </tr> </table> </td></script></div><div class="popup-menu count-type"><div style="width: 450px;" ng-if="field.aggregate == \'count\'"><div class="form-group clearfix"><label class="col-sm-2">指标重命名</label><div class="col-sm-4"><input type="text" class="full-width" ng-model="field.field"></div></div><div class="form-group clearfix"><label class="col-sm-4">可用计算字段(点选)</label><div class="col-sm-8">运算符(点选) &nbsp;&nbsp; <span class="field-func" ng-click="addFieldCalc(\'+\')" style="cursor:pointer;font-size:14px;">+</span>&nbsp;&nbsp;&nbsp; <span class="field-func" ng-click="addFieldCalc(\'-\')" style="cursor:pointer;font-size:14px;">-</span> &nbsp;&nbsp;&nbsp; <span class="field-func" ng-click="addFieldCalc(\'*\')" style="cursor:pointer;font-size:14px;">*</span>&nbsp;&nbsp;&nbsp; <span class="field-func" ng-click="addFieldCalc(\'/\')" style="cursor:pointer;font-size:14px;">/</span>&nbsp;&nbsp;&nbsp; <span class="field-func" ng-click="addFieldCalc(\'(\')" style="cursor:pointer;font-size:14px;">(</span>&nbsp;&nbsp;&nbsp; <span class="field-func" ng-click="addFieldCalc(\')\')" style="cursor:pointer;font-size:14px;">)</span></div></div><div class="form-group clearfix"><div class="col-sm-4 calc_div_fields scroll-y" style="max-height:250px;"><div ng-click="addFieldCalc(value.field)" data-drag="true" style="margin-top:3px;width:120px;overflow-x: hidden;cursor:pointer" jqyoui-draggable="{deepCopy: true, onStart: \'dragstart\', onStop:\'dragstop\'}" data-jqyoui-options="{revert: \'invalid\', helper: \'clone\'}" class="selected full-width field-info" ng-repeat="value in getAllCols() | orderBy : orderBy">{{value.field}}</div></div><div class="col-sm-8 field-drop" data-jqyoui-options="{activeClass: \'drop-active\'}" data-drop="true" jqyoui-droppable="{onDrop:\'dropComplete\'}"><textarea style="width:100%;height:220px;font-size:12px;" ng-keydown="deleteWords($event)" ng-model="field.calcrules" placeholder="例:已完成额/目标值"></textarea><div>公式校验: {{ calcheck }}</div></div></div></div></div></div></div><div class="shelf-group" ng-if="moreDrag && field.autoMax == \'true\'"><div class="shelf"><div class="shelf-label">最大值</div><div class="field-drop" ng-model="field.maxField" data-drop="true" jqyoui-droppable="{}" data-jqyoui-options="{activeClass: \'drop-active\'}"><span class="selected full-width field-info"><span class="hflex full-width"><span class="field-info-text">{{ field.maxField.field }}</span></span></span> <span class="placeholder" ng-show="!field.field && canDrag == \'1\'">此为 {{ field.field }} 的 最大值</span></div></div></div><div class="shelf-group" ng-if="moreDrag && field.isgroup == \'true\'||field.aggregate==\'grouprank\'"><span class="field-info-text"><div class="shelf"><div class="shelf-label">分组字段</div><div class="field-drop" ng-model="field.groupField" data-drop="true" jqyoui-droppable="{}" data-jqyoui-options="{activeClass: \'drop-active\'}"><span class="selected full-width field-info"><span class="hflex full-width">{{ field.groupField.field }}</span></span> <span class="placeholder" ng-show="!field.field && canDrag == \'1\'">此为 {{ field.field }} 的 最大值</span></div></div></span></div><div class="shelf-pane shelf-positional-pane full-width" ng-show="moreDrag && field.autoSplit == \'true\'"><div class="shelf-group"><div class="shelf" ng-repeat="splitModel in field.splitField track by $index"><div class="shelf-label">刻度分段{{ ($index+1) }}</div><div class="field-drop"><span class="selected full-width field-info"><span class="hflex full-width"><span class="type-caret{{ $index }} drop-target active" ng-show="canDrop == \'1\'" ng-click="showSplitPop($index)"><i class="fa fa-caret-down"></i></span> <span title="{{ splitModel.field }}" class="field-info-text">{{ splitModel.field }}</span> <span class="no-shrink remove"><a class="remove-field" ng-click="removeSplit()"><i class="fa fa-times"></i></a></span></span></span></div><div class="drop-container"><div class="popup-menu echart-type{{ $index }}"><div ng-if="field.autoSplit == \'true\'"><div class="form-group clearfix"><label class="col-sm-4">分段颜色</label><div class="col-sm-4"><input type="text" class="full-width split-color{{ $index }}" ng-blur="setSplitColor(\'split\',$index)" ng-model="splitModel.color"></div></div><div class="form-group clearfix"><label class="col-sm-6">指定分段长度</label><div class="col-sm-6"><input type="checkbox" ng-true-value="true" ng-false-value="false" ng-model="splitModel.giveLength"></div></div><div class="form-group clearfix" ng-show="splitModel.giveLength==true"><label class="col-sm-6">分段长度</label><div class="col-sm-6"><div range-slider="" style="margin: 0;padding: 0;" min="0" max="50" model-max="splitModel.length" pin-handle="min"></div></div></div></div></div></div></div></div><div class="shelf-group"><div class="shelf"><div class="field-drop" ng-model="newmodel" data-drop="true" jqyoui-droppable="{onDrop:\'SplitDropped()\'}" data-jqyoui-options="{activeClass: \'drop-active\'}"><span class="placeholder">拖动刻度分段字段到此处</span></div></div></div></div></div>'),
e.put("components/fieldinfo/fieldinfo.html",'<span class="field-info"><span class="hflex full-width" ng-click="clicked($event)"><span class="type-caret" ng-class="{active: !disableCaret}"><span class="type fa {{icon}}" ng-show="showType" title="{{typeName}}"></span></span> <span ng-if="fieldDef.aggregate!==\'count\'" class="field-info-text"><span ng-if="func(fieldDef)" class="field-func" title="{{ func(fieldDef) }}" ng-class="{any: fieldDef._any}">{{ func(fieldDef) }}</span><span class="field-name" title="{{ (fieldDef.title || fieldTitle(fieldDef.field)) | underscore2space }}" ng-class="{hasfunc: func(fieldDef), any: fieldDef._any}">{{ (fieldDef.title || fieldTitle(fieldDef.field)) | underscore2space }}</span> <span class="wildcard-field-count">{{ fieldCount(fieldDef.field) }}</span></span> <span ng-if="fieldDef.aggregate===\'count\' || fieldDef.autoCount" class="field-count field-info-text"><span class="field-name">{{fieldDef.field}}</span></span> <span class="no-shrink remove" ng-show="showRemove"><a class="remove-field" ng-click="removeAction()"><i class="fa fa-times"></i></a></span></span></span>'),e.put("components/shelves/shelves.html",'<div class="card vflex shelves no-top-margin no-right-margin abs-100"><div class="full-width" style="position: relative;" ng-mouseover="showmarktype=true" ng-mouseleave="showmarktype=false"><button type="button" class="select-btn" ng-click="showmarktype = !showmarktype"><i class="fa {{ markdetail.icon }}">{{ markdetail.title }}</i></button><ul class="marktype-list" ng-show="showmarktype"><li ng-repeat="type in marksWithAny track by $index" ng-click="changetype(type)" style="cursor:hand;"><i class="fa {{ marksicon[type].icon }}" style="width:20px"></i> {{ marksicon[type].title }}</li></ul></div><div class="shelf-pane shelf-encoding-pane full-width"><h2 ng-show="spec.mark != \'single\'" ng-click="titleShow = !titleShow">基础配置</h2><div class="shelf-pane shelf-positional-pane full-width" ng-show="spec.mark != \'single\' && titleShow"><div class="shelf-group"><div class="shelf"><div class="shelf-label drop-target">标题</div><div class="field-drop"><input type="text" class="full-width" ng-blur="setNormalTitle(\'title\');" ng-model="normalTitle"></div></div></div><div class="shelf-group"><div class="shelf"><div class="shelf-label drop-target">标题大小</div><div class="field-drop"><div style="width: 80%;margin: 0;" range-slider="" min="5" max="100" model-max="ecconfig.title.textStyle.fontSize" pin-handle="min"></div><input type="text" style="width:25px;" ng-model="ecconfig.title.textStyle.fontSize"></div></div></div><div class="shelf-group" ng-show="spec.mark != \'single\'"><div class="shelf"><div class="shelf-label drop-target">颜色</div><div class="field-drop"><input type="text" class="full-width color-input-title" ng-blur="setColor(\'bt\')" rel="bt" ng-model="titletextcolor"></div></div></div><div class="shelf-group" ng-show="spec.mark != \'single\'"><div class="shelf"><div class="shelf-label drop-target">副标题</div><div class="field-drop"><input type="text" class="full-width" ng-blur="setNormalTitle(\'sub_title\');" ng-model="normalSubTitle"></div></div></div><div class="shelf-group" ng-show="spec.mark != \'single\'"><div class="shelf"><div class="shelf-label drop-target">标题大小</div><div class="field-drop"><div style="width: 80%;margin: 0;" range-slider="" min="10" max="24" model-max="ecconfig.title.subtextStyle.fontSize" pin-handle="min"></div><input type="text" style="width:25px;" ng-model="ecconfig.title.subtextStyle.fontSize"></div></div></div><div class="shelf-group" ng-show="spec.mark != \'single\'"><div class="shelf"><div class="shelf-label drop-target">颜色</div><div class="field-drop"><input type="text" class="full-width color-input-title" ng-blur="setColor(\'sbt\')" rel="sbt" ng-model="subtitletextcolor"></div></div></div><div class="shelf-group" ng-show="spec.mark != \'single\'"><div class="shelf"><div class="shelf-label drop-target">显示位置</div><div class="field-drop"><select class="full-width" ng-model="ecconfig.title.position"><option value="upleft">左上</option><option value="upcenter">上中心</option><option value="upright">右上</option><option value="downleft">左下</option><option value="downcenter">下中心</option><option value="downright">右下</option></select></div></div></div></div><div class="shelf-pane shelf-marks-pane full-width" ng-show="spec.mark != \'bmap\' && spec.mark != \'single\' && themeShow"><div class="shelf-group"><div class="shelf"><div class="shelf-label drop-target">主题样式</div><div class="field-drop"><select class="full-width" ng-model="ecconfig.theme"><option value="def">默认</option><option value="rabow">彩虹</option><option value="warm">温暖</option><option value="lsoft">轻柔</option><option value="xc">炫彩</option><option value="blue">蓝色</option><option value="red">红色</option><option value="green">绿色</option><option value="daynt">晚霞</option><option value="sotc">柔彩</option><option value="soft">柔和</option><option value="busi">商务</option><option value="told">怀旧</option><option value="feture">未来</option><option value="ged">格调</option><option value="huol">活力</option><option value="rockq">石青</option><option value="modern">现代</option><option value="vitality">活力四射</option><option value="greenGarden">绿色花园</option><option value="roman">紫丁香</option><option value="purple">紫罗兰</option><option value="air">清新空气</option><option value="MT">MT标准色</option></select></div></div></div></div><div class="shelf-pane shelf-positional-pane full-width" ng-show="spec.mark == \'bmap\' && ecconfig.mapdata.ifBmap != \'1\' && themeShow"><div class="shelf-group"><div class="shelf-label drop-target">地图样式</div><div class="field-drop"><select class="full-width" ng-model="ecconfig.mapdata.map_theme"><option value="light">明</option><option value="dark">暗</option></select></div></div></div><h2 ng-click="propShow = !propShow">数据关联</h2><div class="shelf-pane shelf-marks-pane full-width" ng-show="spec.mark == \'single\' && propShow"><div class="shelf-group"><div class="shelf"><div class="shelf-label drop-target">标题</div><div class="field-drop"><input type="text" class="full-width" ng-blur="setNormalTitle(\'title\');" ng-model="normalTitle"></div></div></div><ec-channel channel-title="\'维度\'" can-drag="\'1\'" field="ecconfig.field.x" modal="ecconfig" remove-action="removeMix(\'x\',\'0\')" ng-show="ecconfig.field.y[0]&&ecconfig.field.y[0].aggregate==\'rank\'"></ec-channel><ec-channel channel-title="\'分组\'" can-drag="\'1\'" field="ecconfig.field.group" modal="ecconfig" remove-action="removeMix(\'group\',\'1\')" ng-show="ecconfig.field.y[0]&&ecconfig.field.y[0].aggregate==\'rank\'"></ec-channel><ec-channel drop-type="\'single\'" can-drop="\'1\'" channel-title="\'度量\'" can-drag="\'0\'" channel-key="yval" remove-action="removeMix(\'y\',$index)" ng-repeat="yval in ecconfig.field.y track by $index" field="yval" modal="ecconfig"></ec-channel><div class="shelf-group" ng-show="ecconfig.field.y.length < 4"><div class="shelf"><div class="field-drop" ng-model="singleModel" data-drop="true" jqyoui-droppable="{onDrop:\'singleFieldDrop\'}" data-jqyoui-options="{activeClass: \'drop-active\'}"><span class="placeholder">拖动字段到此处统计度量度</span></div></div></div></div><div class="shelf-pane shelf-echart-pane full-width" ng-show="spec.mark == \'pie\' && propShow"><ec-channel channel-title="\'维度\'" drop-type="\'label\'" can-drop="\'1\'" can-drag="\'0\'" channel-key="xkey" remove-action="removeMix(\'x\',$index)" ng-repeat="xval in ecconfig.field.x track by $index" field="xval" modal="ecconfig"></ec-channel><div class="shelf-group"><div class="shelf"><div class="field-drop" ng-model="piexmodel" data-drop="true" jqyoui-droppable="{onDrop:\'piexFieldDrop\'}" data-jqyoui-options="{activeClass: \'drop-active\'}"><span class="placeholder">拖动字段到此处统计维度</span></div></div></div><ec-channel channel-title="\'度量\'" can-drag="\'1\'" channel-key="\'0\'" can-drop="\'1\'" remove-action="removeMix(\'y\',\'0\')" field="ecconfig.field.y" modal="ecconfig"></ec-channel></div><div class="shelf-pane shelf-marks-pane full-width" ng-show="spec.mark == \'mixed\' && propShow"><ec-channel channel-title="\'维度\'" can-drag="\'1\'" channel-key="\'0\'" can-drop="\'1\'" more-drag="\'true\'" drop-type="\'mixedtype\'" remove-action="removeMix(\'x\',\'0\')" field="ecconfig.field.x" modal="ecconfig"></ec-channel><ec-channel channel-title="\'度量\'" drop-type="\'type\'" can-drop="\'1\'" can-drag="\'0\'" remove-action="removeMix(\'y\',$index)" ng-repeat="yval in ecconfig.field.y track by $index" field="yval" modal="ecconfig"></ec-channel><div class="shelf-group"><div class="shelf"><div class="field-drop" ng-model="ymodel" data-drop="true" jqyoui-droppable="{onDrop:\'mixedyFieldDrop\'}" data-jqyoui-options="{activeClass: \'drop-active\'}"><span class="placeholder">拖动数值类字段到此处统计度量</span></div></div></div></div><div class="shelf-pane shelf-marks-pane full-width" ng-show="spec.mark == \'candlestick\' && propShow"><ec-channel channel-title="\'维度\'" can-drag="\'1\'" channel-key="\'0\'" more-drag="\'true\'" drop-type="\'candlestick\'" remove-action="removeMix(\'x\',\'0\')" field="ecconfig.field.x" modal="ecconfig"></ec-channel><ec-channel channel-title="\'start\'" can-drag="\'1\'" can-drop="\'1\'" remove-action="removeMix(\'start\',\'0\')" field="ecconfig.field.start" modal="ecconfig"></ec-channel><ec-channel channel-title="\'end\'" can-drag="\'1\'" can-drop="\'1\'" remove-action="removeMix(\'end\',\'0\')" field="ecconfig.field.end" modal="ecconfig"></ec-channel><ec-channel channel-title="\'max\'" can-drag="\'1\'" can-drop="\'1\'" remove-action="removeMix(\'max\',\'0\')" field="ecconfig.field.max" modal="ecconfig"></ec-channel><ec-channel channel-title="\'min\'" can-drag="\'1\'" can-drop="\'1\'" remove-action="removeMix(\'min\',\'0\')" field="ecconfig.field.min" modal="ecconfig"></ec-channel><ec-channel channel-title="\'度量\'" drop-type="\'candlesticktype\'" can-drop="\'1\'" can-drag="\'0\'" remove-action="removeMix(\'y\',$index)" ng-repeat="yval in ecconfig.field.y track by $index" field="yval" modal="ecconfig"></ec-channel><div class="shelf-group"><div class="shelf"><div class="field-drop" ng-model="ymodel" data-drop="true" jqyoui-droppable="{onDrop:\'kyFieldDrop\'}" data-jqyoui-options="{activeClass: \'drop-active\'}"><span class="placeholder">拖动数值类字段到此处统计度量</span></div></div></div></div><div class="shelf-pane shelf-echart-pane full-width" ng-show="spec.mark == \'wordCloud\' && propShow"><ec-channel channel-title="\'维度\'" can-drag="\'1\'" remove-action="removeMix(\'x\',\'0\')" field="ecconfig.field.x[0]" modal="ecconfig"></ec-channel><ec-channel channel-title="\'度量\'" can-drag="\'1\'" can-drop="\'1\'" remove-action="removeMix(\'y\',\'0\')" field="ecconfig.field.y" modal="ecconfig"></ec-channel></div><div class="shelf-pane shelf-echart-pane full-width" ng-show="spec.mark == \'treemap\' && propShow"><ec-channel channel-title="\'维度\'" can-drag="\'1\'" remove-action="removeMix(\'x\',\'0\')" field="ecconfig.field.x[0]" modal="ecconfig"></ec-channel><ec-channel channel-title="\'度量\'" can-drag="\'1\'" can-drop="\'1\'" remove-action="removeMix(\'y\',\'0\')" field="ecconfig.field.y" modal="ecconfig"></ec-channel></div><div class="shelf-pane shelf-echart-pane full-width" ng-show="spec.mark == \'tree\' && propShow"><ec-channel channel-title="\'维度\'" can-drag="\'1\'" remove-action="removeMix(\'x\',\'0\')" field="ecconfig.field.x" modal="ecconfig"></ec-channel><ec-channel channel-title="\'度量\'" can-drag="\'1\'" can-drop="\'1\'" remove-action="removeMix(\'y\',\'0\')" field="ecconfig.field.y" modal="ecconfig"></ec-channel><ec-channel channel-title="\'关联\'" can-drag="\'1\'" can-drop="\'0\'" remove-action="removeMix(\'relate\',\'0\')" field="ecconfig.field.relate" modal="ecconfig"></ec-channel></div><div class="shelf-pane shelf-echart-pane full-width" ng-show="spec.mark == \'graph\' && propShow"><ec-channel channel-title="\'维度\'" can-drag="\'1\'" remove-action="removeMix(\'x\',\'0\')" field="ecconfig.field.x[0]" modal="ecconfig"></ec-channel><ec-channel channel-title="\'度量\'" can-drag="\'1\'" can-drop="\'1\'" remove-action="removeMix(\'y\',\'0\')" field="ecconfig.field.y" modal="ecconfig"></ec-channel><ec-channel channel-title="\'关联\'" can-drag="\'1\'" can-drop="\'0\'" remove-action="removeMix(\'relate\',\'0\')" field="ecconfig.field.relate" modal="ecconfig"></ec-channel></div><div class="shelf-pane shelf-echart-pane full-width" ng-show="spec.mark == \'sunburst\' && propShow"><ec-channel channel-title="\'维度\'" can-drag="\'1\'" remove-action="removeMix(\'x\',\'0\')" field="ecconfig.field.x[0]" modal="ecconfig"></ec-channel><ec-channel channel-title="\'度量\'" can-drag="\'1\'" can-drop="\'1\'" remove-action="removeMix(\'y\',\'0\')" field="ecconfig.field.y" modal="ecconfig"></ec-channel><ec-channel channel-title="\'关联\'" can-drag="\'1\'" can-drop="\'0\'" remove-action="removeMix(\'relate\',\'0\')" field="ecconfig.field.relate" modal="ecconfig"></ec-channel></div><div class="shelf-pane shelf-echart-pane full-width" ng-show="spec.mark == \'funnel\' && propShow"><ec-channel channel-title="\'维度\'" can-drag="\'1\'" remove-action="removeMix(\'x\',\'0\')" field="ecconfig.field.x[0]" modal="ecconfig"></ec-channel><ec-channel channel-title="\'度量\'" can-drag="\'1\'" can-drop="\'1\'" remove-action="removeMix(\'y\',\'0\')" field="ecconfig.field.y" modal="ecconfig"></ec-channel></div><div class="shelf-pane shelf-positional-pane full-width" ng-show="spec.mark == \'gauge\' && propShow"><ec-channel channel-title="\'度量\'+($index+1)" can-drag="\'1\'" more-drag="\'true\'" drop-type="\'style\'" can-drop="\'1\'" channel-key="\'0\'" remove-action="removeMix(\'y\',$index)" ng-repeat="gaugemodal in ecconfig.field.y track by $index" field="gaugemodal" modal="ecconfig"></ec-channel><div class="shelf-group" ng-show="ecconfig.field.y.length < 3"><div class="shelf"><div class="field-drop" ng-model="gaugeY" can-drop="\'1\'" data-drop="true" jqyoui-droppable="{onDrop:\'gaugeYFieldDrop\'}" data-jqyoui-options="{activeClass: \'drop-active\'}"><span class="placeholder">拖动数值类字段到此处统计度量</span></div></div></div></div><div class="shelf-pane shelf-positional-pane full-width" ng-show="spec.mark == \'bmap\' && propShow"><div class="shelf-group"><div class="tab active" ng-class="{\'tab1\':\'tab-active\'}[tab]" ng-click="setTab(\'tab1\');">区域</div><div class="tab" ng-class="{\'tab2\':\'tab-active\'}[tab]" ng-click="setTab(\'tab2\');">标记</div></div></div><div class="shelf-pane shelf-positional-pane full-width" ng-show="spec.mark == \'bmap\' && tab == \'tab1\' && propShow"><div class="shelf-group" ng-if="ecconfig.mapdata.ifBmap == \'1\'">百度地图不支持区域数据展示</div><ec-channel channel-title="\'区域地区\'" can-drag="\'1\'" channel-key="\'0\'" remove-action="removeArea(\'x\')" field="ecconfig.area.x" modal="ecconfig"></ec-channel><ec-channel channel-title="\'区域数值\'" can-drop="\'1\'" can-drag="\'1\'" channel-key="\'0\'" remove-action="removeArea(\'y\')" field="ecconfig.area.y" modal="ecconfig"></ec-channel></div><div class="shelf-pane shelf-positional-pane full-width" ng-repeat="pointrow in ecconfig.point track by $index" ng-show="spec.mark == \'bmap\' && tab == \'tab2\' && propShow"><ec-channel channel-title="\'标记地区\'" drop-type="\'mappoint\'" can-drop="\'1\'" can-drag="\'1\'" channel-key="\'0\'" remove-action="removePoint(\'x\',$index)" field="pointrow.x" modal="ecconfig"></ec-channel><ec-channel channel-title="\'标记数值\'" can-drop="\'1\'" can-drag="\'1\'" channel-key="\'0\'" remove-action="removePoint(\'y\',$index)" field="pointrow.y" modal="ecconfig"></ec-channel><ec-channel channel-title="\'经度\'" can-drop="\'0\'" can-drag="\'1\'" channel-key="\'0\'" remove-action="removePoint(\'lon\',$index)" field="pointrow.lon" modal="ecconfig"></ec-channel><ec-channel channel-title="\'纬度\'" can-drop="\'0\'" can-drag="\'1\'" channel-key="\'0\'" remove-action="removePoint(\'lat\',$index)" field="pointrow.lat" modal="ecconfig"></ec-channel></div><div class="shelf-pane shelf-positional-pane full-width" ng-show="spec.mark == \'bmap\' && tab == \'tab2\' && propShow"><div class="shelf-group" ng-show="ecconfig.point.length < 3"><div class="shelf"><div class="field-drop" ng-model="pointModel" data-drop="true" jqyoui-droppable="{onDrop:\'pointFieldDrop\'}" data-jqyoui-options="{activeClass: \'drop-active\'}"><span class="placeholder">拖动地区字段到此处增加标记</span></div></div></div></div><div class="shelf-pane shelf-positional-pane full-width" ng-if="spec.mark == \'bmap\' && propShow"><div class="shelf-group"><div class="shelf"><div class="shelf-label drop-target">地图包</div><div class="field-drop"><select class="full-width" ng-model="ecconfig.mapbag"><option value="china">中国</option><option value="shanghai">上海</option></select></div></div></div><div class="shelf-group"><div class="shelf"><div class="shelf-label drop-target">百度地图</div><div class="field-drop"><input type="checkbox" ng-true-value="\'1\'" ng-false-value="\'2\'" ng-model="ecconfig.mapdata.ifBmap"></div></div></div></div><div class="shelf-pane shelf-marks-pane full-width" ng-show="spec.mark == \'dbar\' && propShow"><ec-channel channel-title="\'维度\'" can-drag="\'1\'" channel-key="\'0\'" remove-action="removeMix(\'x\',\'0\')" field="ecconfig.field.x" modal="ecconfig"></ec-channel><ec-channel channel-title="\'横轴度量\'" can-drag="\'1\'" can-drop="\'0\'" remove-action="removeMix(\'y\',\'0\')" field="ecconfig.field.y[0]" modal="ecconfig"></ec-channel><ec-channel channel-title="\'纵轴度量\'" can-drag="\'1\'" can-drop="\'1\'" drop-type="\'dbar\'" remove-action="removeMix(\'y\',\'1\')" field="ecconfig.field.y[1]" modal="ecconfig"></ec-channel></div><div class="shelf-pane shelf-marks-pane full-width" ng-show="spec.mark == \'scatter\' && propShow"><ec-channel channel-title="\'维度\'" can-drag="\'1\'" channel-key="\'0\'" remove-action="removeMix(\'x\',\'0\')" field="ecconfig.field.x" modal="ecconfig"></ec-channel><ec-channel channel-title="\'横轴度量\'" can-drag="\'1\'" can-drop="\'1\'" remove-action="removeMix(\'y\',\'0\')" field="ecconfig.field.y[0]" modal="ecconfig"></ec-channel><ec-channel channel-title="\'纵轴度量\'" can-drag="\'1\'" can-drop="\'1\'" remove-action="removeMix(\'y\',\'1\')" field="ecconfig.field.y[1]" modal="ecconfig"></ec-channel></div><div class="shelf-pane shelf-marks-pane full-width" ng-show="spec.mark == \'radar\' && propShow"><ec-channel channel-title="\'分类\'" can-drag="\'1\'" remove-action="removeMix(\'legend\',\'0\')" field="ecconfig.field.legend" modal="ecconfig"></ec-channel><ec-channel channel-title="\'维度\'" can-drag="\'1\'" remove-action="removeMix(\'x\',\'0\')" field="ecconfig.field.x" modal="ecconfig"></ec-channel><ec-channel channel-title="\'度量\'" can-drag="\'1\'" can-drop="\'1\'" remove-action="removeMix(\'y\',\'0\')" field="ecconfig.field.y" modal="ecconfig"></ec-channel></div><h2 ng-show="hasOption(spec.mark)" ng-click="optionShow = !optionShow">扩展选项</h2><div class="shelf-pane shelf-marks-pane full-width" ng-show="spec.mark == \'mixed\' && optionShow"><div class="shelf-group"><div class="shelf"><div class="shelf-label drop-target">合并</div><div class="field-drop"><input type="checkbox" ng-true-value="\'1\'" ng-false-value="\'2\'" ng-model="ecconfig.ifmerge"></div></div></div><div class="shelf-group"><div class="shelf"><div class="shelf-label drop-target">缩放</div><div class="field-drop"><input type="checkbox" ng-true-value="\'1\'" ng-false-value="\'2\'" ng-model="ecconfig.roominout"></div></div></div><div class="shelf-group"><div class="shelf"><div class="shelf-label drop-target">转置</div><div class="field-drop"><input type="checkbox" ng-true-value="\'1\'" ng-false-value="\'2\'" ng-model="ecconfig.transpose"></div></div></div><div class="shelf-group"><div class="shelf"><div class="shelf-label drop-target">美化高低值</div><div class="field-drop"><input type="checkbox" ng-true-value="\'1\'" ng-false-value="\'2\'" ng-model="ecconfig.beauty"></div></div></div><div class="shelf-group"><div class="shelf"><div class="shelf-label drop-target">倾斜标签</div><div class="field-drop"><input type="checkbox" ng-true-value="\'1\'" ng-false-value="\'2\'" ng-model="ecconfig.roatetext"></div></div></div><div class="shelf-group"><div class="shelf"><div class="shelf-label drop-target">隐藏坐标系</div><div class="field-drop"><input type="checkbox" ng-true-value="\'1\'" ng-false-value="\'2\'" ng-model="ecconfig.showaxis"></div></div></div><div class="shelf-group"><div class="shelf"><div class="shelf-label drop-target">坐标系内置</div><div class="field-drop"><input type="checkbox" ng-true-value="\'1\'" ng-false-value="\'2\'" ng-model="ecconfig.axisin"></div></div></div><div class="shelf-group"><div class="shelf"><div class="shelf-label drop-target">隐藏分隔线</div><div class="field-drop"><input type="checkbox" ng-true-value="\'1\'" ng-false-value="\'2\'" ng-model="ecconfig.showaxissplitline"></div></div></div><div class="shelf-group"><div class="shelf"><div class="shelf-label drop-target">柱角弧度</div><div class="field-drop"><div style="width: 80%;margin: 0;" range-slider="" min="0" max="100" model-max="ecconfig.barradius" pin-handle="min"></div><input type="text" style="width:25px;" ng-model="ecconfig.barradius"></div></div></div></div><div class="shelf-pane shelf-marks-pane full-width" ng-if="spec.mark == \'wordCloud\' && optionShow"><div class="shelf-group"><div class="shelf"><div class="shelf-label drop-target">词云形状</div><div class="field-drop"><select class="full-width" ng-model="ecconfig.shape"><option value="circle">circle</option><option value="cardioid">cardioid</option><option value="diamond">diamond</option><option value="triangle-forward">triangle-forward</option><option value="triangle">triangle</option><option value="pentagon">pentagon</option><option value="star">star</option></select></div></div></div><div class="shelf-group"><div class="shelf"><div class="shelf-label">单词大小</div><div class="field-drop"><div range-slider="" style="width: 100%;margin: 0;" show-values="true" step="1" min="10" max="100" model-min="ecconfig.sizeRange[0]" model-max="ecconfig.sizeRange[1]"></div></div></div></div></div><div class="shelf-pane shelf-marks-pane full-width" ng-if="spec.mark == \'single\' && optionShow"><div class="shelf-group"><div class="shelf"><div class="shelf-label drop-target">形式</div><div class="field-drop"><select class="full-width" ng-model="ecconfig.type"><option value="card">指标卡</option><option value="list">指标条</option></select></div></div></div><div class="shelf-group"><div class="shelf"><div class="shelf-label drop-target">小数点</div><div class="field-drop"><input type="text" class="full-width" ng-model="ecconfig.option.fixed"></div></div></div><div class="shelf-group"><div class="shelf"><div class="shelf-label drop-target">显示千分位</div><div class="field-drop"><input type="checkbox" ng-true-value="true" ng-false-value="false" ng-model="ecconfig.option.thousands"></div></div></div><div class="shelf-group" ng-show="ecconfig.type == \'card\'"><div class="shelf"><div class="shelf-label drop-target">外框颜色</div><div class="field-drop"><input type="text" class="full-width color-input-single" ng-blur="setColor(\'stroke\')" rel="stroke" ng-model="stroke_color"></div></div></div><div class="shelf-group" ng-show="ecconfig.type == \'card\'"><div class="shelf"><div class="shelf-label drop-target">背景颜色</div><div class="field-drop"><input type="text" class="full-width color-input-single" ng-blur="setColor(\'fill\')" rel="fill" ng-model="fill_color"></div></div></div></div><div class="shelf-pane shelf-echart-pane full-width" ng-show="spec.mark == \'pie\' && optionShow"><div class="shelf-group"><div class="shelf"><div class="shelf-label drop-target">圆心距离</div><div class="field-drop"><div range-slider="" min="0" max="100" model-max="ecconfig.start_radius" pin-handle="min" style="width:80%;margin:0px"></div><input type="text" style="width:25px;" ng-model="ecconfig.start_radius"></div></div><div class="shelf"><div class="shelf-label drop-target">嵌套间隔</div><div class="field-drop"><div range-slider="" min="0" max="100" model-max="ecconfig.radius_range" pin-handle="min" style="width:80%;margin:0px"></div><input type="text" style="width:25px;" ng-model="ecconfig.radius_range"></div></div><div class="shelf"><div class="shelf-label drop-target">填充宽度</div><div class="field-drop"><div range-slider="" min="0" max="100" model-max="ecconfig.radius_interval" pin-handle="min" style="width:80%;margin:0px"></div><input type="text" style="width:25px;" ng-model="ecconfig.radius_interval"></div></div><div class="shelf"><div class="shelf-label drop-target">分断显示</div><div class="field-drop"><div range-slider="" min="0" max="10" model-max="ecconfig.radius_split" pin-handle="min" style="width:80%;margin:0px"></div><input type="text" style="width:25px;" ng-model="ecconfig.radius_split"></div></div></div></div><div class="shelf-pane shelf-echart-pane full-width" ng-show="spec.mark == \'gauge\' && optionShow"><div class="shelf-group"><div class="shelf"><div class="shelf-label drop-target">合并</div><div claf="field-drop"><input type="checkbox" ng-true-value="\'1\'" ng-false-value="\'2\'" ng-model="ecconfig.ifmerge"></div></div></div></div><h2 ng-show="hasLegend(spec.mark)" ng-click="legendShow = !legendShow">图例</h2><div class="shelf-pane shelf-echart-pane full-width" ng-show="hasLegend(spec.mark) && legendShow"><div class="shelf-group"><div class="shelf"><div class="shelf-label drop-target">显示图例</div><div class="field-drop"><input type="checkbox" ng-true-value="\'1\'" ng-false-value="\'2\'" ng-model="ecconfig.legend.show"></div></div></div><div class="shelf-group"><div class="shelf"><div class="shelf-label drop-target">图例平铺</div><div class="field-drop"><input type="checkbox" ng-true-value="\'horizontal\'" ng-false-value="\'vertical\'" ng-model="ecconfig.legend.orient"></div></div></div><div class="shelf-group"><div class="shelf"><div class="shelf-label drop-target">滚动图例</div><div class="field-drop"><input type="checkbox" ng-true-value="\'scroll\'" ng-false-value="\'plain\'" ng-model="ecconfig.legend.type"></div></div></div><div class="shelf-group"><div class="shelf"><div class="shelf-label drop-target">图例位置</div><div class="field-drop"><select class="full-width" ng-model="ecconfig.legend.position"><option value="upleft">左上</option><option value="upcenter">上中心</option><option value="upright">右上</option><option value="downleft">左下</option><option value="downcenter">下中心</option><option value="downright">右下</option></select></div></div></div><div class="shelf-group"><div class="shelf"><div class="shelf-label drop-target">图例文字</div><div class="field-drop"><div style="width: 80%;margin: 0;" range-slider="" min="4" max="100" model-max="ecconfig.legend.fontSize" pin-handle="min"></div><input type="text" style="width:25px;" ng-model="ecconfig.legend.fontSize"></div></div></div></div><h2 ng-click="filterShow = !filterShow">过滤条件</h2><div class="shelf-pane shelf-marks-pane full-width" ng-show="filterShow"><ec-channel channel-title="\'年份\'" drop-type="\'filter\'" can-drop="\'1\'" can-drag="\'1\'" remove-action="removeFilter(\'year\')" field="ecconfig.filter.year.field" modal="ecconfig"></ec-channel><ec-channel channel-title="\'月份\'" drop-type="\'filter\'" can-drop="\'1\'" can-drag="\'1\'" remove-action="removeFilter(\'month\')" field="ecconfig.filter.month.field" modal="ecconfig"></ec-channel><ec-channel channel-title="\'过滤字段\'+($index+1)" can-drag="\'1\'" more-drag="\'true\'" drop-type="\'filters\'" can-drop="\'1\'" channel-key="\'filters\'" remove-action="removeFilter(\'filters\',$index)" ng-repeat="filtermodal in ecconfig.filter.filters track by $index" field="filtermodal" modal="ecconfig"></ec-channel><div class="shelf-group"><div class="shelf"><div class="field-drop" ng-model="filtermodal" can-drop="\'1\'" data-drop="true" jqyoui-droppable="{onDrop:\'filterFieldDrop\'}" data-jqyoui-options="{activeClass: \'drop-active\'}"><span class="placeholder">拖动字段到此处进行过滤</span></div></div></div></div></div></div>'),e.put("components/schemalist/schemalist.html",'<div class="schema no-top-margin full-width scroll-y"><schema-list-item ng-repeat="fieldDef in fieldDefs | orderBy : orderBy" field-def="fieldDef" filter-manager="filterManager" show-add="showAdd" ng-if="fieldDef.hidden!=\'true\'"></schema-list-item><schema-list-item ng-if="showCount" field-def="countFieldDef" show-add="true"></schema-list-item><schema-list-item field-def="calcFieldDef" show-add="true"></schema-list-item><div class="schema-list-drop" ng-show="showDrop" ng-model="droppedFieldDef" data-drop="true" jqyoui-droppable="{onDrop:\'fieldDropped\'}" data-jqyoui-options="{activeClass: \'drop-active\'}">Create a new wildcard.</div></div>'),e.put("components/schemalist/schemalistitem.html",'<div class="schema-list-item" ng-model="droppedFieldDef" data-drop="isAnyField && fieldDef.field !== \'?\'" jqyoui-droppable="{onDrop:\'fieldDropped\'}" data-jqyoui-options="{activeClass: \'drop-active\'}"><field-info ng-show="!isAnyField || fieldDef.field === \'?\' || fieldDef.field.enum.length > 0" class="pill draggable full-width no-right-margin" ng-class="{any: isEnumSpec(fieldDef.field)}" field-def="fieldDef" ng-model="pill" data-drag="true" jqyoui-draggable="{placeholder: \'keep\', deepCopy: true, onStart: \'fieldDragStart\', onStop:\'fieldDragStop\'}" data-jqyoui-options="{revert: \'invalid\', helper: \'clone\'}" show-add="showAdd" show-caret="true" disable-caret="fieldDef.immutable || fieldDef.aggregate === \'count\' || allowedTypes.length<=1" show-type="true" add-action="fieldAdd(fieldDef)" show-filter="!!filterManager" filter-action="toggleFilter()" use-title="true" popup-content="fieldInfoPopupContent"></field-info></div><div class="drop-container"><div class="popup-menu schema-menu" ng-hide="!allowedTypes || allowedTypes.length<=1"><div class="mb5 field-type" ng-if="allowedTypes.length>1 && !isAnyField"><h4>Type</h4><label class="type-label" ng-repeat="type in allowedTypes" ng-if="type !== \'ordinal\' || !consts.hideOrdinalTypeSelect"><input type="radio" ng-value="type" ng-model="fieldDef.type"> {{type}}</label></div><div class="wildcard-menu" ng-show="isAnyField && fieldDef.field.enum"><div><label class="wildcard-title-label"><h4>Name</h4><input type="text" ng-model="fieldDef.title" placeholder="{{fieldTitle(fieldDef.field)}}"></label></div><h4>Wildcard Fields</h4><div class="wildcard-fields"><field-info ng-repeat="field in fieldDef.field.enum" class="pill list-item full-width no-right-margin" field-def="field === \'*\' ? countFieldDef : Dataset.schema.fieldSchema(field)" show-type="true" show-remove="true" remove-action="removeWildcardField($index)"></field-info></div><a class="remove-action" ng-click="removeWildcard()"><i class="fa fa-times"></i> Delete Wildcard</a></div></div></div>'),e.put("components/modal/modal.html",'<div class="ngmodal" ng-if="isOpen"><div class="modal-wrapper" style="{{wrapperStyle}}" ng-transclude=""></div></div>'),e.put("components/modal/modalclosebutton.html",'<div class="right"><a ng-click="closeModal()" class="right"><i class="fa fa-times"></i></a></div>'),e.put("components/tabs/tab.html",'<div ng-if="active" ng-transclude=""></div>'),e.put("components/tabs/tabset.html",'<div class="tab-container"><div><a class="tab" ng-repeat="tab in tabset.tabs" ng-class="{\'active\': tab.active}" ng-click="tabset.showTab(tab)">{{tab.heading}}</a></div><div class="tab-contents" ng-transclude=""></div></div>')}])}(),function(){"use strict";angular.module("vlui").filter("inGroup",["_",function(e){return function(i,t){return e.filter(i,{group:t})}}]),angular.module("vlui").directive("changeLoadedDataset",["Dataset","_",function(e,i){return{templateUrl:"dataset/changeloadeddataset.html",restrict:"E",require:"?^^modal",replace:!0,scope:!0,link:function(t,n,l,o){function a(){o&&o.close()}t.Dataset=e,t.userData=i.filter(e.datasets,function(e){return"sample"!==e.group}),t.sampleData=i.filter(e.datasets,{group:"sample"});var r=t.$watch(function(){return e.datasets.length},function(){t.userData=i.filter(e.datasets,function(e){return"sample"!==e.group})});t.selectDataset=function(i){e.update(i),a()},t.SearchChange=function(i){for(var t=e.datasets,n=0;n<t.length;n++)t[n].hidden="false",
""!=i.currentTarget.value&&t[n].name.toString().toLowerCase().indexOf(i.currentTarget.value.toString().toLowerCase())<0&&t[n].description.indexOf(i.currentTarget.value.toString().toLowerCase())<0&&(t[n].hidden="true")},t.$on("$destroy",function(){r()})}}}])}(),function(){"use strict";angular.module("vlui").factory("Dataset",["$http","$q","_","cql","SampleData","Config","Logger",function(e,i,t,n,l,o,a){function r(e,i){s.data=i,s.currentDataset=e,s.schema=n.schema.Schema.build(i)}var s={},d=l;s.datasets=d,s.dataset=d[0],s.currentDataset=void 0,s.stats={},s.type=void 0,s.noData=!1,s.loading=!1,s.nowName="";var c={nominal:0,ordinal:0,geographic:2,temporal:3,quantitative:4};return s.fieldOrderBy={},s.fieldOrderBy.type=function(e){return"count"===e.aggregate?4:c[e.type]},s.fieldOrderBy.typeThenName=function(e){return s.fieldOrderBy.type(e)+"_"+("count"===e.aggregate?"~":e.field.toLowerCase())},s.fieldOrderBy.original=function(){return 0},s.fieldOrderBy.field=function(e){return e.field},s.fieldOrder=s.fieldOrderBy.typeThenName,s.onUpdate=[],s.update=function(n){s.data=[],s.loading=!0,s.nowName=n.name;var l;return a.logInteraction(a.actions.DATASET_CHANGE,n.name),l=n.values?i(function(e,i){s.type=void 0,r(n,n.values),e()}):e.get(n.url,{cache:!0}).then(function(e){var i;t.isObject(e.data)&&(i=e.data,s.type="json"),r(n,i),s.loading=!1}),s.onUpdate.forEach(function(e){l=l.then(e)}),l.then(function(){o.updateDataset(n,s.type)}),l},s.buildSchema=function(){s.update(s.dataset)},s.add=function(e){return e.id||(e.id=e.url),d.push(e),e},s}])}(),function(){"use strict";angular.module("vlui").directive("datasetModal",function(){return{templateUrl:"dataset/datasetmodal.html",restrict:"E",scope:!1}})}(),function(){"use strict";angular.module("vlui").directive("datasetSelector",["Modals","Logger",function(e,i){return{templateUrl:"dataset/datasetselector.html",restrict:"E",replace:!0,scope:{},link:function(t){t.loadDataset=function(){i.logInteraction(i.actions.DATASET_OPEN),e.open("dataset-modal")}}}}])}(),function(){"use strict";angular.module("vlui").constant("SampleData",[{name:"Barley",description:"Barley yield by variety across the upper midwest in 1931 and 1932",url:"/data/barley.json",id:"barley",group:"sample"},{name:"Cars",description:"Automotive statistics for a variety of car models between 1970 & 1982",url:"/data/cars.json",id:"cars",group:"sample"},{name:"Crimea",url:"/data/crimea.json",id:"crimea",group:"sample"},{name:"Driving",url:"/data/driving.json",id:"driving",group:"sample"},{name:"Iris",url:"/data/iris.json",id:"iris",group:"sample"},{name:"Jobs",url:"/data/jobs.json",id:"jobs",group:"sample"},{name:"Population",url:"/data/population.json",id:"population",group:"sample"},{name:"Movies",url:"/data/movies.json",id:"movies",group:"sample"},{name:"Birdstrikes",url:"/data/birdstrikes.json",id:"birdstrikes",group:"sample"},{name:"Burtin",url:"/data/burtin.json",id:"burtin",group:"sample"},{name:"Campaigns",url:"/data/weball26.json",id:"weball26",group:"sample"}])}(),function(){"use strict";angular.module("vlui").directive("ecChannel",["Drop","$timeout",function(e,i){return{templateUrl:"components/ecchannel/ecchannel.html",restrict:"E",replace:!0,scope:{modal:"=",field:"=",canDrag:"<",channelTitle:"<",removeAction:"&",canDrop:"<",dropType:"<",moreDrag:"<"},link:function(t,n){function l(e){if(e=e.replace(/\s/g,""),""===e)return!1;if(/[\+\-\*\/]{2,}/.test(e))return!1;if(/\(\)/.test(e))return!1;if(/[\+\-\*\/]$/.test(e))return!1;for(var i,t=[],n=0;n<e.length;n++)if(i=e.charAt(n),"("===i)t.push("(");else if(")"===i){if(!(t.length>0))return!1;t.pop()}return 0===t.length&&(!/\([\+\-\*\/]/.test(e)&&(!/[\+\-\*\/]\)/.test(e)&&(!/[^\+\-\*\/]\(/.test(e)&&!/\)[^\+\-\*\/]/.test(e))))}var o={"#000000":"#000000","#ffffff":"#ffffff","#FF0000":"#FF0000","#777777":"#777777","#337ab7":"#337ab7","#5cb85c":"#5cb85c","#5bc0de":"#5bc0de","#f0ad4e":"#f0ad4e","#d9534f":"#d9534f","#FFFF00":"#FFFF00","#EE00EE":"#EE00EE","#ADFF2F":"#ADFF2F"};if(t.FieldDropped=function(){if("filter"==t.dropType){var e=new Date;t.thismodal.ifAuto="1","月份"==t.channelTitle?t.thismodal.value=e.getMonth():t.thismodal.value=e.getFullYear()}"dbar"==t.dropType&&(t.thismodal.showavgline=!1,t.thismodal.avglinevalue=null),t.thismodal.calcrules="",t.field=angular.copy(t.thismodal)},t.SplitDropped=function(){t.field.splitField=t.field.splitField||[],t.newmodel.color="#d5d931",t.newmodel.giveLength=!1,t.newmodel.length=0,t.field.splitField.push(angular.copy(t.newmodel))},t.removeSplit=function(e,i){Array.isArray(t.field.splitField)?t.field.splitField.splice(i,1):t.field.splitField=[]},t.showSplitPop=function(i){if(n.find(".echart-type"+i).length>0){var l=new e({content:n.find(".echart-type"+i)[0],target:n.find(".type-caret"+i)[0],position:"top left",openOn:"click"});l.on("open",function(){$(".split-color"+i).colorpicker({align:"right",colorSelectors:o}).on("changeColor",function(){t.field.splitField[i].color=$(this).val()})}),t.splitPopup=l,l.open()}},t.setSplitColor=function(e,i){"split"==e&&(t.field.splitField[i].color=angular.copy(t.field.splitField[i].color),console.log(t.field.splitField)),t.splitPopup.open()},n.find(".type-caret").length>0&&n.find(".echart-type").length>0){var a=new e({content:n.find(".echart-type")[0],target:n.find(".type-caret")[0],position:"top left",openOn:"click"});new e({content:n.find(".count-type")[0],target:n.find(".count-caret")[0],position:"top left",openOn:"click"});"type"==t.dropType&&t.field&&t.field.color&&(t.mix_color=angular.copy(t.field.color),a.on("open",function(){$(".drop-content .color-input").colorpicker({align:"right",colorSelectors:o}).on("changeColor",function(){t.mix_color=$(this).val()}),$(".alertcolor").colorpicker({align:"right",colorSelectors:o}).on("changeColor",function(){t.field.alertsConfigs[parseInt($(this).attr("idx"))].color=$(this).val()}),$(".color-label").colorpicker({align:"right",colorSelectors:o}).on("changeColor",function(){t.field.label.normal.color=$(this).val()})})),"mappoint"==t.dropType&&t.field&&t.field.color&&(t.point_color=angular.copy(t.field.color),t.point_top_color=angular.copy(t.field.top_color),a.on("open",function(){$(".drop-content .point-color-input").colorpicker({align:"right",colorSelectors:o}).on("changeColor",function(){"normal"==$(this).attr("rel")&&(t.point_color=$(this).val()),"top"==$(this).attr("rel")&&(t.point_top_color=$(this).val())})})),"single"==t.dropType&&t.field&&t.field._titleColor&&(t.single_title_color=angular.copy(t.field._titleColor),t.single_value_color=angular.copy(t.field._valueColor),a.on("open",function(){$(".drop-content .single-color").colorpicker({align:"right",colorSelectors:o}).on("changeColor",function(){"single_title"==$(this).attr("rel")&&(t.single_title_color=$(this).val()),"single_value"==$(this).attr("rel")&&(t.single_value_color=$(this).val())})})),"style"==t.dropType&&t.field&&a.on("open",function(){$(".split-color-input").colorpicker({align:"right",colorSelectors:o}).on("changeColor",function(){"normal"==$(this).attr("rel")&&(t.field.splitcolor=$(this).val()),"pointer"==$(this).attr("rel")&&(t.field.style.itemStyle.normal.color=$(this).val())})})}t.alertBlur=function(){t.field.alertsConfigs=t.field.alertsConfigs||[];var e=t.field.alertsConfigs.length;if(t.field.alertscount>e)for(var n=0;n<t.field.alertscount-e;n++)t.field.alertsConfigs.push({value:0,color:"red",name:"警示线"+(n+1)});else t.field.alertscount<e;t.field.alertsConfigs.splice(t.field.alertscount,e-t.field.alertscount),i(function(){$(".alertcolor").colorpicker({align:"right",colorSelectors:o}).on("changeColor",function(){t.field.alertsConfigs[$(this).attr("idx")].color=$(this).val()})},1e3)},t.groupcountBlur=function(){t.field.groupConfigs=t.field.groupConfigs||[];var e=t.field.groupConfigs.length;if(t.field.selfgroupcount>e)for(var i=1,n=0;n<t.field.selfgroupcount-e;n++)t.field.groupConfigs.push({valuestart:i,valueend:i+1,name:"分组"+(n+1)}),i+=2;else t.field.selfgroupcount<e;t.field.groupConfigs.splice(t.field.selfgroupcount,e-t.field.selfgroupcount)},t.setLineColor=function(e){t.field.alertsConfigs[e].color=angular.copy($(this).val()),a.open()},t.setMixColor=function(){t.field.color=angular.copy(t.mix_color),a.open()},t.setPointColor=function(e,i){"normal"==e&&(t.field.color=angular.copy(t.point_color)),"top"==e&&(t.field.top_color=angular.copy(t.point_top_color)),"single_title"==e&&(t.field._titleColor=angular.copy(t.single_title_color)),"single_value"==e&&(t.field._valueColor=angular.copy(t.single_value_color)),a.open()},t.getAllCols=function(){var e=$('div[ng-controller="MainCtrl"]').scope(),i=e.Dataset.schema.fieldSchemas;return i},t.$watch("field.truetype",function(e){t.field&&t.field.truetype&&t.field.type&&("area"===e?(t.field.type="line",t.field.isarea="1"):"linestep"===e?t.field.type="line":t.field.type=e,"bar"!==e&&(t.field.label.normal.position="top"))}),t.$on("$destroy",function(){a&&a.destroy&&a.destroy()}),t.addAnd=function(e){if(e){var n=t.field.rules.find(function(i){return i.id===e.parentid});if("and"==n.relate)t.field.rules.push({id:t.genID(20),parentid:n.id,name:t.field.field,relate:"and",rule:"==",value:""});else{var l=t.genID(20);t.field.rules.push({id:l,parentid:n.id,name:"",relate:"and",rule:"",value:""}),t.field.rules.push({id:t.genID(20),parentid:l,name:t.field.field,relate:"and",rule:"==",value:""}),t.field.rules.find(function(i){return i.id===e.id}).parentid=l}}else if(t.field.rules[0]&&"and"==t.field.rules[0].relate)t.field.rules.push({id:t.genID(20),parentid:t.field.rules[0].id,name:t.field.field,relate:"and",rule:"==",value:""});else{var l=t.genID(20);t.field.rules.push({id:l,parentid:"0",name:"",relate:"and",rule:"",value:""}),t.field.rules.push({id:t.genID(20),parentid:l,name:t.field.field,relate:"and",rule:"==",value:""})}i(function(){a.open()})},t.addOr=function(e){if(e){var n=t.field.rules.find(function(i){return i.id===e.parentid});if("or"==n.relate)t.field.rules.push({id:t.genID(20),parentid:n.id,name:t.field.field,relate:"or",rule:"==",value:""});else{var l=t.genID(20);t.field.rules.push({id:l,parentid:n.id,name:"",relate:"or",rule:"",value:""}),t.field.rules.push({id:t.genID(20),parentid:l,name:t.field.field,relate:"or",rule:"==",value:""}),t.field.rules.find(function(i){return i.id===e.id}).parentid=l}i(function(){a.open()})}},t.removeFilter=function(e){var n=[],l=[],o=[],r={};t.field.rules.map(function(i){i.parentid===e.parentid&&arguments[0].id!=e.id&&(""!=arguments[0].rule?n.push(i.id):l.push(i.id)),i.parentid===e.id&&o.push(i.id),i.id===e.parentid&&(r=i)}),0==n.length?(0!=l.length?(r.id&&t.field.rules.del(function(e){return e.id===r.id}),l.map(function(e){t.field.rules.map(function(i){e===i.id&&(i.parentid=r.parentid||"0")})})):""==r.rule&&t.field.rules.del(function(e){return e.id===r.id}),t.field.rules.del(function(i){return i.id===e.id})):t.field.rules.del(function(i){return i.id===e.id}),1==t.field.rules.length&&"0"==t.field.rules[0].parentid&&t.field.rules.pop(),i(function(){a.open()})},t.curentFilter=null,t.filterRowClick=function(e,i,n){t.curentFilter&&t.curentFilter.css("background-color",""),$(e.currentTarget).parent().css("background-color","lightgray"),t.curentFilter=$(e.currentTarget).parent()},t.genID=function(e){return Number(Math.random().toString().substr(3,e)+Date.now()).toString(36)},t.getChilds=function(e){var i=[];return t.field.rules.map(function(t){t.parentid===e&&i.push(t)}),i||[]},t.dropComplete=function(e,i,n){angular.element(".calc_div_fields").addClass("scroll-y"),t.addFieldCalc(arguments[1].helper[0].innerText)},t.calcheck="合法",t.addFieldCalc=function(e,i){t.field.calcrules=t.field.calcrules?t.field.calcrules:"",i?t.field.calcrules=e:t.field.calcrules+=" "+e,l(t.field.calcrules)?t.calcheck="合法":t.calcheck="不合法"},t.dragstop=function(e,i){angular.element(".calc_div_fields").addClass("scroll-y")},t.dragstart=function(e,i){angular.element(".calc_div_fields").removeClass("scroll-y")},t.deleteWords=function(e){var i=e.currentTarget;8==e.keyCode&&(d(i,angular.element(i).val(),r(i)),t.addFieldCalc(angular.element(i).val(),!0))};var r=function(e){var i=0;if(document.selection){e.focus();var t=document.selection.createRange();t.moveStart("character",-e.value.length),i=t.text.length}else(e.selectionStart||0===+e.selectionStart)&&(i=e.selectionStart);return i},s=function(e,i,t){if(e.setSelectionRange)e.setSelectionRange(i,t);else if(e.createTextRange){var n=e.createTextRange();n.moveStart("character",i),n.moveEnd("character",t),n.select()}},d=function(e,i,t){var n=t;if(" "!==i.charAt(t-1)){for(var l=t-2;l>=0;l--)if(" "===i.charAt(l)||0===l){n=l;break}s(e,n,t)}}}}}]),Array.prototype.del=function(e){var i=null;if("function"==typeof e)for(var t=0;t<this.length;t++)e(this[t],t)&&(i=t);null!==i&&this.splice(i,1)}}(),function(){"use strict";angular.module("vlui").directive("fieldInfo",["ANY","Drop","cql","Dataset",function(e,i,t,n){return{templateUrl:"components/fieldinfo/fieldinfo.html",restrict:"E",replace:!0,scope:{fieldDef:"<",filterAction:"&",showAdd:"<",showCaret:"<",showFilter:"=",showRemove:"<",showType:"<",showEnumSpecFn:"<",popupContent:"<",action:"&",addAction:"&",removeAction:"&",disableCaret:"<"},link:function(i,l){function o(i,n){if(t.enumSpec.isEnumSpec(i)){if(!i["enum"])return e;for(var l=null,o=0;o<i["enum"].length;o++){var a=i["enum"][o],r=n?n[a]:a;if(null===l)l=r;else if(l!==r)return e}return l}return n?n[i]:i}var a;i.typeName=null,i.icon=null,i["null"]=null,i.fieldTitle=function(e){return t.enumSpec.isEnumSpec(e)?(e["enum"]||["Wildcard"]).map(function(e){return"*"===e?"COUNT":e}).join(","):e},i.fieldCount=function(e){return t.enumSpec.isEnumSpec(e)&&e["enum"]?" ("+e["enum"].length+")":""},i.clicked=function(e){i.action&&e.target!==l.find(".fa-caret-down")[0]&&e.target!==l.find("span.type")[0]&&i.action(e)};var r=t.enumSpec.isEnumSpec;i.func=function(e){if(e.aggregate){if(!r(e.aggregate))return e.aggregate;if(i.showEnumSpecFn)return"?"}if(e.timeUnit){if(!r(e.timeUnit))return e.timeUnit;if(i.showEnumSpecFn)return"?"}if(e.bin){if(!r(e.bin))return"bin";if(i.showEnumSpecFn)return"?"}return e._aggregate||e._timeUnit||e._bin&&"bin"||e._any&&"auto"||""};var s={nominal:"fa-font",ordinal:"fa-font",quantitative:"icon-hash",temporal:"fa-calendar",calculator:"fa-calculator"};s[e]="fa-asterisk";var d=i.$watch("fieldDef.type",function(e){i.icon=o(e,s);var t=e;"ordinal"===t||"nominal"===t?t+=" ("+n.schema.primitiveType(i.fieldDef.field)+")":e&&e["enum"]&&(t=e["enum"][0]),i.typeName=t});i.$on("$destroy",function(){a&&a.destroy&&a.destroy(),d()})}}}])}(),function(){"use strict";angular.module("vlui").directive("modal",["$document","Modals",function(e,i){return{templateUrl:"components/modal/modal.html",restrict:"E",transclude:!0,scope:{autoOpen:"<",maxWidth:"@"},controller:["$scope",function(e){this.close=function(){e.isOpen=!1}}],link:function(t,n,l){function o(e){27===e.keyCode&&t.isOpen&&(t.isOpen=!1,t.$digest())}var a=l.id;t.maxWidth&&(t.wrapperStyle="max-width:"+t.maxWidth),t.isOpen=t.autoOpen,angular.element(e).on("keydown",o),i.register(a,t),t.$on("$destroy",function(){i.deregister(a)})}}}])}(),function(){"use strict";angular.module("vlui").directive("modalCloseButton",function(){return{templateUrl:"components/modal/modalclosebutton.html",restrict:"E",require:"^^modal",scope:{closeAction:"&"},link:function(e,i,t,n){e.closeModal=function(){n.close(),e.closeAction&&e.closeAction()}}}})}(),function(){"use strict";angular.module("vlui").factory("Modals",["$cacheFactory",function(e){var i=e("modals");return{register:function(e,t){return i.get(e)?void console.error("Cannot register two modals with id "+e):void i.put(e,t)},deregister:function(e){i.remove(e)},open:function(e){var t=i.get(e);return t?void(t.isOpen=!0):void console.error("Unregistered modal id "+e)},close:function(e){var t=i.get(e);return t?void(t.isOpen=!1):void console.error("Unregistered modal id "+e)},empty:function(){i.removeAll()},count:function(){return i.info().size}}}])}(),function(){"use strict";angular.module("vlui").directive("schemaList",["cql","Logger","Pills",function(e,i,t){return{templateUrl:"components/schemalist/schemalist.html",restrict:"E",scope:{orderBy:"<",fieldDefs:"<",filterManager:"=",showAdd:"<",showCount:"<",showDrop:"<"},replace:!0,link:function(n){n.Pills=t,n.isEnumSpec=e.enumSpec.isEnumSpec,n.droppedFieldDef={},n.countFieldDef=t.countFieldDef,n.calcFieldDef=t.calcFieldDef,n.fieldDropped=function(){i.logInteraction(i.actions.ADD_WILDCARD,n.droppedFieldDef),t.addWildcard(n.droppedFieldDef),n.droppedFieldDef={}}}}}])}(),function(){"use strict";angular.module("vlui").directive("schemaListItem",["Dataset","Drop","Logger","Pills","cql","consts",function(e,i,t,n,l,o){return{templateUrl:"components/schemalist/schemalistitem.html",restrict:"E",replace:!1,scope:{fieldDef:"=",showAdd:"<",filterManager:"="},link:function(i,a){i.Dataset=e,i.consts=o,i.countFieldDef=n.countFieldDef,i.isAnyField=!1,i.droppedFieldDef=null,i.fieldInfoPopupContent=a.find(".schema-menu")[0],i.isEnumSpec=l.enumSpec.isEnumSpec,i.fieldAdd=function(e){n.add(e)},i.toggleFilter=function(){i.filterManager&&i.filterManager.toggle(i.fieldDef.field)},i.fieldDragStart=function(){var e=i.fieldDef;i.pill={field:e.field,title:e.title,type:e.type,aggregate:e.aggregate},n.dragStart(i.pill,null)},i.fieldDragStop=n.dragStop,i.fieldDropped=function(){n.addWildcardField(i.fieldDef,i.droppedFieldDef),t.logInteraction(t.actions.ADD_WILDCARD_FIELD,i.fieldDef,{addedField:i.droppedFieldDef}),i.droppedFieldDef=null},i.removeWildcardField=function(e){var l=i.fieldDef.field;t.logInteraction(t.actions.REMOVE_WILDCARD_FIELD,i.fieldDef,{removedField:"*"===l["enum"][e]?"COUNT":l["enum"][e]}),n.removeWildcardField(i.fieldDef,e)},i.removeWildcard=function(){t.logInteraction(t.actions.REMOVE_WILDCARD,i.fieldDef),n.removeWildcard(i.fieldDef)};var r={Type:{QUANTITATIVE:"quantitative",quantitative:"QUANTITATIVE",ORDINAL:"ordinal",ordinal:"ORDINAL",TEMPORAL:"temporal",temporal:"TEMPORAL",NOMINAL:"nominal",nominal:"NOMINAL"},QUANTITATIVE:"quantitative",ORDINAL:"ordinal",TEMPORAL:"temporal",NOMINAL:"nominal",SHORT_TYPE:{quantitative:"Q",temporal:"T",nominal:"N",ordinal:"O"},TYPE_FROM_SHORT_TYPE:{Q:"quantitative",T:"temporal",O:"ordinal",N:"nominal"}},s={integer:[r.QUANTITATIVE,r.ORDINAL,r.NOMINAL],number:[r.QUANTITATIVE,r.ORDINAL,r.NOMINAL],date:[r.TEMPORAL],string:[r.NOMINAL],"boolean":[r.NOMINAL],all:[r.QUANTITATIVE,r.TEMPORAL,r.ORDINAL,r.NOMINAL]},d=i.$watch("fieldDef",function(e){l.enumSpec.isEnumSpec(e.field)?i.allowedTypes=s.all:i.allowedTypes=s[e.primitiveType],i.isAnyField=l.enumSpec.isEnumSpec(e.field)});i.fieldTitle=function(e){return l.enumSpec.isEnumSpec(e)?(e["enum"]||["Wildcard"]).map(function(e){return"*"===e?"COUNT":e}).join(","):e},i.$on("$destroy",function(){i.fieldAdd=null,i.fieldDragStop=null,i.isEnumSpec=null,d()})}}}])}(),function(){"use strict";angular.module("vlui").directive("shelves",function(){return{templateUrl:"components/shelves/shelves.html",restrict:"E",scope:{spec:"=",preview:"<",supportAny:"<",supportAutoMark:"<",filterManager:"=",chron:"<",ecconfig:"="},replace:!0,link:function(){return function(){}},controller:["$scope","$timeout","ANY","Config","Dataset","Logger","Pills",function(e,i,t,n,l,o,a){e.ANY=t,e.anyChannelIds=[],e.Dataset=l,e.freshModel=!0,e.titleShow=!0,e.themeShow=!0,e.propShow=!0,e.legendShow=!0,e.optionShow=!0,e.filterShow=!0,e.min=0,e.max=100,e.marks=["pie","gauge","bmap","mixed","scatter","radar","single","funnel","candlestick","wordCloud","treemap","graph","dbar","tree","sankey"],e.echartthemelist=[{v:"infographic",t:"样式一"},{v:"macarons",t:"样式二"},{v:"shine",t:"样式三"},{v:"dark",t:"样式四"},{v:"roma",t:"样式五"}],e.marksicon={pie:{icon:"fa-pie-chart",title:"饼状图"},gauge:{icon:"fa-tachometer",title:"仪表盘"},bmap:{icon:"fa-map-o",title:"地图"},mixed:{icon:"fa-line-chart",title:"混合"},scatter:{icon:"fa-braille",title:"散点"},radar:{icon:"fa-connectdevelop",title:"雷达图"},single:{icon:"fa-long-arrow-up",title:"单指标"},funnel:{icon:"fa-align-center",title:"漏斗图"},candlestick:{icon:"fa-line-chart",title:"K线图"},wordCloud:{icon:"fa-building",title:"词云图"},treemap:{icon:"fa-th-large",title:"矩阵图"},graph:{icon:"fa-share-alt",title:"力学关系图"},dbar:{icon:"fa-bar-chart",title:"多维柱"},tree:{icon:"fa-tree",title:"树形图"},sankey:{icon:"fa-barcode",title:"桑基图"}},e.ifechart=!1,e.tab="tab1",e.echartShape=["pie","gauge","bmap","mixed","scatter","radar","single","funnel","candlestick","worldcloud","treemap","graph","sunburst","sankey"],e.showmarktype=!1,e.changetype=function(i){e.spec.mark=i,e.markdetail=e.marksicon[i],e.showmarktype=!1},e.hasOption=function(e){return["pie","mixed","single"].indexOf(e)>-1},e.spec.mark="pie",e.markdetail=e.marksicon.pie,e.marksWithAny=e.marks,e.markChange=function(){o.logInteraction(o.actions.MARK_CHANGE,e.spec.mark)},e.setTab=function(i){e.tab=i},e.clear=function(){o.logInteraction(o.actions.SPEC_CLEAN,e.spec),a.reset()},e.$watch("ecconfig.title",function(i){e.ecconfig&&e.ecconfig.title&&(e.normalTitle=angular.copy(i.text),e.normalSubTitle=angular.copy(i.subtext),e.normalTitlePosition=angular.copy(i.left),e.titletextcolor=angular.copy(i.textStyle.color),e.subtitletextcolor=angular.copy(i.subtextStyle.color))},!0),e.$watch("ecconfig.option",function(i){e.ecconfig&&e.ecconfig.option&&"single"===e.ecconfig.data.type&&(e.border_color=i.thermometer.bordercolor,e.bar_color=i.thermometer.barcolor,e.point_color=i.thermometer.pointcolor,e.title_color=i.thermometer.titlecolor,e.value_color=i.card.valuecolor,e.fill_color=i.card.fillcolor,e.stroke_color=i.card.strokecolor)},!0),e.$watch("spec.mark",function(i){e.markdetail=e.marksicon[i],e.echartShape.indexOf(i)>=0?e.ifechart=!0:e.ifechart=!1}),i(function(){$(".color-input-title").colorpicker({colorSelectors:{"#000000":"#000000","#ffffff":"#ffffff","#FF0000":"#FF0000","#777777":"#777777","#337ab7":"#337ab7","#5cb85c":"#5cb85c","#5bc0de":"#5bc0de","#f0ad4e":"#f0ad4e","#d9534f":"#d9534f","#FFFF00":"#FFFF00","#EE00EE":"#EE00EE","#ADFF2F":"#ADFF2F"}}).on("changeColor",function(){"bt"===$(this).attr("rel")&&(e.titletextcolor=$(this).val()),"sbt"===$(this).attr("rel")&&(e.subtitletextcolor=$(this).val())})}),e.$watch("ecconfig.type",function(t){t&&i(function(){$(".color-input-single").colorpicker({colorSelectors:{"#000000":"#000000","#ffffff":"#ffffff","#FF0000":"#FF0000","#777777":"#777777","#337ab7":"#337ab7","#5cb85c":"#5cb85c","#5bc0de":"#5bc0de","#f0ad4e":"#f0ad4e","#d9534f":"#d9534f","#FFFF00":"#FFFF00","#EE00EE":"#EE00EE","#ADFF2F":"#ADFF2F"}}).on("changeColor",function(){"border"===$(this).attr("rel")&&(e.border_color=$(this).val()),"point"===$(this).attr("rel")&&(e.point_color=$(this).val()),"bar"===$(this).attr("rel")&&(e.bar_color=$(this).val()),"title"===$(this).attr("rel")&&(e.title_color=$(this).val()),"fill"===$(this).attr("rel")&&(e.fill_color=$(this).val()),"stroke"===$(this).attr("rel")&&(e.stroke_color=$(this).val()),"value"===$(this).attr("rel")&&(e.value_color=$(this).val())})})}),e.setNormalTitle=function(i){e.freshModel&&("title"===i?e.ecconfig.title.text=angular.copy(e.normalTitle):e.ecconfig.title.subtext=angular.copy(e.normalSubTitle))},e.setTop=function(){e.freshModel&&"0"!==e.ecconfig.mapdata.order_modal&&(e.ecconfig.mapdata.top_num=angular.copy(e.top_num))},e.setColor=function(i){"border"===i&&(e.ecconfig.option.thermometer.bordercolor=angular.copy(e.border_color)),"point"===i&&(e.ecconfig.option.thermometer.pointcolor=angular.copy(e.point_color)),"bar"===i&&(e.ecconfig.option.thermometer.barcolor=angular.copy(e.bar_color)),"title"===i&&(e.ecconfig.option.thermometer.titlecolor=angular.copy(e.title_color),e.ecconfig.option.card.titlecolor=angular.copy(e.title_color)),"fill"===i&&(e.ecconfig.option.card.fillcolor=angular.copy(e.fill_color)),"stroke"===i&&(e.ecconfig.option.card.strokecolor=angular.copy(e.stroke_color)),"value"===i&&(e.ecconfig.option.card.valuecolor=angular.copy(e.value_color)),"bt"===i&&(e.ecconfig.title.textStyle.color=angular.copy(e.titletextcolor)),"sbt"===i&&(e.ecconfig.title.subtextStyle.color=angular.copy(e.subtitletextcolor))},e.setOrder=function(){e.freshModel&&(e.ecconfig.mapdata.order_modal=angular.copy(e.order_modal))},e.setTitlePosition=function(){e.freshModel&&(e.ecconfig.mapdata.map_title_left=angular.copy(e.map_title_left))},e.setNormalTitlePosition=function(){e.freshModel&&(e.ecconfig.title.left=angular.copy(e.normalTitlePosition))},e.mixedyFieldDrop=function(){e.ymodel.rename=e.ymodel.field,e.ymodel.type="bar",e.ymodel.truetype="bar",e.ymodel.isarea="0",e.ymodel.smooth=!1,e.ymodel.showmax=!1,e.ymodel.showmin=!1,e.ymodel.showline=!1,e.ymodel.basebar=!1,e.ymodel.shadowbar=!1,e.ymodel.newy=!1,e.ymodel.inversey=!1,e.ymodel.shownewy=e.ecconfig.field.y.length>0,e.ymodel.autoColor="true",e.ymodel.color="#333",e.ymodel.alertscount=0,e.ymodel.label={normal:{show:"true",position:"top",rotate:"0"}},e.ecconfig.field.y.push(angular.copy(e.ymodel))},e.kyFieldDrop=function(){e.ymodel.rename=e.ymodel.field,e.ymodel.type="line",e.ymodel.truetype="line",e.ymodel.isarea="0",e.ymodel.smooth=!0,e.ymodel.label={normal:{show:"true",position:"top",rotate:"0"}},e.ecconfig.field.y.push(angular.copy(e.ymodel))},e.pointFieldDrop=function(){e.pointModel.color="#333",e.pointModel.iftop="false",e.pointModel.order="asc",e.pointModel.order_num="5",e.pointModel.top_color="blue",e.ecconfig.point.push({x:angular.copy(e.pointModel),y:{},lon:{},lat:{}})},e.hasLegend=function(e){return["mixed","pie","funnel","scatter","radar"].indexOf(e)>=0},e.piexFieldDrop=function(){e.piexmodel.label={show:"true",position:"outside",showpercent:"true"},e.ecconfig.field.x.push(angular.copy(e.piexmodel))},e.gaugeYFieldDrop=function(){e.gaugeY.name="",e.gaugeY.showPercent="false",e.gaugeY.decimals=0,e.gaugeY.autoMax="false",e.gaugeY.maxField={},e.gaugeY.autoSplit="false",e.gaugeY.splitField=[],e.gaugeY.splitcolor="#f09426",e.gaugeY.fullwidth="80",e.gaugeY.max="100",e.gaugeY.range="0.2,0.8",e.gaugeY.style={itemStyle:{normal:{shadowBlur:15,shadowColor:"rgba(40, 40, 40, 0.5)"}},axisLine:{lineStyle:{width:10}},axisTick:{length:"15",lineStyle:{color:"auto"}},splitLine:{length:"20",lineStyle:{color:"auto"}},detail:{fontSize:"12"},title:{fontSize:"20"}},e.ecconfig.field.y.push(angular.copy(e.gaugeY))},e.singleFieldDrop=function(){e.singleModel.label=angular.copy(e.singleModel.field),e.singleModel.unit="",e.singleModel.plusicon="false",e.singleModel._titleFontsize=12,e.singleModel._valueFontsize=12,e.singleModel._titleColor="#000000",e.singleModel._valueColor="#000000",e.ecconfig.field.y.push(angular.copy(e.singleModel))},e.filterFieldDrop=function(){e.ecconfig.field.filters=e.ecconfig.field.filters||[],e.filtermodal.rules=[],e.ecconfig.filter.filters.push(angular.copy(e.filtermodal))},e.removeMix=function(i,t){Array.isArray(e.ecconfig.field[i])?e.ecconfig.field[i].splice(t,1):e.ecconfig.field[i]={}},e.removeFilter=function(i,t){void 0!=t?e.ecconfig.filter[i].splice(t,1):e.ecconfig.filter[i].field={}},e.removePoint=function(i,t){if("x"==i){var n=confirm("是否删除这个标记");n&&e.ecconfig.point.splice(t,1)}else e.ecconfig.point[t][i]={}},e.removeArea=function(i){e.ecconfig.area[i]={}},e.$on("$destroy",function(){specWatcher()})}]}})}(),function(){"use strict";angular.module("vlui").directive("tab",function(){return{templateUrl:"components/tabs/tab.html",restrict:"E",require:"^^tabset",replace:!0,transclude:!0,scope:{heading:"@"},link:function(e,i,t,n){n.addTab(e)}}})}(),function(){"use strict";angular.module("vlui").directive("tabset",function(){return{templateUrl:"components/tabs/tabset.html",restrict:"E",transclude:!0,controller:function(){var e=this;this.tabs=[],this.addTab=function(i){i.active=0===e.tabs.length,e.tabs.push(i)},this.showTab=function(i){e.tabs.forEach(function(e){e.active=e===i})}},controllerAs:"tabset"}})}(),function(){"use strict";angular.module("vlui").filter("compactJSON",["JSON3",function(e){return function(i){return e.stringify(i,null,"  ",80)}}])}(),function(){"use strict";angular.module("vlui").filter("encodeURI",function(){return function(e){return window.encodeURI(e)}})}(),function(){"use strict";angular.module("vlui").filter("reportUrl",["compactJSONFilter","_","consts",function(e,i,t){function n(t){var n="https://docs.google.com/forms/d/1T9ZA14F3mmzrHR7JJVUKyPXzrMqF54CjLIOjv2E7ZEM/viewform?";if(t.fields){var l=encodeURI(e(i.values(t.fields)));n+="entry.1245199477="+l+"&"}if(t.spec){var o=i.omit(t.spec,"config");o=encodeURI(e(o)),n+="entry.1323680136="+o+"&"}if(t.spec2){var a=i.omit(t.spec2,"config");a=encodeURI(e(a)),n+="entry.853137786="+a+"&"}var r="entry.1940292677=";switch(t.type){case"vl":n+=r+"Visualization+Rendering+(Vegalite)&";break;case"vr":n+=r+"Recommender+Algorithm+(Visrec)&";break;case"fv":n+=r+"Recommender+UI+(FacetedViz)&"}return n}function l(t){var n="https://docs.google.com/forms/d/1xKs-qGaLZEUfbTmhdmSoS13OKOEpuu_NNWE5TAAml_Y/viewform?";if(t.spec){var l=i.omit(t.spec,"config");l=encodeURI(e(l)),n+="entry.1245199477="+l+"&"}return n}return"voyager"===t.appId?n:l}])}(),function(){"use strict";angular.module("vlui").filter("underscore2space",function(){return function(e){return e?e.replace(/_+/g," "):""}})}(),function(){"use strict";angular.module("vlui").service("Chart",["cql","_",function(e,i){function t(i){if(!i)return{vlSpec:null,fieldSet:null,shorthand:null,enumSpecIndex:null};var t=i instanceof e.model.SpecQueryModelGroup?i.getTopSpecQueryModel():i;return{enumSpecIndex:t.enumSpecIndex,fieldSet:t.specQuery.encodings,vlSpec:t.toSpec(),shorthand:t.toShorthand()}}function n(e){var t=i.clone(e.encoding),n=t.x,l=t.y;t.y=n,t.x=l;var o=t.row,a=t.column;t.row=a,t.column=o,e.encoding=t}var l={getChart:t,transpose:n};return l}])}(),function(){"use strict";angular.module("vlui").factory("Config",function(){var e={};return e.data={},e.config={},e.getConfig=function(){return{}},e.getData=function(){return e.data},e.large=function(){return{cell:{width:300,height:300},facet:{cell:{width:150,height:150}},overlay:{line:!0},scale:{useRawDomain:!0}}},e.small=function(){return{facet:{cell:{width:150,height:150}},overlay:{line:!0},scale:{useRawDomain:!0}}},e.updateDataset=function(i,t){i.values?(e.data.values=i.values,delete e.data.url,e.data.formatType=void 0):(e.data.url=i.url,delete e.data.values,e.data.formatType=t)},e})}(),function(){"use strict";angular.module("vlui").service("Logger",["$location","$window","$webSql","_","consts","Analytics","Papa","Blob","URL",function(e,i,t,n,l,o,a,r,s){var d={};if(d.levels={OFF:{id:"OFF",rank:0},TRACE:{id:"TRACE",rank:1},DEBUG:{id:"DEBUG",rank:2},INFO:{id:"INFO",rank:3},WARN:{id:"WARN",rank:4},ERROR:{id:"ERROR",rank:5},FATAL:{id:"FATAL",rank:6}},d.actions={INITIALIZE:{category:"DATA",id:"INITIALIZE",level:d.levels.DEBUG},UNDO:{category:"DATA",id:"UNDO",level:d.levels.INFO},REDO:{category:"DATA",id:"REDO",level:d.levels.INFO},DATASET_CHANGE:{category:"DATA",id:"DATASET_CHANGE",level:d.levels.INFO},DATASET_OPEN:{category:"DATA",id:"DATASET_OPEN",level:d.levels.INFO},DATASET_NEW_PASTE:{category:"DATA",id:"DATASET_NEW_PASTE",level:d.levels.INFO},DATASET_NEW_URL:{category:"DATA",id:"DATASET_NEW_URL",level:d.levels.INFO},BOOKMARK_ADD:{category:"BOOKMARK",id:"BOOKMARK_ADD",level:d.levels.INFO},BOOKMARK_REMOVE:{category:"BOOKMARK",id:"BOOKMARK_REMOVE",level:d.levels.INFO},BOOKMARK_OPEN:{category:"BOOKMARK",id:"BOOKMARK_OPEN",level:d.levels.INFO},BOOKMARK_CLOSE:{category:"BOOKMARK",id:"BOOKMARK_CLOSE",level:d.levels.INFO},BOOKMARK_CLEAR:{category:"BOOKMARK",id:"BOOKMARK_CLEAR",level:d.levels.INFO},BOOKMARK_ANNOTATE:{category:"BOOKMARK",id:"BOOKMARK_ANNOTATE",level:d.levels.INFO},CHART_MOUSEOVER:{category:"CHART",id:"CHART_MOUSEOVER",level:d.levels.DEBUG},CHART_MOUSEOUT:{category:"CHART",id:"CHART_MOUSEOUT",level:d.levels.DEBUG},CHART_RENDER:{category:"CHART",id:"CHART_RENDER",level:d.levels.DEBUG},CHART_EXPOSE:{category:"CHART",id:"CHART_EXPOSE",level:d.levels.DEBUG},CHART_TOOLTIP:{category:"CHART",id:"CHART_TOOLTIP",level:d.levels.DEBUG},CHART_TOOLTIP_END:{category:"CHART",id:"CHART_TOOLTIP_END",level:d.levels.DEBUG},SORT_TOGGLE:{category:"CHART",id:"SORT_TOGGLE",level:d.levels.INFO
},MARK_TOGGLE:{category:"CHART",id:"MARK_TOGGLE",level:d.levels.INFO},DRILL_DOWN_OPEN:{category:"CHART",id:"DRILL_DOWN_OPEN",level:d.levels.INFO},DRILL_DOWN_CLOSE:{category:"CHART",id:"DRILL_DOWN_CLOSE",level:d.levels.INFO},LOG_TOGGLE:{category:"CHART",id:"LOG_TOGGLE",level:d.levels.INFO},TRANSPOSE_TOGGLE:{category:"CHART",id:"TRANSPOSE_TOGGLE",level:d.levels.INFO},NULL_FILTER_TOGGLE:{category:"CHART",id:"NULL_FILTER_TOGGLE",level:d.levels.INFO},CLUSTER_SELECT:{category:"CHART",id:"CLUSTER_SELECT",level:d.levels.INFO},LOAD_MORE:{category:"CHART",id:"LOAD_MORE",level:d.levels.INFO},FIELDS_CHANGE:{category:"FIELDS",id:"FIELDS_CHANGE",level:d.levels.INFO},FIELDS_RESET:{category:"FIELDS",id:"FIELDS_RESET",level:d.levels.INFO},FUNC_CHANGE:{category:"FIELDS",id:"FUNC_CHANGE",level:d.levels.INFO},ADD_FIELD:{category:"FIELDS",id:"ADD_FIELD",level:d.levels.INFO},FIELDDEF_HIGHLIGHTED:{category:"FIELDINFO",id:"FIELDDEF_HIGHLIGHTED",level:d.levels.INFO},FIELDDEF_UNHIGHLIGHTED:{category:"FIELDINFO",id:"FIELDDEF_UNHIGHLIGHTED",level:d.levels.INFO},ADD_WILDCARD:{category:"WILDCARD",id:"ADD_WILDCARD",level:d.levels.INFO},ADD_WILDCARD_FIELD:{category:"WILDCARD",id:"ADD_WILDCARD_FIELD",level:d.levels.INFO},REMOVE_WILDCARD_FIELD:{category:"WILDCARD",id:"REMOVE_WILDCARD_FIELD",level:d.levels.INFO},REMOVE_WILDCARD:{category:"WILDCARD",id:"REMOVE_WILDCARD",level:d.levels.INFO},SPEC_CLEAN:{category:"POLESTAR",id:"SPEC_CLEAN",level:d.levels.INFO},SPEC_CHANGE:{category:"POLESTAR",id:"SPEC_CHANGE",level:d.levels.INFO},FIELD_DROP:{category:"POLESTAR",id:"FIELD_DROP",level:d.levels.INFO},FIELD_REMOVED:{category:"POLESTAR",id:"FIELD_REMOVED",level:d.levels.INFO},MARK_CHANGE:{category:"POLESTAR",id:"MARK_CHANGE",level:d.levels.INFO},FILTER_ENABLED:{category:"FILTER",id:"FILTER_ENABLED",level:d.levels.INFO},FILTER_DISABLED:{category:"FILTER",id:"FILTER_DISABLED",level:d.levels.INFO},FILTER_CHANGE:{category:"FILTER",id:"FILTER_CHANGE",level:d.levels.INFO},FILTER_CLEAR:{category:"FILTER",id:"FILTER_CLEAR",level:d.levels.INFO},SPEC_SELECT:{category:"VOYAGER2",id:"SPEC_SELECT",level:d.levels.INFO},SET_ALTERNATIVES_TYPE:{category:"ALTERNATIVES",id:"SET_ALTERNATIVES_TYPE",level:d.levels.INFO},TOGGLE_SHOW_ALTERNATIVES:{category:"ALTERNATIVES",id:"TOGGLE_SHOW_ALTERNATIVES",level:d.levels.INFO},TOGGLE_HIDE_ALTERNATIVES:{category:"ALTERNATIVES",id:"TOGGLE_HIDE_ALTERNATIVES",level:d.levels.INFO},SPEC_PREVIEW_ENABLED:{category:"PREVIEW",id:"SPEC_PREVIEW_ENABLED",level:d.levels.INFO},SPEC_PREVIEW_DISABLED:{category:"PREVIEW",id:"SPEC_PREVIEW_DISABLED",level:d.levels.INFO}},void 0===i.openDatabase)return console.warn("No websql support and thus no logging."),d.logInteraction=function(){},d;var c=d.userid=e.search().userid;return d.db=t.openDatabase("logs","1.0","Logs",2097152),d.tableName="Logs_"+l.appId,d.createTableIfNotExists=function(){d.db.createTable(d.tableName,{userid:{type:"INTEGER","null":"NOT NULL"},time:{type:"TIMESTAMP","null":"NOT NULL"},actionCategory:{type:"TEXT","null":"NOT NULL"},actionId:{type:"TEXT","null":"NOT NULL"},label:{type:"TEXT","null":"NOT NULL"},data:{type:"TEXT"}})},d.clear=function(){var e=i.confirm("Really clear the logs?");e===!0&&(d.db.dropTable(d.tableName),d.createTableIfNotExists())},d["export"]=function(){d.db.selectAll(d.tableName).then(function(e){if(0===e.rows.length)return void console.warn("No logs");for(var i=[],t=0;t<e.rows.length;t++)i.push(e.rows.item(t));var n=a.unparse(i),l=new r([n],{type:"text/csv"}),o=s.createObjectURL(l),p=angular.element("<a/>");p.attr({href:o,target:"_blank",download:d.tableName+"_"+c+"_"+(new Date).toISOString()+".csv"})[0].click()})},d.logInteraction=function(e,i,t){if(l.logging){var a=t?t.value:void 0;if(e.level.rank>=d.levels[l.logLevel||"INFO"].rank){if(o.trackEvent(e.category,e.id,i,a),l.logToWebSql){var r={userid:c,time:(new Date).toISOString(),actionCategory:e.category,actionId:e.id,label:n.isObject(i)?JSON.stringify(i):i,data:t?JSON.stringify(t):void 0};d.db.insert(d.tableName,r)}e.level.rank>=d.levels[l.logPrintLevel||"INFO"].rank&&console.log("[Logging] ",e.id,i,t)}}},d.createTableIfNotExists(),d.logInteraction(d.actions.INITIALIZE,l.appId),d}])}(),function(){"use strict";angular.module("vlui").service("FilterManager",["_","Dataset","Logger",function(e,i,t){function n(e){var t=i.schema.type(e),n={Type:{QUANTITATIVE:"quantitative",quantitative:"QUANTITATIVE",ORDINAL:"ordinal",ordinal:"ORDINAL",TEMPORAL:"temporal",temporal:"TEMPORAL",NOMINAL:"nominal",nominal:"NOMINAL"},QUANTITATIVE:"quantitative",ORDINAL:"ordinal",TEMPORAL:"temporal",NOMINAL:"nominal",SHORT_TYPE:{quantitative:"Q",temporal:"T",nominal:"N",ordinal:"O"},TYPE_FROM_SHORT_TYPE:{Q:"quantitative",T:"temporal",O:"ordinal",N:"nominal"}};switch(t){case n.NOMINAL:case n.ORDINAL:return{enabled:!0,field:e,"in":i.schema.domain({field:e})};case n.QUANTITATIVE:return{enabled:!0,field:e,range:[i.schema.stats({field:e}).min,i.schema.stats({field:e}).max]};case n.TEMPORAL:return{enabled:!0,field:e,range:[i.schema.stats({field:e}).min,i.schema.stats({field:e}).max]}}}var l=this;l.filterIndex={},this.toggle=function(e){l.filterIndex[e]?l.filterIndex[e].enabled=!l.filterIndex[e].enabled:l.filterIndex[e]=n(e),t.logInteraction(l.filterIndex[e].enabled?t.actions.FILTER_ENABLED:t.actions.FILTER_DISABLED,e,l.filterIndex[e])},this.add=function(e){return l.filterIndex[e]?!(!l.filterIndex[e]||l.filterIndex[e].enabled)&&(l.filterIndex[e].enabled=!0,!0):(l.filterIndex[e]=n(e),t.logInteraction(t.actions.FILTER_ENABLED,e,l.filterIndex[e]),!0)},this.reset=function(i,t){return t?l.filterIndex={}:e.forEach(l.filterIndex,function(e,i){l.filterIndex[i].enabled&&(l.filterIndex[i]=n(i))}),i&&i.forEach(function(e){l.filterIndex[e.field]=angular.extend({enabled:!0},e)}),l.filterIndex},this.getVlFilter=function(){var t=e.reduce(l.filterIndex,function(t,n){var l=n.field,o=n.timeUnit;if(n["in"]){if(0===n["in"].length||n["in"].length===i.schema.cardinality({field:l}))return t}else if(n.range){var a=i.schema.domain({field:l,timeUnit:o});if(n.range[0]===a[0]&&n.range[1]===a[1])return t}return n.enabled&&t.push(e.omit(n,"enabled")),t},[]);return t.length?t:void 0}}])}(),function(){"use strict";angular.module("vlui").service("Pills",["ANY","consts","cql",function(e,i,t){function n(i){return i&&0===i.indexOf(e)}function l(e){var i,t=[];for(i in e)t.push(i);return t}function o(){for(var i=l(m.pills).filter(function(i){return 0===i.indexOf(e)}),t=0;t<i.length;t++){var n=i[t];if(!m.pills[n].field)return n}throw new Error("No empty any channel available!")}function a(){for(var t=0;m.pills[e+t];)t++;return!i.maxAnyShelf||t>=i.maxAnyShelf?null:e+t}function r(e,i,t){m.pills[e]=i,t&&m.listener&&m.listener.set(e,i)}function s(e){return m.pills[e]}function d(e){return!(!m.listener||!m.listener.isEnumeratedChannel)&&m.listener.isEnumeratedChannel(e,m.pills[e])}function c(e){return!(!m.listener||!m.listener.isEnumeratedField)&&m.listener.isEnumeratedField(e,m.pills[e])}function p(e){delete m.pills[e],m.listener&&m.listener.remove(e)}function f(e,i){m.dragging=e,m.isDraggingWildcard=t.enumSpec.isEnumSpec(e.field),m.cidDragFrom=i}function u(){m.dragging=null}function g(e){m.listener&&m.listener.dragDrop(e,m.cidDragFrom)}var m={isAnyChannel:n,getNextAnyChannelId:a,getEmptyAnyChannelId:o,isEnumeratedChannel:d,isEnumeratedField:c,get:s,dragDrop:g,dragStart:f,dragStop:u,set:r,remove:p,countFieldDef:{field:"条目总数",type:"quantitative",aggregate:"count_sum"},calcFieldDef:{field:"计算指标",type:"calculator",aggregate:"count"},pills:{},highlighted:{},dragging:null,isDraggingWildcard:null,cidDragFrom:null,listener:null};return["add","parse","select","preview","update","reset","rescale","sort","toggleFilterInvalid","transpose","addWildcardField","addWildcard","removeWildcardField","removeWildcard"].forEach(function(e){m[e]=function(){if(m.listener&&m.listener[e])return m.listener[e].apply(null,arguments)}}),m}])}(),function(){"use strict";angular.module("vlui").factory("Schema",["vlSchema",function(e){var i={};return i.schema=e,i.getChannelSchema=function(e){var t=null,n=i.schema.definitions.Encoding.properties[e],l=n?n.$ref||n.oneOf[0].$ref:"FieldDef";return t=l.slice(l.lastIndexOf("/")+1),i.schema.definitions[t]},i}])}();